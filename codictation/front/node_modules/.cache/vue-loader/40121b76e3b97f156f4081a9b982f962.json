{"remainingRequest":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\FFFF\\codictation.2.4\\codictation\\src\\components\\scores.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"E:\\FFFF\\codictation.2.4\\codictation\\src\\components\\scores.vue","mtime":1616159969965},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-cli-plugin-quasar\\lib\\loader.auto-import.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiNleHBvcnQgewogIHBvc2l0aW9uOiBmaXhlZDsKICB0b3A6IDEyJTsKICByaWdodDogMyU7CiAgcGFkZGluZzogM3B4IDI1cHg7Cn0K"},{"version":3,"sources":["scores.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4iBA;AACA;AACA;AACA;AACA;AACA","file":"scores.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div style=\"margin-top:70px\">\n    <!-- <div style=\"height: 64px\"><Header></Header></div> -->\n    <div class=\"dashboard-container\">\n      <!-- <h2>分数展示</h2> -->\n      <q-btn\n        id=\"export\"\n        color=\"purple\"\n        label=\"Export\"\n        @click=\"handleDownload()\"\n      />\n      <!-- <el-button type=\"primary\" @click=\"handleDownload()\">导出</el-button> -->\n      <!-- <el-button type=\"primary\" @click=\"goBack()\">返回</el-button> -->\n      <div\n        class=\"q-pa-md\"\n        style=\"max-width: 400px; margin-left: 5%; margin-top: 2%\"\n      >\n        <div class=\"q-gutter-md\">\n          <span>Configuration：</span>\n          <q-input\n            standout=\"bg-purple text-white\"\n            v-model=\"configuration.SMscore\"\n            label=\"Total score of SM\"\n            type=\"number\"\n            @blur=\"checkNum()\"\n          />\n          <q-input\n            standout=\"bg-purple text-white\"\n            v-model=\"configuration.timePercentage\"\n            label=\"Percentage of time(0.00)\"\n            type=\"number\"\n            @blur=\"checkNum()\"\n          />\n          <q-input\n            standout=\"bg-purple text-white\"\n            v-model=\"configuration.timeSpan\"\n            label=\"Span of submission time between 2 people(min)\"\n            type=\"number\"\n            @blur=\"checkNum()\"\n          />\n        </div>\n      </div>\n      <div style=\"margin-left: 6%\">\n        <q-btn\n          color=\"purple\"\n          label=\"Preview\"\n          @click=\"pre()\"\n          style=\"margin-right: 0.5%\"\n        />\n        <q-btn\n          color=\"purple\"\n          label=\"Cancel\"\n          v-if=\"isPre\"\n          @click=\"cancelPre()\"\n          style=\"margin-right: 0.5%\"\n        />\n        <q-btn color=\"purple\" label=\"Save\" v-if=\"isSave\" @click=\"savePre()\" />\n      </div>\n\n      <div style=\"margin-left: 5%\">\n        <div class=\"q-pa-md\" style=\"width: 350px\">\n          <q-list bordered separator>\n            <q-item clickable v-ripple>\n              <q-item-section>\n                <q-item-label>Average score(AS)</q-item-label>\n                <q-item-label caption>{{ averScores }}</q-item-label>\n              </q-item-section>\n            </q-item>\n            <q-item clickable v-ripple>\n              <q-item-section>\n                <q-item-label>The number of people passing AS</q-item-label>\n                <q-item-label caption>{{ exceedAverNum }}</q-item-label>\n              </q-item-section>\n            </q-item>\n            <q-item clickable v-ripple>\n              <q-item-section>\n                <q-item-label>Total number of people</q-item-label>\n                <q-item-label caption>{{ scoresData.length }}</q-item-label>\n              </q-item-section>\n            </q-item>\n            <q-item clickable v-ripple>\n              <q-item-section>\n                <q-item-label>Pass rate</q-item-label>\n                <q-item-label caption>{{ pass60Rate }}</q-item-label>\n              </q-item-section>\n            </q-item>\n            <q-item clickable v-ripple>\n              <q-item-section>\n                <q-item-label>Pass AS Rate</q-item-label>\n                <q-item-label caption>{{ passAverRate }}</q-item-label>\n              </q-item-section>\n            </q-item>\n            <q-item clickable v-ripple>\n              <q-item-section>\n                <q-item-label>Max score</q-item-label>\n                <q-item-label caption>{{ maxScore }}</q-item-label>\n              </q-item-section>\n            </q-item>\n            <q-item clickable v-ripple>\n              <q-item-section>\n                <q-item-label>Mini score</q-item-label>\n                <q-item-label caption>{{ minScore }}</q-item-label>\n              </q-item-section>\n            </q-item>\n          </q-list>\n        </div>\n      </div>\n      <br />\n      <div style=\"position: absolute; top: 17.5%; left: 35%\">\n        <el-table\n          v-loading=\"loading\"\n          :data=\"scoresData\"\n          style=\"width: 800px\"\n          border\n          fit\n          highlight-current-row\n        >\n          <el-table-column type=\"index\" label=\"Index\"> </el-table-column>\n          <el-table-column prop=\"name\" sortable label=\"student\" />\n          <el-table-column\n            prop=\"techScores\"\n            sortable\n            label=\"Score on modifications(SM)\"\n          />\n          <el-table-column\n            prop=\"matchScores\"\n            sortable\n            label=\"Score on texts similarity(STS)\"\n          />\n          <el-table-column prop=\"scores\" sortable label=\"Total score\" />\n          <el-table-column label=\"Details\">\n            <template slot-scope=\"scope\">\n              <el-button\n                size=\"mini\"\n                type=\"primary\"\n                @click=\"handleCheck(scope.$index, scope.row)\"\n                >CHECK\n              </el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n        <el-pagination\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n          :current-page=\"currentpage\"\n          :page-sizes=\"[5, 10, 20, 50]\"\n          :page-size=\"pagesize\"\n          layout=\"total, sizes, prev, pager, next, jumper\"\n          :total=\"totalData.length\"\n        >\n        </el-pagination>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport XLSX, { WorkSheet } from \"xlsx\";\nimport Header from \"../components/basic/Header.vue\";\nconst _ = require(\"loadsh\");\n\nvar {\n  countTechScores,\n  countMatchPoints,\n  linearReg,\n} = require(\"../countScores.js\");\n\nexport default {\n  data() {\n    return {\n      name: \"\",\n      diffId: \"\",\n      userId: \"\",\n      averScores: \"\", //页面显示的平均分\n      oAverScores: \"\", //数据库中的平均分\n      oScoresData: [], //根据数据库中内容生成的表格\n      scoresData: [], //页面展示的中的表格\n      SMscore: \"\", //数据库中的该任务的偏好设置\n      timePercentage: \"\",\n      timeSpan: \"\",\n      configuration: [], //页面展示的该任务的偏好设置\n      c: \"\",\n      totalData: [],\n      api: \"/api\",\n      matchPoints: 40, //匹配总分\n      techList2: [], //参数调整后的技术详情\n      matchList2: [], //参数调整后的匹配详情\n      scoreList2: [], //参数调整后的分数详情\n      averScores2: \"\", //参数调整后的平均分\n      preScoresData: [], //参数调整后的表格\n\n      loading: true,\n      isPre: false, //是否预览\n      isSave: false, //是否保存\n      //页面\n      exceedAverNum: \"\", //超过平均分人数\n      pass60Rate: \"\", //超过60的比率\n      passAverRate: \"\", //超过平均分的比率\n      maxScore: \"\", //最大值\n      minScore: \"\", //最小值\n\n      // 数据库中获取到的值\n      oExceedAverNum: \"\",\n      oPass60Rate: \"\",\n      oPassAverRate: \"\",\n      oMaxScore: \"\",\n      oMinScore: \"\",\n      //分页\n      pagesize: 5,\n      currentpage: 1,\n    };\n  },\n  methods: {\n    checkNum(){//对输入数字进行限制\n      if(this.configuration.SMscore > 0){\n        this.configuration.SMscore = this.configuration.SMscore>100?100:this.configuration.SMscore\n      } else {\n        this.configuration.SMscore = 0\n      }\n\n      if(this.configuration.timePercentage > 0){\n        this.configuration.timePercentage = this.configuration.timePercentage>1?1:this.configuration.timePercentage\n      } else {\n        this.configuration.timePercentage = 0\n      }\n\n      if(this.configuration.timeSpan < 0){\n        this.configuration.timeSpan = 0\n      }\n\n    },\n    \n    pre() {\n      this.loading = true;\n      this.$axios\n        .get(this.api + \"/currentTask?_id=\" + this.diffId)\n        .then((res) => {\n          //获取数据库中内容\n          var diffList = res.data[0].diffList;\n          var publisher = res.data[0].publisher;\n          var submitted = res.data[0].submitted;\n          var matchList = res.data[0].matchList;\n          //根据页面的参数再次进行计算\n          var { ts, fnl } = countTechScores(\n            diffList,\n            publisher,\n            this.configuration.SMscore,\n            submitted,\n            this.configuration.timePercentage,\n            this.configuration.timeSpan\n          );\n          var matchList2 = matchList;\n          for (var i = 0; i < matchList2.length; i++) {\n            this.matchPoints = 100 - this.configuration.SMscore;\n            matchList2[i].points = Math.round(\n              this.matchPoints * matchList2[i].matchRate\n            );\n          }\n          linearReg(matchList2);\n          //生成预览表格\n          this.formPreData(matchList2, ts, fnl);\n          this.$notify({\n            title: \"\",\n            message: \"Preview successfully\",\n            position: \"bottom-right\",\n            type: \"success\",\n          });\n        });\n    },\n\n    formPreData(matchList, techList, fnl) {\n      this.techList2 = fnl;\n      this.matchList2 = matchList;\n      var sum = 0;\n      for (var i = 0; i < this.matchList2.length; i++) {\n        var name = this.matchList2[i].name;\n        var scores = Math.round(techList[name] + this.matchList2[i].points);\n        sum += scores;\n        this.scoreList2.push({\n          name: name,\n          techScores: techList[name],\n          matchScores: this.matchList2[i].points,\n          scores: scores,\n        });\n      }\n      this.averScores2 = Math.round(sum / this.matchList2.length);\n      //通过已获得数据进行计算，生成表格\n      var preScoresData = [];\n      for (var i = 0; i < matchList.length; i++) {\n        var name = matchList[i].name;\n        var points = matchList[i].points;\n        preScoresData.push({\n          name: name,\n          techScores: techList[name],\n          matchScores: points,\n          scores: Math.round(techList[name] + points),\n        });\n      }\n      this.countDetails(preScoresData, this.averScores2);\n      //生成预览\n      this.preScoresData = preScoresData;\n      this.averScores = this.averScores2;\n      this.totalData = this.preScoresData;\n      this.scoresData = _.chunk(this.totalData, this.pagesize)[\n        this.currentpage - 1\n      ];\n      this.loading = false;\n      this.isPre = true;\n      this.isSave = true;\n    },\n\n    countDetails(scoresData, averScores) {\n      var pass60;\n      var slist = [];\n      for (var i = 0; i < scoresData.length; i++) {\n        slist.push(scoresData[i].scores);\n        if (scoresData[i].scores >= averScores) {\n          this.exceedAverNum += 1;\n        }\n        if (scoresData[i].scores >= 60) {\n          pass60 += 1;\n        }\n      }\n      this.pass60Rate = Math.round((pass60 / slist.length) * 100);\n      this.passAverRate = Math.round((this.exceedAverNum / slist.length) * 100);\n      this.pass60Rate = this.pass60Rate ? this.pass60Rate + \"%\" : 0;\n      this.passAverRate = this.passAverRate ? this.passAverRate + \"%\" : 0;\n      this.maxScore = Math.max.apply(null, slist);\n      this.minScore = Math.min.apply(null, slist);\n    },\n\n    cancelPre() {\n      //取消预览\n      this.totalData = this.oScoresData;\n      this.scoresData = _.chunk(this.totalData, this.pagesize)[\n        this.currentpage - 1\n      ];\n      this.configuration.SMscore = this.SMscore;\n      this.configuration.timePercentage = this.timePercentage;\n      this.configuration.timeSpan = this.timeSpan;\n      this.averScores = this.oAverScores;\n      this.exceedAverNum = this.oExceedAverNum;\n      this.pass60Rate = this.oPass60Rate;\n      this.passAverRate = this.oPassAverRate;\n      this.maxScore = this.oMaxScore;\n      this.minScore = this.oMinScore;\n      this.isPre = false;\n      this.isSave = false;\n      this.$notify({\n        message: \"Cancel\",\n        position: \"bottom-right\",\n      });\n    },\n\n    savePre() {\n      //更新数据库中内容\n      this.$confirm(\"Save?\", \"Alert\", {\n        confirmButtonText: \"Confirm\",\n        cancelButtonText: \"Cancel\",\n        type: \"warning\",\n        center: true,\n      }).then(() => {\n        this.$axios.post(this.api + \"/updateScoresList\", {\n          params: {\n            _id: this.diffId,\n            scoreList: this.scoreList2,\n            techList: this.techList2,\n            matchList: this.matchList2,\n            averScores: this.averScores2,\n          },\n        });\n\n        this.$axios.post(this.api + \"/updateMyPublishedScores\", {\n          params: {\n            _id: this.userId,\n            taskId: this.diffId,\n            scoreList: this.scoreList2,\n            techList: this.techList2,\n            matchList: this.matchList2,\n            averScores: this.averScores2,\n            configuration: this.configuration,\n          },\n        });\n\n        this.$axios.post(this.api + \"/updateStuScores\", {\n          //保存修改后，对已查看分数的学生的分数进行修改\n          params: {\n            taskId: this.diffId,\n            scoreList: this.scoreList2,\n          },\n        });\n\n        this.$axios.post(this.api + \"/updateTasksConfiguration\", {\n          //保存修改后，对任务的configuration进行修改\n          params: {\n            taskId: this.diffId,\n            configuration: this.configuration,\n          },\n        });\n\n        this.isPre = false;\n        this.isSave = false;\n      });\n    },\n\n    formScoresData(matchList, scoreList) {\n      //根据已获得数据生成表格\n      for (var i = 0; i < matchList.length; i++) {\n        var name = matchList[i].name;\n        var index = scoreList.findIndex((item) => item.name == name);\n        this.oScoresData.push({\n          name: name,\n          techScores: scoreList[index].techScores,\n          matchScores: scoreList[index].matchScores,\n          scores: scoreList[index].scores,\n        });\n      }\n      //生成预览\n      this.totalData = this.oScoresData;\n      this.scoresData = _.chunk(this.totalData, this.pagesize)[\n        this.currentpage - 1\n      ];\n      this.loading = false;\n    },\n\n    handleDownload() {\n      var tableHeader = [\n        [\n          \"Student\",\n          \"Score on modifications(SM)(\" + this.configuration.SMscore + \")\",\n          \"Score on texts similarity(STS)(\" + this.matchPoints + \")\",\n          \"Total score\",\n        ],\n      ]; //表头\n      var dataList = [];\n      this.totalData.forEach((item) => {\n        dataList.push([\n          item.name,\n          item.techScores,\n          item.matchScores,\n          item.scores,\n        ]);\n      }); //表数据\n      var filename = this.timestamp(); //文件名，以时间命名\n      var sheet = \"sheet1\"; //存在第几个表\n      let aoa = [];\n\n      var overview = [];\n\n      overview.push(\n        [\"Average score(AS)\", String(this.averScores)],\n        [\"The number of people passing AS\", String(this.exceedAverNum)],\n        [\"Total number of people\", String(dataList.length)],\n        [\"Pass rate\", String(this.pass60Rate)],\n        [\"Pass AS rate\", String(this.passAverRate)],\n        [\"Max score\", String(this.maxScore)],\n        [\"Mini score\", String(this.minScore)]\n      );\n      var a = [[], []]; //当a=[[],[]]时相当于空两行\n\n      // aoa的数据格式：[[],[],[],[]]   数组的第一个子数组可以指定为表头  根据情况而定\n      aoa = overview.concat(a, tableHeader, dataList);\n\n      let workSheet = XLSX.utils.aoa_to_sheet(aoa);\n      let workBook = XLSX.utils.book_new();\n\n      XLSX.utils.book_append_sheet(workBook, workSheet, sheet);\n      //保存\n      XLSX.writeFile(workBook, filename + \".xlsx\");\n    }, //导出Excel表\n\n    add0(m) {\n      return m < 10 ? \"0\" + m : m;\n    },\n\n    timestamp() {\n      var time = new Date();\n      var y = time.getFullYear();\n      var m = time.getMonth() + 1;\n      var d = time.getDate();\n      var h = time.getHours();\n      var mm = time.getMinutes();\n      var s = time.getSeconds();\n\n      return (\n        y +\n        this.add0(m) +\n        this.add0(d) +\n        this.add0(h) +\n        this.add0(mm) +\n        this.add0(s)\n      );\n    }, //生成时间戳\n\n    handleCheck(index, item) {\n      var path = \"/diff/\" + this.diffId + \"/scoresStu\";\n      this.$router.push({ path: path, query: { name: item.name } });\n    }, //编辑\n\n    goBack() {\n      //返回上一页\n      this.$router.go(-1);\n    },\n\n    handleSizeChange(val) {\n      this.pagesize = val;\n      this.scoresData = _.chunk(this.totalData, this.pagesize)[\n        this.currentpage - 1\n      ];\n    }, // 每页查看条数变化\n    handleCurrentChange(val) {\n      this.currentpage = val;\n      this.scoresData = _.chunk(this.totalData, this.pagesize)[\n        this.currentpage - 1\n      ];\n    }, // 当前页码变化\n  },\n\n  components: {\n    Header,\n  },\n  created() {\n    this.name = sessionStorage.getItem(\"userName\");\n    this.diffId = this.$route.params.diffId;\n    //请求数据\n    this.$axios.get(this.api + \"/profile?name=\" + this.name).then((res) => {\n      var myPublished = res.data[0].myPublished;\n      this.userId = res.data[0]._id;\n      var index = myPublished.findIndex((item) => item.taskId === this.diffId);\n      var techList = myPublished[index].techList;\n      var matchList = myPublished[index].matchList;\n      var scoreList = myPublished[index].scoreList;\n      this.averScores = myPublished[index].averScores;\n      this.oAverScores = this.averScores;\n      this.configuration = myPublished[index].configuration;\n      this.SMscore = myPublished[index].configuration.SMscore;\n      this.timePercentage = myPublished[index].configuration.timePercentage;\n      this.timeSpan = myPublished[index].configuration.timeSpan;\n      this.exceedAverNum = myPublished[index].exceedAverNum;\n      this.pass60Rate = myPublished[index].pass60Rate;\n      this.passAverRate = myPublished[index].passAverRate;\n      this.maxScore = myPublished[index].maxScore;\n      this.minScore = myPublished[index].minScore;\n      this.oExceedAverNum = myPublished[index].exceedAverNum;\n      this.oPass60Rate = myPublished[index].pass60Rate;\n      this.oPassAverRate = myPublished[index].passAverRate;\n      this.oMaxScore = myPublished[index].maxScore;\n      this.oMinScore = myPublished[index].minScore;\n      this.formScoresData(matchList, scoreList);\n    });\n    this.$forceUpdate();\n  },\n};\n</script>\n\n<style>\n#export {\n  position: fixed;\n  top: 12%;\n  right: 3%;\n  padding: 3px 25px;\n}\n</style>"]}]}