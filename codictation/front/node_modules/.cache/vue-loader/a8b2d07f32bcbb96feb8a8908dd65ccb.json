{"remainingRequest":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\src\\components\\comment.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\src\\components\\comment.vue","mtime":1615344192435},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-cli-plugin-quasar\\lib\\loader.auto-import.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCkBpbXBvcnQgIi4uLy4uL3B1YmxpYy9zY3NzL2luZGV4IjsKCi5jb250YWluZXIgewogICAgcGFkZGluZzogMCAxMHB4OwogICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIC5jb21tZW50IHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgICAgcGFkZGluZzogMTBweDsKICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICRib3JkZXItZm91cnRoOwogICAgICAuaW5mbyB7CiAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgIC5hdmF0YXIgewogICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOwogICAgICAgIH0KICAgICAgICAucmlnaHQgewogICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICAgICAgICBtYXJnaW4tbGVmdDogMTBweDsKICAgICAgICAgIC5uYW1lIHsKICAgICAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgICAgICBjb2xvcjogJHRleHQtbWFpbjsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNXB4OwogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgICAgfQogICAgICAgICAgLmRhdGUgewogICAgICAgICAgICBmb250LXNpemU6IDEycHg7CiAgICAgICAgICAgIGNvbG9yOiAkdGV4dC1taW5vcjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCgogICAgfQouY29udGVudCB7CiAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgIGNvbG9yOiAkdGV4dC1tYWluOwogICAgICAgIGxpbmUtaGVpZ2h0OiAyMHB4OwogICAgICAgIHBhZGRpbmc6IDEwcHggMDsKICAgICAgfQoKLmNvbnRyb2wgewogICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgY29sb3I6ICR0ZXh0LW1pbm9yOwogICAgICAgIC5saWtlIHsKICAgICAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgbWFyZ2luLXJpZ2h0OiAyMHB4OwogICAgICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICAgICAgJi5hY3RpdmUsICY6aG92ZXIgewogICAgICAgICAgICBjb2xvcjogJGNvbG9yLW1haW47CiAgICAgICAgICB9CiAgICAgICAgICAuaWNvbmZvbnQgewogICAgICAgICAgICBmb250LXNpemU6IDE0cHg7CiAgICAgICAgICAgIG1hcmdpbi1yaWdodDogNXB4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAuY29tbWVudC1yZXBseSB7CiAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICY6aG92ZXIgewogICAgICAgICAgICBjb2xvcjogJHRleHQtMzMzOwogICAgICAgICAgfQogICAgICAgICAgLmljb25mb250IHsKICAgICAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDVweDsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICB9CgoKICAgICAucmVwbHkgewogICAgICAgIG1hcmdpbjogMTBweCAwOwogICAgICAgIGJvcmRlci1sZWZ0OiAycHggc29saWQgJGJvcmRlci1maXJzdDsKICAgICAgICAuaXRlbSB7CiAgICAgICAgICBtYXJnaW46IDAgMTBweDsKICAgICAgICAgIHBhZGRpbmc6IDEwcHggMDsKICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBkYXNoZWQgJGJvcmRlci10aGlyZDsKICAgICAgICAgIC5yZXBseS1jb250ZW50IHsKICAgICAgICAgICAgZGlzcGxheTogZmxleDsKICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICAgICAgICBjb2xvcjogJHRleHQtbWFpbjsKICAgICAgICAgICAgLmZyb20tbmFtZSB7CiAgICAgICAgICAgICAgY29sb3I6ICRjb2xvci1tYWluOwogICAgICAgICAgICB9IAogICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC5yZXBseS1ib3R0b20gewogICAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICAgICAgICBtYXJnaW4tdG9wOiA2cHg7CiAgICAgICAgICAgIGZvbnQtc2l6ZTogMTJweDsKICAgICAgICAgICAgY29sb3I6ICR0ZXh0LW1pbm9yO30KCiAgICAgIC53cml0ZS1yZXBseSB7CiAgICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKICAgICAgICAgIGZvbnQtc2l6ZTogMTRweDsKICAgICAgICAgIGNvbG9yOiAkdGV4dC1taW5vcjsKICAgICAgICAgIHBhZGRpbmc6IDEwcHg7CiAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAmOmhvdmVyIHsKICAgICAgICAgICAgY29sb3I6ICR0ZXh0LW1haW47CiAgICAgICAgICB9CiAgICAgICAgICAuZWwtaWNvbi1lZGl0IHsKICAgICAgICAgICAgbWFyZ2luLXJpZ2h0OiA1cHg7CiAgICAgICAgICB9CiAgICAgICAgfQo="},{"version":3,"sources":["comment.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4QA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"comment.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"container\">\n    <div v-if=\"commentList.length > 0\">\n      <div class=\"comment\" v-for=\"(item, index) in commentList\" :key=\"item.time\">\n    \n        <div class=\"info\">\n          <avatar-org class=\"avatar\"  width=\"40\" height=\"40\"></avatar-org>\n        <div class=\"right\">  \n        <div class=\"name\">{{ item.name }}</div>\n        <div class=\"date\">{{ item.time }}</div>\n        </div>\n        </div>\n        <div class=\"content\">{{ item.comment }}</div>\n\n        <div class=\"control\">\n        <span class=\"like\" :class=\"{active: item.isLike}\" @click=\"likeClick(item,index)\">\n          <i class=\"iconfont icon-like\"></i>\n          <span class=\"like-num\">{{item.likeNum > 0 ? item.likeNum + '人赞' : '赞'}}</span>\n        </span>\n        <span class=\"comment-reply\" @click=\"reply(index, item.name)\">\n          <i class=\"iconfont icon-comment\"></i>\n          <span>回复</span>\n        </span>\n      </div>\n\n        <!-- 每条评论的回复列表 -->\n        <div class=\"reply\">\n        <div  class=\"item\" v-for=\"replyitem in item.reply\" :key=\"replyitem.time\">\n          <div class=\"reply-content\" >\n          <span class=\"from-name\">{{ replyitem.responder }}</span><span>: </span>\n          <!-- v-if=\"isMainReply\" -->\n          <!-- <span v-else>{{ replyitem.responder }}回复@</span> -->\n          <!-- <span v-if=\"!isMainReply\">{{ replyitem.reviewer }}</span> -->\n          <span>{{ replyitem.comment }}</span></div>\n          <div class=\"reply-bottom\">\n          <span>{{ replyitem.time }}</span>\n          <!-- <el-button type=\"text\" @click=\"reply(index, replyitem.responder)\"\n            >回复</el-button\n          > -->\n          </div>\n        </div>\n        </div>\n          <div class=\"write-reply\" v-if=\"item.reply.length > 0\" @click=\"reply(index, item.name)\">\n          <i class=\"el-icon-edit\"></i>\n          <span class=\"add-comment\">添加新评论</span>\n        </div>\n       \n        <div :id=\"'input' + index\" style=\"display: none\">\n          <!-- <div v-if=\"isShow\"> -->\n          <el-input\n            type=\"textarea\"\n            class=\"gray-bg-input\"\n            v-model=\"replyComment\"\n            :rows=\"3\"\n            style=\"width: 30%\"\n            placeholder=\"写下你的评论\"\n          ></el-input>\n          <!-- 每一条评论对应一个回复框 -->\n          <br />\n          <!-- 回复评论 -->\n          <el-button type=\"primary\" @click=\"submitReply(index)\">回复</el-button>\n          <el-button type=\"info\" @click=\"cancelReply(index)\">取消</el-button>\n          <!-- v-if=\"isMainReply\" -->\n          <!-- 回复回复 -->\n          <!-- <el-button type=\"primary\" @click=\"submitReply2()\" v-else\n            >回复</el-button\n          > -->\n          <!-- </div> -->\n        </div>\n        <hr />\n      </div>\n    </div>\n    <div v-else>暂无评论~</div>\n    <el-input\n      type=\"textarea\"\n      v-model=\"comment\"\n      :rows=\"4\"\n      style=\"width: 40%\"\n    ></el-input>\n    <br />\n    <el-button type=\"primary\" @click=\"submitCom()\">发表评论</el-button>\n\n\n    \n  </div>\n\n\n</template>\n\n<script>\nimport Vue from 'vue'\nimport AvatarOrg from \"../components/basic/Avatar\";\nexport default {\n  data() {\n    return {\n      commentList: [],\n      comment: \"\",\n      name: \"\",\n      replyComment: \"\",\n      isShow: false,\n      currentReviewer: \"\",\n      currentResponder: \"\",\n      currentIndex: 0,\n      isMainReply: false,\n      diffId: \"\",\n      api: \"/api\",\n    };\n  },\n  components: {\n      AvatarOrg\n    },\n  methods: {\n    addlike(comTime){\n      this.$axios.post(\"/score/addlike\",{\n              params: {_id: this.diffId,name: this.name,comTime:comTime}, \n              })\n    },\n    removelike(comTime){\n      this.$axios.post(\"/score/removelike\",{\n                  params: {_id: this.diffId,name: this.name,comTime:comTime}, \n                  })\n    },\n     likeClick(item,index) {\n       var comTime = item.time\n        if (item.isLike === null) {\n          Vue.$set(item, \"isLike\", true);\n          item.likeNum++\n              this.addlike(comTime)\n        } else {\n          if (item.isLike) {\n            item.likeNum--\n\n            this.removelike(comTime)\n          } else {\n            item.likeNum++\n              this.addlike(comTime)\n          }\n          item.isLike = !item.isLike;\n        }\n      },\n\n    // },\n    submitCom() {\n      // let date = new Date();\n      // let subTime = date.toLocaleString(\"chinese\", {\n      //   hour12: false,\n      // }); //获得当前时间\n      let subTime=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n      if (this.comment) {\n        let item = {\n          name: this.name,\n          time: subTime,\n          comment: this.comment,\n          reply: [],\n        };\n        this.commentList.push(item);\n        // console.log(this.commentList)\n        this.$axios\n          .post(this.api + \"/updatecomment\", {\n            params: {\n              _id: this.diffId,\n              comments: this.commentList,\n            },\n          })\n          .then((result) => {\n            console.log(result);\n          });\n        //将评论列表更新到数据库\n        this.comment = \"\";\n      } else {\n        //输入的内容为空\n        this.$notify({\n          // title: \"警告\",\n          type: \"warning\",\n          message: \"请重新确认，您并未输入内容哦~\",\n          position: \"bottom-right\",\n        });\n      }\n    },\n    submitReply(index) {\n      // 回复评论\n      // let date = new Date();\n      // let subTime = date.toLocaleString(\"chinese\", {\n      //   hour12: false,\n      // }); //获得当前时间\n      let subTime=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n      if (this.replyComment) {\n        let replyItem = {\n          reviewer: this.currentReviewer,\n          responder: this.currentResponder, //回复的用户名\n          time: subTime,\n          comment: this.replyComment,\n          reply2: [],\n        };\n        console.log(replyItem);\n        this.commentList[this.currentIndex].reply.push(replyItem);\n        this.$axios\n          .post(this.api + \"/updateComment\", {\n            params: {\n              _id: this.diffId,\n              comments: this.commentList,\n            },\n          })\n          .then((result) => {\n            console.log(result);\n          });\n        this.replyComment = \"\";\n        document.getElementById(\"input\" + index).style.display = \"none\";\n      } else {\n        //输入的内容为空\n        this.$notify({\n          // title: \"警告\",\n          type: \"warning\",\n          message: \"请重新确认，您并未输入内容哦~\",\n          position: \"bottom-right\",\n        });\n      }\n    },\n    reply(index, reviewer) {\n      document.getElementById(\"input\" + index).style.display = \"block\";\n      this.currentIndex = index;\n      this.currentReviewer = reviewer; //当前被评论的人\n      this.currentResponder = this.name; //当前用户\n      //判断是否为回复评论，显示不同的按钮\n      // if (reviewer == this.commentList[index].name) {\n      //   this.isMainReply = true;\n      // }\n    },\n    cancelReply(index){\n      document.getElementById(\"input\" + index).style.display = \"none\";\n    },\n  },\n   created() {\n     this.name =  sessionStorage.getItem(\"userName\")\n     this.diffId = this.$route.params.diffId;\n     const name = sessionStorage.getItem(\"userName\")\n    //请求数据\n     this.$axios\n      .get(this.api + \"/currentTask?_id=\" + this.diffId)\n      .then((res) => {\n        // this.commentList = res.data[0].comments;\n          var commentList = res.data[0].comments;\n          // console.log(commentList)\n          for(var i = 0; i < commentList.length; i++){\n                if(commentList[i].likeName){\n                   const isName = commentList[i].likeName.findIndex((item) => item == name)\n                   console.log(\"aaaaaaa\")\n                      if(isName==-1){\n                        commentList[i].isLike = false\n                      }else{\n                        commentList[i].isLike = true\n                      }                \n                }else{\n                  commentList[i].isLike = false\n                  commentList[i].likeNum = 0\n                }\n               \n                console.log(commentList)\n          }\n          this.commentList = commentList\n\n      });\n  },\n};\n</script>\n\n<style lang=\"scss\">\n\n@import \"../../public/scss/index\";\n\n.container {\n    padding: 0 10px;\n    box-sizing: border-box;\n    .comment {\n      display: flex;\n      flex-direction: column;\n      padding: 10px;\n      border-bottom: 1px solid $border-fourth;\n      .info {\n        display: flex;\n        align-items: center;\n        .avatar {\n          border-radius: 50%;\n        }\n        .right {\n          display: flex;\n          flex-direction: column;\n          margin-left: 10px;\n          .name {\n            font-size: 16px;\n            color: $text-main;\n            margin-bottom: 5px;\n            font-weight: 500;\n          }\n          .date {\n            font-size: 12px;\n            color: $text-minor;\n          }\n        }\n      }\n    }\n\n\n    }\n.content {\n        font-size: 16px;\n        color: $text-main;\n        line-height: 20px;\n        padding: 10px 0;\n      }\n\n.control {\n        display: flex;\n        align-items: center;\n        font-size: 14px;\n        color: $text-minor;\n        .like {\n          display: flex;\n          align-items: center;\n          margin-right: 20px;\n          cursor: pointer;\n          &.active, &:hover {\n            color: $color-main;\n          }\n          .iconfont {\n            font-size: 14px;\n            margin-right: 5px;\n          }\n        }\n        .comment-reply {\n          display: flex;\n          align-items: center;\n          cursor: pointer;\n          &:hover {\n            color: $text-333;\n          }\n          .iconfont {\n            font-size: 16px;\n            margin-right: 5px;\n          }\n        }\n\n      }\n\n\n     .reply {\n        margin: 10px 0;\n        border-left: 2px solid $border-first;\n        .item {\n          margin: 0 10px;\n          padding: 10px 0;\n          border-bottom: 1px dashed $border-third;\n          .reply-content {\n            display: flex;\n            align-items: center;\n            font-size: 14px;\n            color: $text-main;\n            .from-name {\n              color: $color-main;\n            } \n          }\n          }\n          }\n\n          .reply-bottom {\n            display: flex;\n            align-items: center;\n            margin-top: 6px;\n            font-size: 12px;\n            color: $text-minor;}\n\n      .write-reply {\n          display: flex;\n          align-items: center;\n          font-size: 14px;\n          color: $text-minor;\n          padding: 10px;\n          cursor: pointer;\n          &:hover {\n            color: $text-main;\n          }\n          .el-icon-edit {\n            margin-right: 5px;\n          }\n        }\n</style>"]}]}