{"remainingRequest":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\src\\components\\diff.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\src\\components\\diff.vue","mtime":1615205299302},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-cli-plugin-quasar\\lib\\loader.transform-quasar-imports.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-cli-plugin-quasar\\lib\\loader.auto-import.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\codictation\\collection\\final project\\codictation\\codictation2.0\\codictation.2.2\\codictation\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIGltcG9ydCB7IHZlcnNpb24gfSBmcm9tICd4bHN4L3R5cGVzJzsKaW1wb3J0IEF2YXRhciBmcm9tICJ2dWUtYXZhdGFyIjsKCnZhciBkaWZmZXIgPSByZXF1aXJlKCIuLi9kaWZmLmpzIikuZGlmZmVyOwp2YXIgewogIGNvdW50VGVjaFNjb3JlcywKICBjb3VudE1hdGNoUG9pbnRzLAogIGxpbmVhclJlZywKfSA9IHJlcXVpcmUoIi4uL2NvdW50U2NvcmVzLmpzIik7CgpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHVzZXJTdGF0dXM6IDAsCiAgICAgIGlzcmVhZG9ubHk6IHRydWUsCiAgICAgIGlzVGVhY2hlcjogZmFsc2UsCiAgICAgIHRleHQxOiAiIiwgLy/lvZPliY3nlKjmiLfkvZzkuLrnrKzkuIDkuKrnlKjmiLfmj5DkuqTnmoTnrKzkuIDniYjmnKwKICAgICAgaXN2ZXJzaW9uMTogZmFsc2UsIC8v5Yik5pat5piv5ZCm5pyJ56ys5LiA5Liq54mI5pysCiAgICAgIGlzRmluYWw6IGZhbHNlLCAvL+WIpOaWreaYr+WQpuacieS/ruaUueiusOW9leWPr+S7peeUn+aIkOe7vOWQiOeJiOacrAogICAgICB0ZXh0X3YxOiAiIiwgLy/ku47mlbDmja7lupPlj5blvpfnmoTnrKzkuIDkuKrnlKjmiLfmj5DkuqTnmoTnrKzkuIDniYjmnKzvvIzlj6/og73kuI50ZXh0MeS4jeS4gOagtwogICAgICB0ZXh0X2ZuOiAiIiwKICAgICAgaXNlZGl0OiBmYWxzZSwgLy/mjqfliLbmmK/lkKbmmL7npLrkv67mlLnmoYYKICAgICAgdGV4dERpdjogIiIsIC8v5b2T5YmN6aG16Z2i55qEdGV4dERpdueahOWAvCwg6K6w5b2V5b2T5YmN55So5oi355qE5L+u5pS554mI5pysCiAgICAgIGN1cnJlbnRDb21wYXJlVGV4dDogIiIsIC8v5b2T5YmN6aG16Z2i55qEdGV4dERpdueahOWAvCwg55So5p2l5YGa5q+U6L6D5Z+656GACiAgICAgIHNlbnRlbmNlczogW10sIC8v56ys5LiA5Liq55So5oi35o+Q5Lqk55qE56ys5LiA54mI5pys55qE5YiG5Y+l57uT5p6cCiAgICAgIHVzZXJuYW1lOiAiIiwKICAgICAgZGlmZkxpc3Q6IFtdLAogICAgICB0YWJsZURhdGE6IFtdLCAvL+WIhumhteebuOWFswogICAgICBzZW5UYWJsZURhdGE6IFtdLCAvL+WPpeWtkOeJiOacrOebuOWFswogICAgICBwYWdlc2l6ZTogMywgLy/kv67mlLnliIbpobXnm7jlhbMKICAgICAgY3VycnBhZ2U6IDEsIC8v5L+u5pS55YiG6aG155u45YWzCiAgICAgIHBhZ2VzaXplUzogMSwgLy/lj6XlrZDniYjmnKzliIbpobXnm7jlhbMKICAgICAgY3VycnBhZ2VTOiAxLCAvL+WPpeWtkOeJiOacrOWIhumhteebuOWFswogICAgICBpc0FjdGl2ZTogZmFsc2UsCiAgICAgIHNlZW46IGZhbHNlLAogICAgICB0ZW1waW5kZXg6IDAsCiAgICAgIGN1cnJlbnQ6IDAsCiAgICAgIGRpZmZJZDogIiIsIC8v5b2T5YmN5Lu75Yqh55qEX2lkCiAgICAgIGZpbGVOYW1lOiAiIiwKICAgICAgdXNlckxpc3Q6IFtdLAogICAgICBpblVzZXJMaXN0OiBmYWxzZSwKICAgICAgYXBpOiAiL2FwaSIsCiAgICAgIHBsYXllcjogIiIsIC8v5pKt5pS+5ZmoCiAgICAgIHJhdGVTZWxlY3RlZDogIjEuMCIsIC8v5pKt5pS+6YCf5bqmCiAgICAgIGlzVmlkZW86IGZhbHNlLCAvL+aWh+S7tuexu+Wei+aYr+WQpuS4uuinhumikQogICAgICB2aWRlb1R5cGU6IFsiQVZJIiwgImJhaXdtYSIsICJybXZiIiwgInJtIiwgImZsYXNoIiwgIm1wNCIsICJtaWQiLCAiM0dQIl0sIC8v6KeG6aKR57G75Z6LCiAgICAgIHNlbnRlbmNlTGlzdDogW10sIC8v6I635b6X5Y675o6J5qCH562+5LmL5ZCO5ZCE5Y+l5a2Q55qE57u85ZCI54mI5pys77yM6YGN5Y6G5aGr5YWF5L+u5pS55qGGCiAgICAgIGZpbmFsX2NvbnRleHQ6IFtdLAogICAgICBkYkxpc3Q6IFtdLAogICAgICByZWd0ZXN0OiAvWzxpbnM+fDxkZWw+fDxzdWJpbnM+XS9nLAogICAgICBsb2FkaW5nOiB0cnVlLCAvL+WKoOi9veWKqOeUuwogICAgICBwdWJsaXNoZXI6ICIiLAogICAgICBzdGF0dXM6ICIxIiwKICAgICAgaWRlbnRpdHk6ICIiLAogICAgICBzdWJtaXR0ZWQ6IFtdLCAvL+W3suaPkOS6pOS/ruaUueeahOWQjeWNlQogICAgICBpc0FkZGl0aW9uOiBmYWxzZSwgLy/mmK/lkKbmmL7npLrlop7liqDlj6XlrZDnmoTmlofmnKzmoYblkozmjInpkq4KICAgICAgYWRkaXRpb246ICIiLCAvL+WinuWKoOeahOWGheWuuQogICAgICBhdXRvcGxheTogZmFsc2UsIC8v5o6n5Yi26KeG6aKR6Ieq5Yqo5pKt5pS+CiAgICAgIHRhc2tUaXRsZTogIiIsCiAgICAgIGRlYWRsaW5lOiAiIiwKICAgICAgcHVibGlzaFRpbWU6ICIiLAogICAgICBpc1RpbWVsaW5lOiBmYWxzZSwKICAgICAgdmVyc2lvbnM6IFtdLAogICAgICByZXZlcnNlOiB0cnVlLAogICAgICB0YXNrTGFiZWxzOiBbXSwKICAgICAgdXNlcklkOiAiIiwKICAgICAgdmVyc2lvbnNMaXN0OiAiIiwgLy/lnKhjcmVhdGVk5Lit5LuO5ZCO5Y+w6I635Y+W5pWw5o2uCiAgICAgIHRlY2hTY29yZUxpc3Q6IHt9LCAvL+e7n+iuoeavj+S4quS6uuW+l+WIsOeahOaKgOacr+WIhgogICAgICBtYXRjaFNjb3JlTGlzdDoge30sIC8v57uf6K6h5q+P5Liq5Lq65b6X5Yiw55qE5Yy56YWN5YiGCiAgICAgIHRlY2hMaXN0OiBbXSwKICAgICAgbWF0Y2hMaXN0OiBbXSwKICAgICAgc2NvcmVMaXN0OiBbXSwgLy/mgLvliIYKICAgICAgY291bnRNYXRjaFNjb3JlczogW10sCiAgICAgIHRlY2hQb2ludHM6IDYwLCAvL+aAu+eahOaKgOacr+WIhgogICAgICBtYXRjaFBvaW50czogNDAsIC8v5oC755qE5Yy56YWN5YiGCiAgICAgIHNjb3JlczogIuWIhuaVsOaaguacquWFrOW4g++8jOaIquatouaXpeacn+WQjuWGjeadpeafpeeci+WQp34iLAogICAgICBhdmVyU2NvcmVzOiAiIiwgLy/lubPlnYfliIYKICAgICAgaXNQdWJsaXNoZXI6IGZhbHNlLAogICAgICBpc1N1Ym1pdHRlZDogZmFsc2UsCiAgICAgIHRhc2tDb2luczogMCwgLy/mr4/kuKrku7vliqHlj6/ojrflvpfnmoTph5HluIEKICAgICAgbXlSYW5rOiAiIiwKICAgICAgdGltZXNwYW46IDAsIC8vdmlkZW/mkq3mlL7lrp7pmYXml7bpl7QKICAgICAgaXNDb3VudFRpbWU6IGZhbHNlLCAvL+aYr+WQpuiuoeaXtgogICAgICBpc01hbnVhbDogIiIsIC8v5piv5ZCm6Ieq5Yqo6K6h566X5YiG5pWwCiAgICAgIGlzQ29uZmlybTogIiIsCiAgICB9OwogIH0sCiAgY29tcG9uZW50OiB7CiAgICBBdmF0YXIsCiAgfSwKICBtZXRob2RzOiB7CiAgICB0ZW1wc2F2ZSgpIHsKICAgICAgdGhpcy4kYXhpb3MKICAgICAgICAuZ2V0KHRoaXMuYXBpICsgIi9jdXJyZW50VGFzaz9faWQ9IiArIHRoaXMuZGlmZklkKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIHRoaXMudXNlckxpc3QgPSByZXMuZGF0YVswXS51c2VyTGlzdDsKICAgICAgICAgIHZhciBpc05hbWUgPSBmYWxzZTsKICAgICAgICAgIGZvciAodmFyIHVoID0gMDsgdWggPCB0aGlzLnVzZXJMaXN0Lmxlbmd0aDsgdWgrKykgewogICAgICAgICAgICBpZiAodGhpcy51c2VybmFtZSA9PSB0aGlzLnVzZXJMaXN0W3VoXS5uYW1lKSB7CiAgICAgICAgICAgICAgaXNOYW1lID0gdHJ1ZTsKICAgICAgICAgICAgICB0aGlzLnVzZXJMaXN0W3VoXS5teV9zZW50ZW5jZXMgPSB0aGlzLnNlbnRlbmNlTGlzdDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy/lpoLmnpzmsqHmnInliJnlop7liqAKICAgICAgICAgIGlmIChpc05hbWUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgdGhpcy51c2VyTGlzdC5wdXNoKHsKICAgICAgICAgICAgICBuYW1lOiB0aGlzLnVzZXJuYW1lLAogICAgICAgICAgICAgIG15X3NlbnRlbmNlczogdGhpcy5zZW50ZW5jZUxpc3QsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuJGF4aW9zLnBvc3QodGhpcy5hcGkgKyAiL3RlbXBzYXZlIiwgewogICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICBfaWQ6IHRoaXMuZGlmZklkLAogICAgICAgICAgICAgIHVzZXJMaXN0OiB0aGlzLnVzZXJMaXN0LAogICAgICAgICAgICB9LAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICAgIG1lc3NhZ2U6ICLmmoLml7bkv53lrZjmiJDlip8iLAogICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgIG9mZnNldDogMTAwLAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmlzZWRpdCA9IGZhbHNlOwogICAgICAgIH0pOwogICAgfSwKICAgIHJldHVybmJhY2soKSB7CiAgICAgIGlmICh0aGlzLnN1Ym1pdHRlZC5pbmRleE9mKHRoaXMudXNlcm5hbWUpID49IDApIHsKICAgICAgICBpZiAodGhpcy5zdWJtaXR0ZWQuaW5kZXhPZih0aGlzLnVzZXJuYW1lKSA9PSAwKSB7CiAgICAgICAgICBpZiAodGhpcy5zdWJtaXR0ZWQuaW5kZXhPZih0aGlzLnVzZXJuYW1lLCAxKSA9PSAtMSkgewogICAgICAgICAgICB2YXIgdXNlcl9pbmRleCA9IHRoaXMudXNlckxpc3QuZmluZEluZGV4KAogICAgICAgICAgICAgIChhdHRyKSA9PiBhdHRyLm5hbWUgPT0gdGhpcy51c2VybmFtZQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAodXNlcl9pbmRleCA+PSAwKSB7CiAgICAgICAgICAgICAgdGhpcy5pc2VkaXQgPSB0cnVlOwogICAgICAgICAgICAgIHRoaXMuc2VudGVuY2VMaXN0ID0gdGhpcy51c2VyTGlzdFt1c2VyX2luZGV4XS5teV9zZW50ZW5jZXM7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5pc2VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICAgICAgLy8gdGl0bGU6ICLorablkYoiLAogICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgbWVzc2FnZTogIuaKseatie+8jOayoeacieaCqOeahOWOhuWPsuiusOW9le+8gSIsCiAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5pc2VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgICAvLyB0aXRsZTogIuitpuWRiiIsCiAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICLmirHmrYnvvIzmgqjlt7Lmj5DkuqTov4fvvIEiLAogICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuaXNlZGl0ID0gZmFsc2U7CiAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICAvLyB0aXRsZTogIuitpuWRiiIsCiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgbWVzc2FnZTogIuaKseatie+8jOaCqOW3suaPkOS6pOi/h++8gSIsCiAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICAgICAgb2Zmc2V0OiAxMDAsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHVzZXJfaW5kZXggPSB0aGlzLnVzZXJMaXN0LmZpbmRJbmRleCgKICAgICAgICAgIChhdHRyKSA9PiBhdHRyLm5hbWUgPT0gdGhpcy51c2VybmFtZQogICAgICAgICk7CiAgICAgICAgaWYgKHVzZXJfaW5kZXggPj0gMCkgewogICAgICAgICAgdGhpcy5zZW50ZW5jZUxpc3QgPSB0aGlzLnVzZXJMaXN0W3VzZXJfaW5kZXhdLm15X3NlbnRlbmNlczsKICAgICAgICAgIHRoaXMuaXNlZGl0ID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5pc2VkaXQgPSBmYWxzZTsKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgIC8vIHRpdGxlOiAi6K2m5ZGKIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBtZXNzYWdlOiAi5oqx5q2J77yM5rKh5pyJ5oKo55qE5Y6G5Y+y6K6w5b2V77yBIiwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHNob3dUaW1lbGluZSgpIHsKICAgICAgdGhpcy4kYXhpb3MKICAgICAgICAuZ2V0KHRoaXMuYXBpICsgIi9hbGxWZXJzaW9ucz9faWQ9IiArIHRoaXMuZGlmZklkKQogICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJyZXMgZGF0YSIsIHJlcy5kYXRhKTsKICAgICAgICAgIHRoaXMudmVyc2lvbnMgPSByZXMuZGF0YTsKICAgICAgICAgIGlmICh0aGlzLnZlcnNpb25zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgdGhpcy5pc1RpbWVsaW5lID0gdHJ1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgLy8gdGl0bGU6ICLorablkYoiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBtZXNzYWdlOiAi5b2T5YmN5Lu75Yqh6L+Y5rKh5pyJ5Lq65a6M5oiQIiwKICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgICAgb2Zmc2V0OiAxMDAsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgfSwKICAgIGNsb3NlVGltZWxpbmUoKSB7CiAgICAgIHRoaXMuaXNUaW1lbGluZSA9IGZhbHNlOwogICAgfSwKICAgIC8v5L2/55SoZG9jdW1lbnQucXVlcnlTZWxlY3RvcuWunueOsOmUmueCueeahOaViOaenAogICAgdG9CZXN0KGlkTmFtZSkgewogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGlkTmFtZSkuc2Nyb2xsSW50b1ZpZXcodHJ1ZSk7CiAgICB9LAogICAgLy/lm57liLDpobbpg6gKICAgIHRvVG9wKCkgewogICAgICBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgPSAwOwogICAgfSwKICAgIC8v5rWu5qGGCiAgICBjaGFuZ2VQb3MoZXZlbnQpIHsKICAgICAgdmFyIHdvcmRPcGVyYXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndvcmRPcGVyYXRlIik7CiAgICAgIHdvcmRPcGVyYXRlLnN0eWxlLnBvc2l0aW9uID0gImZpeGVkIjsKICAgICAgd29yZE9wZXJhdGUuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOwogICAgICB3b3JkT3BlcmF0ZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAid2hpdGUiOwogICAgICBpZiAoZXZlbnQuY2xpZW50WCA8IHdpbmRvdy5zY3JlZW4ud2lkdGggLyAyKSB7CiAgICAgICAgd29yZE9wZXJhdGUuc3R5bGUubGVmdCA9IGV2ZW50LmNsaWVudFggKyA1ICsgInB4IjsKICAgICAgfSBlbHNlIHsKICAgICAgICB3b3JkT3BlcmF0ZS5zdHlsZS5sZWZ0ID0gZXZlbnQuY2xpZW50WCAtIHdvcmRPcGVyYXRlLm9mZnNldFdpZHRoICsgInB4IjsKICAgICAgfQoKICAgICAgaWYgKGV2ZW50LmNsaWVudFkgPiB3aW5kb3cuc2NyZWVuLmhlaWdodCAvIDIpIHsKICAgICAgICB3b3JkT3BlcmF0ZS5zdHlsZS50b3AgPSBldmVudC5jbGllbnRZIC0gd29yZE9wZXJhdGUub2Zmc2V0SGVpZ2h0ICsgInB4IjsKICAgICAgfSBlbHNlIHsKICAgICAgICB3b3JkT3BlcmF0ZS5zdHlsZS50b3AgPSBldmVudC5jbGllbnRZICsgInB4IjsKICAgICAgfQogICAgfSwKICAgIC8v56Gu5a6a5piv6Z+z6aKR5pKt5pS+5Zmo6L+Y5piv6KeG6aKR5pKt5pS+5ZmoCiAgICBkZWNpZGVQbGF5ZXIoKSB7CiAgICAgIGlmICh0aGlzLmlzVmlkZW8pIHsKICAgICAgICB0aGlzLnBsYXllciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN2aWRlbyA+IHZpZGVvIik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5wbGF5ZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYXVkaW8iKTsKICAgICAgfQogICAgfSwKICAgIC8v5o6n5Yi25pKt5pS+6YCf5bqmCiAgICAvLyBoYW5kbGVTcGVlZCgpIHsKICAgIC8vICAgdGhpcy5wbGF5ZXIucGxheWJhY2tSYXRlID0gdGhpcy5yYXRlU2VsZWN0ZWQ7CiAgICAvLyB9LAogICAgLy/mjqfliLblkI7pgIAxMOenkgogICAgZ29CYWNrKCkgewogICAgICB0aGlzLnBsYXllci5jdXJyZW50VGltZSAtPSAxMDsKICAgIH0sCiAgICAvL+aOp+WItuWJjei/mzEw56eSCiAgICBnb0ZvcndhcmQoKSB7CiAgICAgIHRoaXMucGxheWVyLmN1cnJlbnRUaW1lICs9IDEwOwogICAgfSwKICAgIC8v5YiG6aG155u45YWzCiAgICBoYW5kbGVDdXJyZW50Q2hhbmdlKHZhbCkgewogICAgICB0aGlzLmN1cnJwYWdlID0gdmFsOwogICAgfSwKICAgIC8v5YiG6aG155u45YWzCiAgICBoYW5kbGVTaXplQ2hhbmdlKHZhbCkgewogICAgICB0aGlzLnBhZ2VzaXplID0gdmFsOwogICAgfSwKICAgIC8v5YiG6aG155u45YWzCiAgICBoYW5kbGVDdXJyZW50Q2hhbmdlUyh2YWwpIHsKICAgICAgdGhpcy5jdXJycGFnZVMgPSB2YWw7CiAgICB9LAogICAgLy/liIbpobXnm7jlhbMKICAgIGhhbmRsZVNpemVDaGFuZ2VTKHZhbCkgewogICAgICB0aGlzLnBhZ2VzaXplUyA9IHZhbDsKICAgIH0sCiAgICAvL+aPkOS6pOesrOS4gOS7ve+8jOWPquaJp+ihjOS4gOasoe+8jOS9huS8muWGs+WumuaVsOaNruW6k+eahOe7k+aehAogICAgc3VibWl0djEoKSB7CiAgICAgIC8v6I635b6X5b2T5YmN5pe26Ze0CiAgICAgIC8vIGxldCBkYXRlID0gbmV3IERhdGUoKTsKICAgICAgLy8gbGV0IG5ld2RhdGUgPSBkYXRlLnRvTG9jYWxlU3RyaW5nKCJjaGluZXNlIiwgewogICAgICAvLyAgIGhvdXIxMjogZmFsc2UsCiAgICAgIC8vIH0pOwoKICAgICAgbGV0IG5ld2RhdGU9dGhpcy4kbW9tZW50KG5ldyBEYXRlKCkpLmZvcm1hdCgiWVlZWS9NTS9ERCBISDptbTpzcyIpCgogICAgICB2YXIgZmxhZyA9IHRydWU7CiAgICAgIHZhciByZWdzdHIgPSAvKFtBLVphLXowLTlcJ1wiXCFcP1wtXDpcO1wuXCxcJVwkXCZcWyBcXV0pLzsKICAgICAgdmFyIGxpbWl0ZWRfd29yZHMgPSAwOwogICAgICB0aGlzLiRheGlvcwogICAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRUYXNrP19pZD0iICsgdGhpcy5kaWZmSWQpCiAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgbGltaXRlZF93b3JkcyA9IHJlcy5kYXRhWzBdLndvcmRzOwogICAgICAgICAgLy8gY29uc29sZS5sb2cobGltaXRlZF93b3Jkcyk7CiAgICAgICAgICB2YXIgdmlkZW9faWQgPSByZXMuZGF0YVswXS52aWRlb0lkOyAvL+WvueW6lOinhumikeeahF9pZAogICAgICAgICAgdmFyIGF1dGhjb2RlID0gcmVzLmRhdGFbMF0uYXV0aGNvZGU7IC8v5a+55bqU5Lu75Yqh55qE6aqM6K+B56CBCiAgICAgICAgICAvL+i+k+WFpeeahOWGheWuuemdnuepugogICAgICAgICAgaWYgKHRoaXMudGV4dDEpIHsKICAgICAgICAgICAgdmFyIHRfbGVuZ3RoID0gdGhpcy50ZXh0MS5zcGxpdCgiICIpLmxlbmd0aDsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2codF9sZW5ndGgpCiAgICAgICAgICAgIGlmICh0X2xlbmd0aCA+IGxpbWl0ZWRfd29yZHMpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IHRoaXMudGV4dDEubGVuZ3RoOyBhKyspIHsKICAgICAgICAgICAgICAgIHZhciByZWdSZXN1bHQgPSByZWdzdHIudGVzdCh0aGlzLnRleHQxW2FdKTsKICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCItLS0tLTEiLCByZWdSZXN1bHQpOwogICAgICAgICAgICAgICAgaWYgKHJlZ1Jlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImFhYSIpOwogICAgICAgICAgICAgICAgICBmbGFnID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJmbGFnIiwgZmxhZyk7CiAgICAgICAgICAgICAgaWYgKGZsYWcpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgICAgICAgIC5wb3N0KHRoaXMuYXBpICsgIi91cGRhdGVWZXJzaW9uIiwgewogICAgICAgICAgICAgICAgICAgIC8v5pW056+H5pu05paw5Yiw54mI5pys5YiX6KGoCiAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgICBfaWQ6IHRoaXMuZGlmZklkLAogICAgICAgICAgICAgICAgICAgICAgdGltZTogbmV3ZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgIG5ld192ZXJzaW9uOiB0aGlzLnRleHQxLAogICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgIC50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiYWFhIik7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kYXhpb3MKICAgICAgICAgICAgICAgICAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRUYXNrP19pZD0iICsgdGhpcy5kaWZmSWQpCiAgICAgICAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCIxMTEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaWZmTGlzdCA9IHJlcy5kYXRhWzBdLmRpZmZMaXN0OwogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZGlmZkxpc3QxIiwgdGhpcy5kaWZmTGlzdCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VyTGlzdCA9IHJlcy5kYXRhWzBdLnVzZXJMaXN0OwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5kaWZmTGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0KHRoaXMuYXBpICsgIi9hbGxWZXJzaW9ucz9faWQ9IiArIHRoaXMuZGlmZklkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygicmVzIGRhdGEiLCByZXMuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvd25lciA9IHJlcy5kYXRhWzBdLm5hbWU7IC8v56ys5LiA5Liq5o+Q5Lqk55qE55So5oi3CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvd25lciA9PSB0aGlzLnVzZXJuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLlrozmiJDlkKzlhpnojrflvpc16YeR5biB77yM56ys5LiA5Liq5a6M5oiQ6aKd5aSW5YaN6I635b6XNemHkeW4gSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJMaXN0LmluZGV4T2YoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudXNlckxpc3QuZmluZCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAob2JqKSA9PiBvYmoubmFtZSA9PSBvd25lcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApID09IC0xCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJMaXN0LnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBvd25lciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXlfc2VudGVuY2VzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdHRlZC5wdXNoKG93bmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRheGlvcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcGkgKyAiL3Byb2ZpbGU/bmFtZT0iICsgdGhpcy51c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcklkID0gcmVzLmRhdGFbMF0uX2lkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlclRhc2tzID0gcmVzLmRhdGFbMF0ubXlUYXNrczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlclRhc2tzLnB1c2goewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tJZDogdGhpcy5kaWZmSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW9JZDogdmlkZW9faWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVhZGxpbmU6IHRoaXMuZGVhZGxpbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aGNvZGU6IGF1dGhjb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiB0aGlzLnRhc2tUaXRsZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogdGhpcy50YXNrTGFiZWxzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcmVzOiAiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIOabtOaWsOeUqOaIt+KAnG15VGFza3PigJ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kYXhpb3MucG9zdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwaSArICIvdXBkYXRlTXlUYXNrcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9pZDogdXNlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBteVRhc2tzOiB1c2VyVGFza3MsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aXRsZTogIuitpuWRiiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi6Z2e5bi46YGX5oa+77yM5bey5pyJ5YW25LuW55So5oi35o+Q5Lqk5b2T5YmN5Lu75Yqh55qE56ysMeS4queJiOacrO+8geS4i+asoeWKoOayuSjguIcg4oCiX+KAoinguIciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAxMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc3ZlcnNpb24xID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy50ZXh0X3YxID0gcmVzLmRhdGFbMF0udmVyc2lvbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGRpZmZMaXN0MSA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL+WIhuWPpeW5tuWtmOWCqOWIsOaVsOaNruW6k+S4rQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNlbnRlbmNlcyA9IHRoaXMudGV4dF92MS5zcGxpdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKD88PVteQS1aXS5bLj9dKSArKD89W0EtWl0pL2cKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy5zZW50ZW5jZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZW4gPSAwOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbiA8IHRoaXMuc2VudGVuY2VzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW4rKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgd29yZHMgPSB0aGlzLnNlbnRlbmNlc1tzZW5dLnNwbGl0KCIgIik7IC8v5YiG6K+NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy/ljrvmjonnqbrlgLwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHdvcmRzLmxlbmd0aDsgeSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAod29yZHNbeV0gPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHMuc3BsaWNlKHksIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB5ID0geSAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB3b3JkX2xpc3QgPSBbXTsgLy/liIbor43liJfooajvvIzljIXmi6znlKjmiLfliJfooagKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZXMgPSBuZXcgQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcl9pdGVtID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0dGltZTogbmV3ZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzLnB1c2godXNlcl9pdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciB3b3IgPSAwOyB3b3IgPCB3b3Jkcy5sZW5ndGg7IHdvcisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgd29yZEl0ZW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluZGV4OiB3b3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQ6IHdvcmRzW3dvcl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmZzOiBbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZjogd29yZHNbd29yXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzOiBuYW1lcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bTogMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDAsIC8vMD0+5Y6f6K+N77yM5rKh5L+u5pS577yM5Yid5aeL5YC877ybMT0+5aKe5Yqg77ybMj0+5pyJ5aKe5pyJ5Yig77ybLTE9PuWIoOmZpAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzZWRpdGVkOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNmaXJzdDogdHJ1ZSwgLy/nm7jlr7nnrKzkuIDniYjvvIznlKjkuo7ljLrliIbmlLnniYjmmK/lkKbkuLrlop7liqDnmoTlhoXlrrkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkX2xpc3QucHVzaCh3b3JkSXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5paw5pS55YqoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbnRlbmNlX2l0ZW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50ZW5jZXM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyOiB0aGlzLnVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRlbmNlOiB0aGlzLnNlbnRlbmNlc1tzZW5dLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZHM6IHdvcmRfbGlzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcjogdGhpcy51c2VybmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRlbmNlRGlmZnM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGVyOiB0aGlzLnVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRlbmNlRGlmZjogdGhpcy5zZW50ZW5jZXNbc2VuXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmTGlzdDEucHVzaChzZW50ZW5jZV9pdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXNlcl9pbmRleCA9IHRoaXMudXNlckxpc3QuZmluZEluZGV4KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChhdHRyKSA9PiBhdHRyLm5hbWUgPT0gdGhpcy51c2VybmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnVzZXJMaXN0WwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfaW5kZXgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXS5teV9zZW50ZW5jZXMgPSB0aGlzLnNlbnRlbmNlczsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImRlZmZMaXN0MiIsIGRpZmZMaXN0MSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kYXhpb3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucG9zdCh0aGlzLmFwaSArICIvdXBkYXRlZGlmZiIsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8v5bCG5YiG6K+N5YiG5Y+l57uT5p6c5pu05paw5Yiw5pWw5o2u5bqTCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2lkOiB0aGlzLmRpZmZJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZkxpc3Q6IGRpZmZMaXN0MSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlckxpc3Q6IHRoaXMudXNlckxpc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdHRlZDogdGhpcy5zdWJtaXR0ZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIi0tLS0tLS0iICsgcmVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmNyZWF0ZUZpbmFsVmVyc2lvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY3JlYXRlRmluYWxWZXJzaW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc3ZlcnNpb24xID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmlzRmluYWwgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgIC8v5b2i5oiQ57u85ZCI54mI5pysCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLmdvKDApOwogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuY3JlYXRlRmluYWxWZXJzaW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRpdGxlOiAi6K2m5ZGKIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLpnZ7luLjpgZfmhr7vvIzlt7LmnInlhbbku5bnlKjmiLfmj5DkuqTlvZPliY3ku7vliqHnmoTnrKwx5Liq54mI5pys77yB5LiL5qyh5Yqg5rK5KOC4hyDigKJf4oCiKeC4hyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKDApOwogICAgICAgICAgICAgICAgLy8gdGhpcy5jcmVhdGVGaW5hbFZlcnNpb24oKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZmxhZyk7CiAgICAgICAgICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgICAgICAgICAvLyB0aXRsZTogIuitpuWRiiIsCiAgICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgICAgbWVzc2FnZTogIuaPkOS6pOWGheWuueWMheWQq+mdnuazleWtl+espu+8jOivt+ajgOafpeS/ruaUueWQjuWGjeaPkOS6pO+8gSIsCiAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICAgICAgICAgICAgb2Zmc2V0OiAxMDAsCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgICAgIC8vIHRpdGxlOiAi6K2m5ZGKIiwKICAgICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICLlrZfmlbDlsJHkuo7lvZPliY3ku7vliqHpmZDliLbnmoQiICsgbGltaXRlZF93b3JkcyArICLor43vvIEiLAogICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgICAgb2Zmc2V0OiAxMDAsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8v6L6T5YWl55qE5YaF5a655Li656m6CiAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgLy8gdGl0bGU6ICLorablkYoiLAogICAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgICBtZXNzYWdlOiAi6K+36YeN5paw56Gu6K6k77yM5oKo5bm25pyq6L6T5YWl5YaF5a655ZOmfiIsCiAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgIG9mZnNldDogMTAwLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgLy8gdGhpcy4kcm91dGVyLmdvKDApOyAvL+WIt+aWsOmhtemdogogICAgfSwKICAgIC8v5omT5byA5aKe5Yqg5Y+l5a2Q57yW6L6R6Z2i5p2/CiAgICBlZGl0djEoKSB7CiAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgdGl0bGU6ICJUaXAiLAogICAgICAgIG1lc3NhZ2U6ICLmr4/mrKHlj6rog73lop7liqDkuIDkuKrlj6XlrZDlk6bvvIEiLAogICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgfSk7CiAgICAgIHRoaXMuaXNBZGRpdGlvbiA9IHRydWU7CiAgICAgIHRoaXMuYWRkaXRpb24gPSAiIjsKICAgIH0sCiAgICAvL+eCueWHu+S/ruaUueaMiemSrgogICAgY2hhbmdldjEoKSB7CiAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgLmdldCh0aGlzLmFwaSArICIvY3VycmVudFRhc2s/X2lkPSIgKyB0aGlzLmRpZmZJZCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAvLyB0aGlzLnN1Ym1pdHRlZCA9IHJlcy5kYXRhWzBdLnN1Ym1pdHRlZDsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJjaGFuZ2V2MSBzdWJtaXR0ZWQiLCB0aGlzLnN1Ym1pdHRlZCk7CiAgICAgICAgICBpZiAodGhpcy5zdWJtaXR0ZWQuaW5kZXhPZih0aGlzLnVzZXJuYW1lKSA+PSAwKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKAogICAgICAgICAgICAvLyAgICJ0aGlzLnN1Ym1pdHRlZC5pbmRleE9mKHRoaXMudXNlcm5hbWUpIiwKICAgICAgICAgICAgLy8gICB0aGlzLnN1Ym1pdHRlZC5pbmRleE9mKHRoaXMudXNlcm5hbWUpCiAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKAogICAgICAgICAgICAvLyAgICJ0aGlzLnN1Ym1pdHRlZC5pbmRleE9mKHRoaXMudXNlcm5hbWUsIDEpIiwKICAgICAgICAgICAgLy8gICB0aGlzLnN1Ym1pdHRlZC5pbmRleE9mKHRoaXMudXNlcm5hbWUsIDEpCiAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgIGlmICh0aGlzLnN1Ym1pdHRlZC5pbmRleE9mKHRoaXMudXNlcm5hbWUpID09IDApIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zdWJtaXR0ZWQuaW5kZXhPZih0aGlzLnVzZXJuYW1lLCAxKSA9PSAtMSkgewogICAgICAgICAgICAgICAgLy/ngrnlh7vkv67mlLnmjInpkq4KICAgICAgICAgICAgICAgIHRoaXMuaXNlZGl0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIC8v5b2T5YmN55So5oi36KaB5o+Q5Lqk55qE54mI5pysCiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGV4dERpdiIpLmlubmVySFRNTCk7CiAgICAgICAgICAgICAgICB0aGlzLnRleHREaXYgPSBkb2N1bWVudAogICAgICAgICAgICAgICAgICAuZ2V0RWxlbWVudEJ5SWQoInRleHREaXYiKQogICAgICAgICAgICAgICAgICAuaW5uZXJIVE1MLnJlcGxhY2UoLyg8c3BhbltePl0qPz4pfCg8XC9zcGFuPikvZywgIiIpOwogICAgICAgICAgICAgICAgLy/nlKjkuo7mr5TovoPnmoTmlofmnKzvvIzljrvpmaTmoIfnrb4KICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudENvbXBhcmVUZXh0ID0gZG9jdW1lbnQKICAgICAgICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKCJ0ZXh0RGl2IikKICAgICAgICAgICAgICAgICAgLmlubmVySFRNTC5yZXBsYWNlKC8oPHNwYW5bXj5dKj8+KXwoPFwvc3Bhbj4pL2csICIiKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5pc2VkaXQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgICAgIC8vIHRpdGxlOiAi6K2m5ZGKIiwKICAgICAgICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICAgICAgICBtZXNzYWdlOiAi5oqx5q2J77yM5oKo55qE5o+Q5Lqk5py65Lya5bey55So5a6M77yBIiwKICAgICAgICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmlzZWRpdCA9IGZhbHNlOwogICAgICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgICAgICAvLyB0aXRsZTogIuitpuWRiiIsCiAgICAgICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAi5oqx5q2J77yM5oKo55qE5o+Q5Lqk5py65Lya5bey55So5a6M77yBIiwKICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAidG9wLXJpZ2h0IiwKICAgICAgICAgICAgICAgIG9mZnNldDogMTAwLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL+eCueWHu+S/ruaUueaMiemSrgogICAgICAgICAgICB0aGlzLmlzZWRpdCA9IHRydWU7CiAgICAgICAgICAgIC8v5b2T5YmN55So5oi36KaB5o+Q5Lqk55qE54mI5pysCiAgICAgICAgICAgIHRoaXMudGV4dERpdiA9IGRvY3VtZW50CiAgICAgICAgICAgICAgLmdldEVsZW1lbnRCeUlkKCJ0ZXh0RGl2IikKICAgICAgICAgICAgICAuaW5uZXJIVE1MLnJlcGxhY2UoLyg8c3BhbltePl0qPz4pfCg8XC9zcGFuPikvZywgIiIpOwoKICAgICAgICAgICAgLy/nlKjkuo7mr5TovoPnmoTmlofmnKzvvIzljrvpmaTmoIfnrb4KICAgICAgICAgICAgdGhpcy5jdXJyZW50Q29tcGFyZVRleHQgPSBkb2N1bWVudAogICAgICAgICAgICAgIC5nZXRFbGVtZW50QnlJZCgidGV4dERpdiIpCiAgICAgICAgICAgICAgLmlubmVySFRNTC5yZXBsYWNlKC8oPHNwYW5bXj5dKj8+KXwoPFwvc3Bhbj4pL2csICIiKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0sCiAgICAvL+WPlua2iOS/ruaUuQogICAgY2FuY2VsQ2hhbmdldjEoKSB7CiAgICAgIHRoaXMuaXNlZGl0ID0gZmFsc2U7CiAgICB9LAogICAgLy/noa7lrprmlbDnu4Tph4zmmK/lkKbmnInmn5DkuKrlhYPntKAKICAgIGZpbmRFbGVtKGFycmF5VG9TZWFyY2gsIGF0dHIsIHZhbCkgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5VG9TZWFyY2gubGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAoYXJyYXlUb1NlYXJjaFtpXVthdHRyXSA9PSB2YWwpIHsKICAgICAgICAgIHJldHVybiBpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gLTE7CiAgICB9LAogICAgLy/mj5DkuqTlvZPliY3nlKjmiLfnmoTniYjmnKwKICAgIHN1Ym1pdG12KCkgewogICAgICB0aGlzLiRjb25maXJtKCLnlKjmiLflj6rog73mj5DkuqTkuIDmrKEsIOaYr+WQpue7p+e7rT8iLCAi5o+Q56S6IiwgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAi56Gu5a6aIiwKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAi5Y+W5raIIiwKICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgY2VudGVyOiB0cnVlLAogICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICB2YXIgZmxhZzEgPSB0cnVlOwogICAgICAgIHZhciByZWdzdHIgPSAvKFtBLVphLXowLTlcJ1wiXCFcP1w6XC1cO1wuXCxcJVwkXCZcWyBcXV0pLzsKICAgICAgICBmb3IgKHZhciBzbCA9IDA7IHNsIDwgdGhpcy5zZW50ZW5jZUxpc3QubGVuZ3RoOyBzbCsrKSB7CiAgICAgICAgICAvL+avj+S4quWPpeWtkAogICAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCB0aGlzLnNlbnRlbmNlTGlzdFtzbF0ubGVuZ3RoOyBjKyspIHsKICAgICAgICAgICAgdmFyIHJlZ1Jlc3VsdCA9IHJlZ3N0ci50ZXN0KHRoaXMuc2VudGVuY2VMaXN0W3NsXVtjXSk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCIrKysrKzMiLCByZWdSZXN1bHQpOwogICAgICAgICAgICBpZiAocmVnUmVzdWx0ID09PSBmYWxzZSkgewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJjY2MiKTsKICAgICAgICAgICAgICBmbGFnMSA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIGNvbnNvbGUubG9nKCJmbGFnMSIsIGZsYWcxKTsKICAgICAgICBpZiAoZmxhZzEpIHsKICAgICAgICAgIC8v6I635b6X5b2T5YmN5pe26Ze0CiAgICAgICAgICAvLyBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAvLyBsZXQgbmV3ZGF0ZSA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoImNoaW5lc2UiLCB7CiAgICAgICAgICAvLyAgIGhvdXIxMjogZmFsc2UsCiAgICAgICAgICAvLyB9KTsKICAgICAgICAgIGxldCBuZXdkYXRlPXRoaXMuJG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoIllZWVkvTU0vREQgSEg6bW06c3MiKQogICAgICAgICAgLy/ojrflvpfmnIDmlrDnmoTkv67mlLnliJfooagKICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRUYXNrP19pZD0iICsgdGhpcy5kaWZmSWQpCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmRiTGlzdCA9IHJlcy5kYXRhWzBdLmRpZmZMaXN0OwogICAgICAgICAgICB9KTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkYkRpZmZMaXN0IiwgdGhpcy5kYkxpc3QpOwogICAgICAgICAgLy8gY29uc29sZS5sb2coInNlbnRlbmNlTGlzdCIsIHRoaXMuc2VudGVuY2VMaXN0KTsKICAgICAgICAgIHZhciBsaXN0TGVuID0gdGhpcy5kYkxpc3QubGVuZ3RoOwogICAgICAgICAgLy/kuI7nrKzkuIDniYjmnKzmr5TovoPvvIzmoLnmja7lj6XlrZDnmoTmlbDph4/ov5vooYzlvqrnjq/vvIjkv67mlLnlkI7mj5DkuqTlhoXlrrnlr7nlupTnmoTlj6XlrZDvvIkKICAgICAgICAgIHZhciBmaW5hbF9yZXN1bHQgPSBbXTsgLy/orrDlvZXmiYDmnInnmoTkv67mlLnmg4XlhrUKICAgICAgICAgIGZvciAodmFyIGxlbiA9IDA7IGxlbiA8IGxpc3RMZW47IGxlbisrKSB7CiAgICAgICAgICAgIHZhciBzZW5fcmVzdWx0ID0gW107IC8v6K6w5b2V5b2T5YmN5Y+l5a2Q55qE5L+u5pS55oOF5Ya1CiAgICAgICAgICAgIHZhciBzZW50ZW5jZSA9IHRoaXMuc2VudGVuY2VMaXN0W2xlbl0KICAgICAgICAgICAgICAucmVwbGFjZSgvXHN7Mix9L2csICIgIikKICAgICAgICAgICAgICAucmVwbGFjZSgvW1xyXG5dL2csICIgIikKICAgICAgICAgICAgICAucmVwbGFjZSgvKFxyXG58XG58XHIpL2csICIgIik7CiAgICAgICAgICAgIC8v5paw5pS55Yqo77ya5o2i5oiQ6LefIOacgOaWsOeJiOacrCDnmoQg56ys5LiA54mI5pys5Y+l5a2QIOavlOi+gwogICAgICAgICAgICB2YXIgdjFfc2VudGVuY2VzID0gdGhpcy5kYkxpc3RbbGVuXS5zZW50ZW5jZXMuc29ydCgKICAgICAgICAgICAgICB0aGlzLmNvbXBhcmUoInRpbWUiKQogICAgICAgICAgICApOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygidjFfc2VudGVuY2VzIiwgdjFfc2VudGVuY2VzKTsKICAgICAgICAgICAgdmFyIHYxX3NlbnRlbmNlID0gdjFfc2VudGVuY2VzW3YxX3NlbnRlbmNlcy5sZW5ndGggLSAxXS5zZW50ZW5jZTsKICAgICAgICAgICAgdmFyIHNfcmVzdWx0MSA9IGRpZmZlcgogICAgICAgICAgICAgIC5wYXJzZSgiICIgKyB2MV9zZW50ZW5jZSwgIiAiICsgc2VudGVuY2UpCiAgICAgICAgICAgICAgLnJlcGxhY2UoLyUyQy9nLCAiLCIpCiAgICAgICAgICAgICAgLnJlcGxhY2UoLyUzRi9nLCAiPyIpCiAgICAgICAgICAgICAgLnJlcGxhY2UoLyUyNy9nLCAiJyIpCiAgICAgICAgICAgICAgLnJlcGxhY2UoLyUzQS9nLCAiOiIpOwogICAgICAgICAgICAvL+WwhuWNleeLrOeahGluc+agh+etvuabv+aNouS4umRlbC1pbnPmoIfnrb4KICAgICAgICAgICAgLy8gY29uc29sZS5sb2coInNfcmVzdWx0MSIsIHNfcmVzdWx0MSk7CiAgICAgICAgICAgIHZhciByZWcgPSAvKFthLXpBLVowLTldK1tcLVwnXC5cOl0/W2EtekEtWjAtOV0qXHMoPGluc1tePl0qPz4uKj88XC9pbnM+XHMpKykvZzsKICAgICAgICAgICAgdmFyIGluc01hdGNoUmVzdWx0ID0gc19yZXN1bHQxLm1hdGNoKHJlZyk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJpbnNNYXRjaFJlc3VsdCIsIGluc01hdGNoUmVzdWx0KTsKICAgICAgICAgICAgaWYgKGluc01hdGNoUmVzdWx0ICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBpbnNNYXRjaFJlc3VsdC5sZW5ndGg7IG0rKykgewogICAgICAgICAgICAgICAgLy/ljrvmjonnqbrnmoTljLnphY3nu5PmnpwKICAgICAgICAgICAgICAgIGlmIChpbnNNYXRjaFJlc3VsdFttXSA9PSAiIikgewogICAgICAgICAgICAgICAgICBpbnNNYXRjaFJlc3VsdC5zcGxpY2UobSwgMSk7CiAgICAgICAgICAgICAgICAgIG0gPSBtIC0gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHNfcmVzdWx0MSA9IHNfcmVzdWx0MS5yZXBsYWNlKGluc01hdGNoUmVzdWx0W21dLCAiPD4iKTsgLy/mm7/mjaLmiJDnibnmrornmoTnrKblj7cg5Y2g5L2NCiAgICAgICAgICAgICAgICAgIHZhciBkZWxfY29udGVudCA9IGluc01hdGNoUmVzdWx0W21dLnNwbGl0KCIgIilbMF07IC8v5Y6f6K+NCiAgICAgICAgICAgICAgICAgIHZhciBlZGl0ZWRfdmVyID0KICAgICAgICAgICAgICAgICAgICAiPGRlbD4iICsKICAgICAgICAgICAgICAgICAgICBkZWxfY29udGVudCArCiAgICAgICAgICAgICAgICAgICAgIjwvZGVsPiA8aW5zPiIgKwogICAgICAgICAgICAgICAgICAgIGRlbF9jb250ZW50ICsKICAgICAgICAgICAgICAgICAgICAiPC9pbnM+IjsKICAgICAgICAgICAgICAgICAgaW5zTWF0Y2hSZXN1bHRbbV0gPSBpbnNNYXRjaFJlc3VsdFttXS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgIGRlbF9jb250ZW50LAogICAgICAgICAgICAgICAgICAgIGVkaXRlZF92ZXIKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNfcmVzdWx0MSA9IHNfcmVzdWx0MQogICAgICAgICAgICAgICAgICAucmVwbGFjZSgiPD4iLCBpbnNNYXRjaFJlc3VsdFttXSkKICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoLyhcclxufFxufFxyKS9nLCAiICIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiYWZ0ZXIiLCBzX3Jlc3VsdDEpOwogICAgICAgICAgICB2YXIgc19yZXN1bHRfZGVsID0gc19yZXN1bHQxCiAgICAgICAgICAgICAgLnJlcGxhY2UoLzxpbnNbXj5dKj8+Lio/PFwvaW5zPlxzL2csICIiKQogICAgICAgICAgICAgIC5yZXBsYWNlKC8oXHJcbnxcbnxccikvZywgIiAiKTsKICAgICAgICAgICAgLy/ljrvmjonmiYDmnIlpbnPmoIfnrb7vvIznlKjkuo7noa7orqRkZWzmoIfnrb7nmoRpbmRleAogICAgICAgICAgICB2YXIgc19yZXN1bHRfYXJyID0gc19yZXN1bHRfZGVsCiAgICAgICAgICAgICAgLnRyaW0oKQogICAgICAgICAgICAgIC5zcGxpdCgvXHMvZykKICAgICAgICAgICAgICAuZmlsdGVyKChkKSA9PiBkKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coInNfcmVzdWx0X2FyciIsIHNfcmVzdWx0X2Fycik7CiAgICAgICAgICAgIC8vIOe7mSBzX3Jlc3VsdF9hcnIg5pWw57uE5Lit5q+P5Liq6K+N6YO95Yqg5LiA5LiqaW5kZXjlkoxmbGFn77yM5L6/5LqO5ZCO5pyf5om+aW5kZXgKICAgICAgICAgICAgdmFyIG5ld19zX3Jlc3VsdF9hcnIgPSBzX3Jlc3VsdF9hcnIubWFwKChpdGVtLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciByb2JqID0ge307CiAgICAgICAgICAgICAgcm9iai5pbmRleCA9IGluZGV4OwogICAgICAgICAgICAgIHJvYmoud29yZCA9IGl0ZW07CiAgICAgICAgICAgICAgcm9iai5mbGFnID0gMDsKICAgICAgICAgICAgICByZXR1cm4gcm9iajsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJuZXdfc19yZXN1bHRfYXJyIiwgbmV3X3NfcmVzdWx0X2Fycik7CiAgICAgICAgICAgIC8v5Yy56YWN5Ye65omA5pyJ55qE5L+u5pS5CiAgICAgICAgICAgIHZhciBhbGxNYXRjaFJlc3VsdCA9IHNfcmVzdWx0MS5tYXRjaCgKICAgICAgICAgICAgICAvKCg8ZGVsW14+XSo/Pi4qPzxcL2RlbD5ccykqKDxpbnNbXj5dKj8+Lio/PFwvaW5zPlxzKSopL2cKICAgICAgICAgICAgKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImFsbE1hdGNoUmVzdWx0OiAiLCBhbGxNYXRjaFJlc3VsdCk7CiAgICAgICAgICAgIC8v5a+55omA5pyJ55qE5Yy56YWN57uT5p6c77yI5L+u5pS577yJ6L+b6KGM6L+b5LiA5q2l55qE5pW05ZCICiAgICAgICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgYWxsTWF0Y2hSZXN1bHQubGVuZ3RoOyBuKyspIHsKICAgICAgICAgICAgICAvL+WOu+aOieepuueahOWMuemFjee7k+aenAogICAgICAgICAgICAgIGlmIChhbGxNYXRjaFJlc3VsdFtuXSA9PSAiIikgewogICAgICAgICAgICAgICAgYWxsTWF0Y2hSZXN1bHQuc3BsaWNlKG4sIDEpOwogICAgICAgICAgICAgICAgbiA9IG4gLSAxOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgbWF0Y2hTcGxpdCA9IGFsbE1hdGNoUmVzdWx0W25dCiAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCJcbiIsICIgIikKICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoIuKGtSIsICIgIikKICAgICAgICAgICAgICAgICAgLnRyaW0oKQogICAgICAgICAgICAgICAgICAuc3BsaXQoL1xzL2cpOwogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIm1hdGNoUmVzdWx0IiwgbWF0Y2hTcGxpdCk7CiAgICAgICAgICAgICAgICB2YXIgZGVsID0gW107CiAgICAgICAgICAgICAgICB2YXIgaW5zID0gW107CiAgICAgICAgICAgICAgICAvLyB2YXIgcmUxID0gLzxkZWxbXj5dKj8+Lio/PFwvZGVsPi9nOwogICAgICAgICAgICAgICAgLy8gdmFyIHJlMiA9IC88aW5zW14+XSo/Pi4qPzxcL2lucz4vZzsKICAgICAgICAgICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgbWF0Y2hTcGxpdC5sZW5ndGg7IHQrKykgewogICAgICAgICAgICAgICAgICAvL+WtmOWCqOWIsOebuOWPjeeahOaVsOe7hO+8n++8n++8nwogICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygibSIpOwogICAgICAgICAgICAgICAgICBpZiAobWF0Y2hTcGxpdFt0XS5pbmRleE9mKCI8aW5zPiIpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIuavj+S4qm1hdGNoU3BsaXTvvJoiLCBtYXRjaFNwbGl0W3RdKTsKICAgICAgICAgICAgICAgICAgICAvLyB2YXIgZGVsX2luZGV4ID0gc19yZXN1bHRfYXJyLmluZGV4T2YobWF0Y2hTcGxpdFt0XSk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmlzaGVkSXRlbSA9IG5ld19zX3Jlc3VsdF9hcnIuZmluZCgKICAgICAgICAgICAgICAgICAgICAgIChpdGVtKSA9PiBpdGVtLndvcmQgPT0gbWF0Y2hTcGxpdFt0XSAmJiBpdGVtLmZsYWcgPT0gMAogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmlzaGVkSXRlbSkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGZpbmlzaGVkSW5kZXggPSBuZXdfc19yZXN1bHRfYXJyLmZpbmRJbmRleCgKICAgICAgICAgICAgICAgICAgICAgICAgKGl0ZW0pID0+IGl0ZW0gPT0gZmluaXNoZWRJdGVtCiAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgbmV3X3NfcmVzdWx0X2FycltmaW5pc2hlZEluZGV4XS5mbGFnID0gMTsKICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWxfaW5kZXggPSBmaW5pc2hlZEluZGV4OwogICAgICAgICAgICAgICAgICAgICAgdmFyIGRlbF9pdGVtID0gewogICAgICAgICAgICAgICAgICAgICAgICBkZWw6IG1hdGNoU3BsaXRbdF0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRlbF9pbmRleDogZGVsX2luZGV4LAogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIGRlbC5wdXNoKGRlbF9pdGVtKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoU3BsaXRbdF0uaW5kZXhPZigiPGRlbD4iKSkgewogICAgICAgICAgICAgICAgICAgIGlucy5wdXNoKG1hdGNoU3BsaXRbdF0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZGVsIGFyciIsIGRlbCk7CiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaW5zIGFyciIsIGlucyk7CiAgICAgICAgICAgICAgICBpZiAoaW5zLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIGQgPSAwOyBkIDwgZGVsLmxlbmd0aDsgZCsrKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGRpZmYxID0gZGVsW2RdLmRlbC50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImEiLCBkaWZmMSkKICAgICAgICAgICAgICAgICAgICB2YXIgZGVsX2NvbnRlbnQxID0gZGVsW2RdLmRlbC5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgLyg8ZGVsW14+XSo/Pil8KDxcL2RlbD4pL2csCiAgICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImRlbF9jb250ZW50MSIsIGRlbF9jb250ZW50MSkKICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbTEgPSB7CiAgICAgICAgICAgICAgICAgICAgICB3b3JkOiBkZWxfY29udGVudDEsCiAgICAgICAgICAgICAgICAgICAgICBkaWZmOiBkaWZmMSwKICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBkZWxbZF0uZGVsX2luZGV4LAogICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAtMSwgLy/liKDpmaQKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIHNlbl9yZXN1bHQucHVzaChpdGVtMSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChkZWwubGVuZ3RoID09IDEgJiYgaW5zLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImRlbF9kZWwiLCBkZWxbMF0pOwogICAgICAgICAgICAgICAgICB2YXIgZGVsX2NvbnRlbnQyID0gZGVsWzBdLmRlbAogICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC8oPGRlbFtePl0qPz4pfCg8XC9kZWw+KS9nLCAiIikKICAgICAgICAgICAgICAgICAgICAudHJpbSgpOwogICAgICAgICAgICAgICAgICB2YXIgaW5zX2NvbnRlbnQyID0gaW5zWzBdLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgLyg8aW5zW14+XSo/Pil8KDxcL2lucz4pL2csCiAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImRlbF9jb250ZW50MiIsIGRlbF9jb250ZW50Mik7CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJpbnNfY29udGVudDIiLCBpbnNfY29udGVudDIpOwogICAgICAgICAgICAgICAgICB2YXIgZGlmZjIgPSBkZWxbMF0uZGVsLnRyaW0oKSArIGlucy5qb2luKCIgIik7CiAgICAgICAgICAgICAgICAgIHZhciBzdGF0dXMyID0gMjsgLy/kv67mlLkKICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICAgIGRlbF9jb250ZW50MiA9PSBpbnNfY29udGVudDIgfHwKICAgICAgICAgICAgICAgICAgICBkZWxfY29udGVudDIuc2xpY2UoMCwgZGVsX2NvbnRlbnQyLmxlbmd0aCAtIDEpID09CiAgICAgICAgICAgICAgICAgICAgICBpbnNfY29udGVudDIKICAgICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImRlbF9jb250ZW50MiA9PSBpbnNfY29udGVudDIiKTsKICAgICAgICAgICAgICAgICAgICBzdGF0dXMyID0gMTsgLy/lop7liqAKICAgICAgICAgICAgICAgICAgICB2YXIgaW5zX3RlbXAgPSBpbnMuc2xpY2UoMSk7CiAgICAgICAgICAgICAgICAgICAgZGlmZjIgPSBkZWxfY29udGVudDIudHJpbSgpICsgIiAiICsgaW5zX3RlbXAuam9pbigiICIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkaWZmMiIsIGRpZmYyKTsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImRlbF9jb250ZW50MiIsIGRlbF9jb250ZW50Mik7CiAgICAgICAgICAgICAgICAgIHZhciBpdGVtMiA9IHsKICAgICAgICAgICAgICAgICAgICB3b3JkOiBkZWxfY29udGVudDIsCiAgICAgICAgICAgICAgICAgICAgZGlmZjogZGlmZjIsCiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGRlbFswXS5kZWxfaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMyLAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBzZW5fcmVzdWx0LnB1c2goaXRlbTIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRlbC5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgICAgICAgIGlmIChkZWwubGVuZ3RoID09IGlucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBhID0gMDsgYSA8IGRlbC5sZW5ndGg7IGErKykgewogICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZGVsW2FdKQogICAgICAgICAgICAgICAgICAgICAgdmFyIGRlbF9jb250ZW50MyA9IGRlbFthXS5kZWwucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgLyg8ZGVsW14+XSo/Pil8KDxcL2RlbD4pL2csCiAgICAgICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgdmFyIGluc19jb250ZW50MyA9IGluc1thXS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAvKDxpbnNbXj5dKj8+KXwoPFwvaW5zPikvZywKICAgICAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiYyIsIGRlbF9jb250ZW50MykKICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWxfY29udGVudDMgIT09IGluc19jb250ZW50MykgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbTMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZDogZGVsX2NvbnRlbnQzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmY6IGRlbFthXS5kZWwudHJpbSgpICsgaW5zW2FdLAogICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBkZWxbYV0uZGVsX2luZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMiwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuX3Jlc3VsdC5wdXNoKGl0ZW0zKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgaWYgKGRlbC5sZW5ndGggPCBpbnMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgYiA9IDA7IGIgPCBkZWwubGVuZ3RoOyBiKyspIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBkZWxfY29udGVudDQgPSBkZWxbYl0uZGVsLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIC8oPGRlbFtePl0qPz4pfCg8XC9kZWw+KS9nLAogICAgICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkIiwgZGVsX2NvbnRlbnQ0KQogICAgICAgICAgICAgICAgICAgICAgdmFyIGRpZmY0ID0gIiI7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYiA9PSBkZWwubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVtcF9pbnMgPSBpbnMuc2xpY2UoYik7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpZmY0ID0gZGVsW2JdLmRlbC50cmltKCkgKyB0ZW1wX2lucy5qb2luKCIgIik7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBkaWZmNCA9IGRlbFtiXS5kZWwudHJpbSgpICsgaW5zW2JdOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImQiLCBkaWZmNCkKICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnNfY29udGVudDQgPSBpbnNbYl0ucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgLyg8aW5zW14+XSo/Pil8KDxcL2lucz4pL2csCiAgICAgICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgaWYgKGRlbF9jb250ZW50NCAhPT0gaW5zX2NvbnRlbnQ0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtNCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB3b3JkOiBkZWxfY29udGVudDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZjogZGlmZjQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGRlbFtiXS5kZWxfaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAyLAogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICBzZW5fcmVzdWx0LnB1c2goaXRlbTQpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICBpZiAoZGVsLmxlbmd0aCA+IGlucy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBjID0gMDsgYyA8IGlucy5sZW5ndGg7IGMrKykgewogICAgICAgICAgICAgICAgICAgICAgdmFyIGRlbF9jb250ZW50NSA9IGRlbFtjXS5kZWwucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgLyg8ZGVsW14+XSo/Pil8KDxcL2RlbD4pL2csCiAgICAgICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgdmFyIGluc19jb250ZW50NSA9IGluc1tjXS5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgICAvKDxpbnNbXj5dKj8+KXwoPFwvaW5zPikvZywKICAgICAgICAgICAgICAgICAgICAgICAgIiIKICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZSIsIGRlbF9jb250ZW50NSkKICAgICAgICAgICAgICAgICAgICAgIGlmIChkZWxfY29udGVudDUgIT09IGluc19jb250ZW50NSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbTUgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZDogZGVsX2NvbnRlbnQ1LAogICAgICAgICAgICAgICAgICAgICAgICAgIGRpZmY6IGRlbFtjXS5kZWwudHJpbSgpICsgaW5zW2NdLAogICAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBkZWxbY10uZGVsX2luZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMiwKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgc2VuX3Jlc3VsdC5wdXNoKGl0ZW01KTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBfZGVsID0gZGVsLnNsaWNlKGlucy5sZW5ndGgsIGRlbC5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGYgPSAwOyBmIDwgdGVtcF9kZWwubGVuZ3RoOyBmKyspIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBkaWZmNiA9IHRlbXBfZGVsW2ZdLmRlbC50cmltKCk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVsX2NvbnRlbnQ2ID0gdGVtcF9kZWxbZl0uZGVsLnJlcGxhY2UoCiAgICAgICAgICAgICAgICAgICAgICAgIC8oPGRlbFtePl0qPz4pfCg8XC9kZWw+KS9nLAogICAgICAgICAgICAgICAgICAgICAgICAiIgogICAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJlIiwgZGlmZjYpCiAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZSIsIGRlbF9jb250ZW50NikKICAgICAgICAgICAgICAgICAgICAgIHZhciBpdGVtNiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgd29yZDogZGVsX2NvbnRlbnQ2LAogICAgICAgICAgICAgICAgICAgICAgICBkaWZmOiBkaWZmNiwKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IHRlbXBfZGVsW2ZdLmRlbF9pbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiAtMSwKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICBzZW5fcmVzdWx0LnB1c2goaXRlbTYpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbF9yZXN1bHQucHVzaChzZW5fcmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJmaW5hbF9yZXN1bHQ6ICIsIGZpbmFsX3Jlc3VsdCk7CiAgICAgICAgICAvL+WGjeWPluS4gOasoeaVsOaNru+8jOWIpOaWreaYr+WxnuS6juWTquS4quWNleivjeeahOS/ruaUue+8jOWIpOaWreivpeS/ruaUueaYr+WQpuWtmOWcqAogICAgICAgICAgLy/lpoLmnpzlrZjlnKjvvIznm7TmjqXliqDlhaXnlKjmiLfvvIzlpoLmnpzkuI3lrZjlnKjvvIzliqDlhaXor6Xkv67mlLnku6Xlj4rnlKjmiLcKICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRUYXNrP19pZD0iICsgdGhpcy5kaWZmSWQpCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB0aGlzLmRiTGlzdCA9IHJlcy5kYXRhWzBdLmRpZmZMaXN0OwogICAgICAgICAgICB9KTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJkYkRpZmZMaXN0MiIsIHRoaXMuZGJMaXN0KTsKICAgICAgICAgIGZvciAodmFyIHIgPSAwOyByIDwgZmluYWxfcmVzdWx0Lmxlbmd0aDsgcisrKSB7CiAgICAgICAgICAgIC8vcuihqOekuuaWh+acrOS4reeahOesrHLlj6UKICAgICAgICAgICAgdmFyIHNfb3JkZXJzID0gZmluYWxfcmVzdWx0W3JdOyAvL+esrHLlj6XnmoTkv67mlLnorrDlvZUKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coInNfb3JkZXJzOiAiLCBzX29yZGVycyk7CiAgICAgICAgICAgIHZhciBzX3dvcmRzID0gdGhpcy5kYkxpc3Rbcl0ud29yZHM7IC8v56yscuWPpeeahOWIhuivjee7k+aenAogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygic193b3JkczogIiwgc193b3Jkcyk7CiAgICAgICAgICAgIHZhciBzX3NlbnRlbmNlcyA9IHRoaXMuZGJMaXN0W3JdLnNlbnRlbmNlRGlmZnM7IC8v56yscuWPpeeahOS4jeWQjOeJiOacrAogICAgICAgICAgICAvL+aWsOaUueWKqAogICAgICAgICAgICB2YXIgbmV3X3NlbnRlbmNlcyA9IHRoaXMuZGJMaXN0W3JdLnNlbnRlbmNlczsKICAgICAgICAgICAgaWYgKHNfb3JkZXJzLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICAgICAgLy/nrKxy5Y+l55qE5L+u5pS56K6w5b2V5Li656m6CiAgICAgICAgICAgICAgLy8g55Sx5LqO5pWw5o2u5bqT5Lit55qE6aG65bqP5Lya6ZqP5py65pS55Y+Y77yM5omA5Lul5YWI5Yy56YWN5YaN5o+S5YWl5pu05pS55pWw5o2uCiAgICAgICAgICAgICAgc193b3Jkcy5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgbm9fZWRpdGVkX3dvcmQgPSBpdGVtLndvcmQ7CiAgICAgICAgICAgICAgICB2YXIgbm9fZWRpdGVkX2luZGV4ID0gaXRlbS5kaWZmcy5maW5kSW5kZXgoCiAgICAgICAgICAgICAgICAgIChhdHRyKSA9PiBhdHRyLmRpZmYgPT0gbm9fZWRpdGVkX3dvcmQKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW25vX2VkaXRlZF9pbmRleF0ubmFtZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lLAogICAgICAgICAgICAgICAgICBlZGl0dGltZTogbmV3ZGF0ZSwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgaXRlbS5kaWZmc1tub19lZGl0ZWRfaW5kZXhdLm51bSsrOwogICAgICAgICAgICAgICAgaXRlbS5kaWZmc1tub19lZGl0ZWRfaW5kZXhdLnRpbWUgPSBuZXdkYXRlOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHZhciBmaWx0ZXJlZF93b3JkcyA9IHNfd29yZHMubWFwKChpdGVtKSA9PiB7CiAgICAgICAgICAgICAgICBmb3IgKHZhciBlbGUgPSAwOyBlbGUgPCBpdGVtLmRpZmZzLmxlbmd0aDsgZWxlKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIG5hbWVfaW5kZXggPSB0aGlzLmZpbmRFbGVtKAogICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlmZnNbZWxlXS5uYW1lcywKICAgICAgICAgICAgICAgICAgICAidXNlcm5hbWUiLAogICAgICAgICAgICAgICAgICAgIHRoaXMudXNlcm5hbWUKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgaWYgKG5hbWVfaW5kZXggIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5kaWZmc1tlbGVdLmhhc093blByb3BlcnR5KCJzdHlsZURpZmYiKSkgewogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0uZGlmZnNbZWxlXS5zdHlsZURpZmY7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLmRpZmZzW2VsZV0uZGlmZjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZmlsdGVyZWRfd29yZHMiLCBmaWx0ZXJlZF93b3Jkcyk7CiAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkX3NlbiA9IGZpbHRlcmVkX3dvcmRzLmpvaW4oIiAiKTsKCiAgICAgICAgICAgICAgc19zZW50ZW5jZXMucHVzaCh7CiAgICAgICAgICAgICAgICBwcm92aWRlcjogdGhpcy51c2VybmFtZSwKICAgICAgICAgICAgICAgIHNlbnRlbmNlRGlmZjogZmlsdGVyZWRfc2VuLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIC8v56yscuWPpeeahOS/ruaUueiusOW9leS4jeS4uuepugogICAgICAgICAgICAgIC8vIOesrOS4gOmDqOWIhu+8muWwhuS/ruaUueiusOW9leabv+aNouWIsOS4jeWQjOWPpeWtkOeahOeJiOacrOWxleekuuS4re+8jOS+v+S6juWxleekuuS/ruaUueeahOWcsOaWuQogICAgICAgICAgICAgIC8vIOaVtOWQiOesrOS6jOmDqOWIhuS6juesrOS4gOmDqOWIhuS4re+8muWIpOaWreavj+S4quivjeivreaYr+WQpuacieWvueW6lOeahOS/ruaUuQogICAgICAgICAgICAgIHZhciBlZGl0aW5nX3dvcmRzID0gW107CiAgICAgICAgICAgICAgc193b3Jkcy5mb3JFYWNoKChpdGVtLCBpbmRleCkgPT4gewogICAgICAgICAgICAgICAgdmFyIGl0ZW1JbmRleCA9IGluZGV4OwogICAgICAgICAgICAgICAgdmFyIHJlcGxhY2VkSXRlbUluZGV4ID0gc19vcmRlcnMuaW5kZXhPZigKICAgICAgICAgICAgICAgICAgc19vcmRlcnMuZmluZCgoZWxlbWVudCkgPT4gZWxlbWVudC5pbmRleCA9PSBpdGVtSW5kZXgpCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKHJlcGxhY2VkSXRlbUluZGV4ICE9IC0xKSB7CiAgICAgICAgICAgICAgICAgIGlmIChzX29yZGVyc1tyZXBsYWNlZEl0ZW1JbmRleF0uc3RhdHVzID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAvL+WvueWJjeS4gOS4quivjeeahOWkhOeQhiAgIOihpeWFhe+8muWPpeWwvueahOagh+eCueespuWPtwogICAgICAgICAgICAgICAgICAgIHZhciBmaW5kX2luZGV4ID0gdGhpcy5maW5kRWxlbShpdGVtLmRpZmZzLCAic3RhdHVzIiwgMCk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImZpbmRfaW5kZXhhYWFhIiwgZmluZF9pbmRleCk7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5kaWZmc1tmaW5kX2luZGV4XS5uYW1lcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgZWRpdHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgaXRlbS5kaWZmc1tmaW5kX2luZGV4XS5udW0rKzsKICAgICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW2ZpbmRfaW5kZXhdLnRpbWUgPSBuZXdkYXRlOwoKICAgICAgICAgICAgICAgICAgICB2YXIgcl9pbnNfd29yZHMgPSBzX29yZGVyc1tyZXBsYWNlZEl0ZW1JbmRleF0uZGlmZi5zcGxpdCgKICAgICAgICAgICAgICAgICAgICAgICIgIgogICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgdmFyIGluc193b3JkcyA9IHJfaW5zX3dvcmRzLnNsaWNlKDEpOwoKICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICBzX3dvcmRzW2luZGV4IC0gMV0uZGlmZnNbMF0uaGFzT3duUHJvcGVydHkoInN0eWxlRGlmZiIpICYmCiAgICAgICAgICAgICAgICAgICAgICBzX3dvcmRzW2luZGV4IC0gMV0uaXNmaXJzdCA9PSBmYWxzZQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZ19lbmQgPSAvXCx8XC58XCF8XD98XC5cInxcLlwnfFwhXCJ8XCFcJ3xcP1wifFw/XCcvZzsKICAgICAgICAgICAgICAgICAgICAgIHZhciBiZl9pbnNfZHdfaSA9IHNfd29yZHNbaW5kZXggLSAxXS5kaWZmcy5maW5kSW5kZXgoCiAgICAgICAgICAgICAgICAgICAgICAgIChlbGVtKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uZGlmZiA9PT0gc193b3Jkc1tpbmRleCAtIDFdLndvcmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICk7CgogICAgICAgICAgICAgICAgICAgICAgdmFyIHRlbXBfaW5zX3NkZiA9IGl0ZW0uZGlmZnNbYmZfaW5zX2R3X2ldLnN0eWxlRGlmZjsKICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJ0ZW1wX2luc19zZGYxMTExIiwgdGVtcF9pbnNfc2RmKTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ19lbmQudGVzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wX2luc19zZGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXRjaCgvKD88PTxzdWJpbnM+KS4qPyg/PTxcL3N1Ymlucz4pL2cpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoLTEpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wX2luc19zZGYgPSB0ZW1wX2luc19zZGYucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wX2luc19zZGYuc2xpY2UoLTEwKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAiPC9zdWJpbnM+IgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLndvcmQgPSB0ZW1wX2luc19zZGYucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAvPHN1Ymlucz58PFwvc3ViaW5zPi9nLAogICAgICAgICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlmZnNbYmZfaW5zX2R3X2ldLmRpZmYgPSBpdGVtLndvcmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlmZnNbYmZfaW5zX2R3X2ldLnN0eWxlRGlmZiA9IHRlbXBfaW5zX3NkZjsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZ19lbmQudGVzdCgKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wX2luc19zZGYKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXRjaCgvKD88PTxzdWJpbnM+KS4qPyg/PTxcL3N1Ymlucz4pL2cpWzBdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2xpY2UoLTIpCiAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wX2luc19zZGYgPSB0ZW1wX2luc19zZGYucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wX2luc19zZGYuc2xpY2UoLTExKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAiPC9zdWJpbnM+IgogICAgICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLndvcmQgPSB0ZW1wX2luc19zZGYucmVwbGFjZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAvPHN1Ymlucz58PFwvc3ViaW5zPi9nLAogICAgICAgICAgICAgICAgICAgICAgICAgICIiCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlmZnNbYmZfaW5zX2R3X2ldLmRpZmYgPSBpdGVtLndvcmQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlmZnNbYmZfaW5zX2R3X2ldLnN0eWxlRGlmZiA9IHRlbXBfaW5zX3NkZjsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygi5b2T5YmN5Y6f6K+N5Y675qCH54K55ZCOIiwgaXRlbS53b3JkKTsKICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJ0ZW1wX2luc19zZGYyMjIyMjIyIiwgdGVtcF9pbnNfc2RmKTsKCiAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5zX3dvcmRzX2FyciA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQ6IHRlbXBfaW5zX3NkZiwKICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmczogWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmOiB0ZW1wX2luc19zZGYsIC8v5bGV56S65pWw5o2uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgaXNlZGl0ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgdmFyIHJlZ19lbmQgPSAvXCx8XC58XCF8XD98XC5cInxcLlwnfFwhXCJ8XCFcJ3xcP1wifFw/XCcvZzsKICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZW1wX2lucyA9IHJfaW5zX3dvcmRzWzBdOwogICAgICAgICAgICAgICAgICAgICAgdmFyIGJmX2luc19kd19pID0gaXRlbS5kaWZmcy5maW5kSW5kZXgoKGVsZW0pID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsZW0uZGlmZiA9PT0gaXRlbS53b3JkOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiYmZfaW5zX2R3X2kiLCBiZl9pbnNfZHdfaSk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVnX2VuZC50ZXN0KHRlbXBfaW5zW3RlbXBfaW5zLmxlbmd0aCAtIDFdKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0ZW1wX2lucyA9IHRlbXBfaW5zLnNsaWNlKDAsIHRlbXBfaW5zLmxlbmd0aCAtIDEpOwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLndvcmQgPSB0ZW1wX2luczsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIml0ZW0uZGlmZnNbYmZfaW5zX2R3X2ldIiwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gICBpdGVtLmRpZmZzW2JmX2luc19kd19pXQogICAgICAgICAgICAgICAgICAgICAgICAvLyApOwogICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW2JmX2luc19kd19pXS5kaWZmID0gdGVtcF9pbnM7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVnX2VuZC50ZXN0KHRlbXBfaW5zLnNsaWNlKC0yKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGVtcF9pbnMgPSB0ZW1wX2lucy5zbGljZSgwLCB0ZW1wX2lucy5sZW5ndGggLSAyKTsKICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS53b3JkID0gdGVtcF9pbnM7CiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlmZnNbYmZfaW5zX2R3X2ldLmRpZmYgPSB0ZW1wX2luczsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnNfd29yZHNfYXJyID0gWwogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgd29yZDogdGVtcF9pbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZnM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlmZjogdGVtcF9pbnMsIC8v5bGV56S65pWw5o2uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgaXNlZGl0ZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgXTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vSSBsb3ZlIENoaW5hLgogICAgICAgICAgICAgICAgICAgIC8vSSB2ZXJ5IGxvdmUgQ2hpbmEgdG9vLgogICAgICAgICAgICAgICAgICAgIGluc193b3Jkcy5mb3JFYWNoKChpKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaV93b3JkID0gaS5yZXBsYWNlKC8oPGluc1tePl0qPz4pfCg8XC9pbnM+KS9nLCAiIik7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaV9pbmRleCA9IHNfb3JkZXJzW3JlcGxhY2VkSXRlbUluZGV4XS5pbmRleCArIDE7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaV9uYW1lcyA9IG5ldyBBcnJheSgpOwogICAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJfaXRlbSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXR0aW1lOiBuZXdkYXRlLAogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIGlfbmFtZXMucHVzaCh1c2VyX2l0ZW0pOwogICAgICAgICAgICAgICAgICAgICAgdmFyIGluc193b3JkSXRlbSA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGlfaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQ6IGlfd29yZCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZnM6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaWZmOiBpX3dvcmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZURpZmY6ICI8c3ViaW5zPiIgKyBpX3dvcmQgKyAiPC9zdWJpbnM+IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVzOiBpX25hbWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVtOiAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogbmV3ZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICBpc2VkaXRlZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGlzZmlyc3Q6IGZhbHNlLCAvL+ebuOWvueesrOS4gOeJiO+8jOeUqOS6juWMuuWIhuaUueeJiOaYr+WQpuS4uuWinuWKoOeahOWGheWuuQogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIGluc193b3Jkc19hcnIucHVzaChpbnNfd29yZEl0ZW0pOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIGVkaXRpbmdfd29yZHMucHVzaChpbnNfd29yZHNfYXJyKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YXIgZmluZF9yZXN1bHQgPSB0aGlzLmZpbmRFbGVtKAogICAgICAgICAgICAgICAgICAgICAgaXRlbS5kaWZmcywKICAgICAgICAgICAgICAgICAgICAgICJkaWZmIiwKICAgICAgICAgICAgICAgICAgICAgIHNfb3JkZXJzW3JlcGxhY2VkSXRlbUluZGV4XS5kaWZmCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZmluZF9yZXN1bHQgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgIC8v5LiN5a2Y5ZyoCiAgICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZXMgPSBuZXcgQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgIHZhciB1c2VyX2l0ZW0gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lOiB0aGlzLnVzZXJuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICBlZGl0dGltZTogbmV3ZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICBuYW1lcy5wdXNoKHVzZXJfaXRlbSk7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgZGlmZl9pdGVtID0gewogICAgICAgICAgICAgICAgICAgICAgICBkaWZmOiBzX29yZGVyc1tyZXBsYWNlZEl0ZW1JbmRleF0uZGlmZiwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZXM6IG5hbWVzLAogICAgICAgICAgICAgICAgICAgICAgICBudW06IDEsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogc19vcmRlcnNbcmVwbGFjZWRJdGVtSW5kZXhdLnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzLnB1c2goZGlmZl9pdGVtKTsKICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uaXNlZGl0ZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW2ZpbmRfcmVzdWx0XS5uYW1lcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVkaXR0aW1lOiBuZXdkYXRlLAogICAgICAgICAgICAgICAgICAgICAgfSk7IC8v5bCG5b2T5YmN55So5oi35Yqg5YWl5YiX6KGoCiAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW2ZpbmRfcmVzdWx0XS5udW0rKzsgLy/mlbDph4/liqAxCiAgICAgICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW2ZpbmRfcmVzdWx0XS50aW1lID0gbmV3ZGF0ZTsgLy/mm7TmlrDml6XmnJ8KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdmFyIHdvcmRfZGlmZiA9IGl0ZW0ud29yZC5yZXBsYWNlKAogICAgICAgICAgICAgICAgICAgICAgaXRlbS53b3JkLAogICAgICAgICAgICAgICAgICAgICAgc19vcmRlcnNbcmVwbGFjZWRJdGVtSW5kZXhdLmRpZmYKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAgIGVkaXRpbmdfd29yZHMucHVzaCh3b3JkX2RpZmYpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB2YXIgbm9fZWRpdGVkX3dvcmQgPSBpdGVtLndvcmQ7CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJub19lZGl0ZWRfd29yZCIsIG5vX2VkaXRlZF93b3JkKTsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIml0ZW0uZGlmZnMiLCBpdGVtLmRpZmZzKTsKICAgICAgICAgICAgICAgICAgdmFyIG5vX2VkaXRlZF9pbmRleCA9IGl0ZW0uZGlmZnMuZmluZEluZGV4KChhdHRyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF0dHIuZGlmZiA9PSBub19lZGl0ZWRfd29yZDsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJub19lZGl0ZWRfaW5kZXgiLCBub19lZGl0ZWRfaW5kZXgpOwogICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW25vX2VkaXRlZF9pbmRleF0ubmFtZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWU6IHRoaXMudXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgZWRpdHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBpdGVtLmRpZmZzW25vX2VkaXRlZF9pbmRleF0ubnVtKys7CiAgICAgICAgICAgICAgICAgIGl0ZW0uZGlmZnNbbm9fZWRpdGVkX2luZGV4XS50aW1lID0gbmV3ZGF0ZTsKCiAgICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzZmlyc3QgPT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIGVkaXRpbmdfd29yZHMucHVzaChpdGVtLndvcmQpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKAogICAgICAgICAgICAgICAgICAgIC8vICAgIm5vX2VkaXRlZF93b3JkwqA+PsKgaXRlbS5kaWZmc1tub19lZGl0ZWRfaW5kZXhdLnN0eWxlRGlmZiIsCiAgICAgICAgICAgICAgICAgICAgLy8gICBpdGVtLmRpZmZzW25vX2VkaXRlZF9pbmRleF0uc3R5bGVEaWZmCiAgICAgICAgICAgICAgICAgICAgLy8gKTsKICAgICAgICAgICAgICAgICAgICBlZGl0aW5nX3dvcmRzLnB1c2goaXRlbS5kaWZmc1tub19lZGl0ZWRfaW5kZXhdLnN0eWxlRGlmZik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiZWRpdGluZ193b3JkczEiLCBlZGl0aW5nX3dvcmRzKTsKICAgICAgICAgICAgICB2YXIgZGVlcEZsYXR0ZW4gPSAoYXJyKSA9PgogICAgICAgICAgICAgICAgW10uY29uY2F0KAogICAgICAgICAgICAgICAgICAuLi5hcnIubWFwKCh2KSA9PiAoQXJyYXkuaXNBcnJheSh2KSA/IGRlZXBGbGF0dGVuKHYpIDogdikpCiAgICAgICAgICAgICAgICApOwoKICAgICAgICAgICAgICB2YXIgbW9yZV9pbnNfYXJyID0gW107IC8v5aKe5Yqg55qE5Y6f6K+N5pWw57uECiAgICAgICAgICAgICAgZm9yICh2YXIgbWEgPSAwOyBtYSA8IGVkaXRpbmdfd29yZHMubGVuZ3RoOyBtYSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlZGl0aW5nX3dvcmRzW21hXSkpIHsKICAgICAgICAgICAgICAgICAgbW9yZV9pbnNfYXJyLnB1c2goZWRpdGluZ193b3Jkc1ttYV0uc2xpY2UoMSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygibW9yZV9pbnNfYXJyIiwgbW9yZV9pbnNfYXJyKTsgLy9tb3JlX2luc19hcnIgW1sxLCAyLCAzXSwgWzQsIDVdLCBbNywgOF1dCiAgICAgICAgICAgICAgdmFyIG1vcmVfaW5zX2FycjEgPSBkZWVwRmxhdHRlbihtb3JlX2luc19hcnIpOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJtb3JlX2luc19hcnIxIiwgbW9yZV9pbnNfYXJyMSk7IC8vWzEsIDIsIDMsIDQsIDUsIDcsIDhdCgogICAgICAgICAgICAgIGZvciAodmFyIHZhID0gMDsgdmEgPCBtb3JlX2luc19hcnIxLmxlbmd0aDsgdmErKykgewogICAgICAgICAgICAgICAgaWYgKG1vcmVfaW5zX2FycjFbdmFdLndvcmQgPT0gIiIpIHsKICAgICAgICAgICAgICAgICAgbW9yZV9pbnNfYXJyMS5zcGxpY2UodmEsIDEpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgbW9yZV9pbnNfYXJyMVt2YV0uaW5kZXggPSBtb3JlX2luc19hcnIxW3ZhXS5pbmRleCArIHZhOwogICAgICAgICAgICAgICAgICBzX3dvcmRzLnNwbGljZShtb3JlX2luc19hcnIxW3ZhXS5pbmRleCwgMCwgbW9yZV9pbnNfYXJyMVt2YV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coInNfd29yZHMyMjIyIiwgc193b3Jkcyk7CiAgICAgICAgICAgICAgLy/mlrDmlLnliqgKICAgICAgICAgICAgICBpZiAobW9yZV9pbnNfYXJyMS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICB2YXIgcmVnX2VuZCA9IC9cLHxcLnxcIXxcP3xcLlwifFwuXCd8XCFcInxcIVwnfFw/XCJ8XD9cJy9nOwogICAgICAgICAgICAgICAgLy8gdmFyIHJlZ19lbmQgPSAvXC58XCF8XD8vZzsKICAgICAgICAgICAgICAgIGZvciAodmFyIHdyID0gMDsgd3IgPCBzX3dvcmRzLmxlbmd0aCAtIDE7IHdyKyspIHsKICAgICAgICAgICAgICAgICAgdmFyIHdvcmQgPSBzX3dvcmRzW3dyXS53b3JkOwogICAgICAgICAgICAgICAgICB2YXIgZGlmZnMgPSBzX3dvcmRzW3dyXS5kaWZmczsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIjExMTExMSIsIGRpZmZzKTsKICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIjExMTEyIiwgd29yZCk7CiAgICAgICAgICAgICAgICAgIHZhciBub19lZGl0ZWRfaW5kZXggPSBkaWZmcy5maW5kSW5kZXgoCiAgICAgICAgICAgICAgICAgICAgKGF0dHIpID0+IGF0dHIuZGlmZiA9PT0gd29yZAogICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiKysrKysrKyIsIG5vX2VkaXRlZF9pbmRleCk7CiAgICAgICAgICAgICAgICAgIGlmIChyZWdfZW5kLnRlc3Qod29yZFt3b3JkLmxlbmd0aCAtIDFdKSkgewogICAgICAgICAgICAgICAgICAgIHdvcmQgPSB3b3JkLnNsaWNlKDAsIHdvcmQubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIi0tLS0tLS0iLCB3b3JkKTsKICAgICAgICAgICAgICAgICAgICBkaWZmc1tub19lZGl0ZWRfaW5kZXhdLmRpZmYgPSBkaWZmc1sKICAgICAgICAgICAgICAgICAgICAgIG5vX2VkaXRlZF9pbmRleAogICAgICAgICAgICAgICAgICAgIF0uZGlmZi5zbGljZSgwLCBkaWZmc1tub19lZGl0ZWRfaW5kZXhdLmRpZmYubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIi0tLS0tLS0iLCBkaWZmc1tub19lZGl0ZWRfaW5kZXhdLmRpZmYpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGlmIChyZWdfZW5kLnRlc3Qod29yZC5zbGljZSgtMikpKSB7CiAgICAgICAgICAgICAgICAgICAgd29yZCA9IHdvcmQuc2xpY2UoMCwgd29yZC5sZW5ndGggLSAyKTsKICAgICAgICAgICAgICAgICAgICBkaWZmc1tub19lZGl0ZWRfaW5kZXhdLmRpZmYgPSBkaWZmc1sKICAgICAgICAgICAgICAgICAgICAgIG5vX2VkaXRlZF9pbmRleAogICAgICAgICAgICAgICAgICAgIF0uZGlmZi5zbGljZSgwLCBkaWZmc1tub19lZGl0ZWRfaW5kZXhdLmRpZmYubGVuZ3RoIC0gMik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHZhciB2MV93b3JkcyA9IFtdOwogICAgICAgICAgICAgICAgdjFfd29yZHMgPSBzX3dvcmRzLm1hcCgod29yZCkgPT4gewogICAgICAgICAgICAgICAgICByZXR1cm4gd29yZC53b3JkOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB2YXIgbmV3X3NlbnRlbmNlID0gdjFfd29yZHMuam9pbigiICIpOwogICAgICAgICAgICAgICAgdmFyIG5ld19pdGVtID0gewogICAgICAgICAgICAgICAgICBwcm92aWRlcjogdGhpcy51c2VybmFtZSwKICAgICAgICAgICAgICAgICAgc2VudGVuY2U6IG5ld19zZW50ZW5jZSwKICAgICAgICAgICAgICAgICAgdGltZTogbmV3ZGF0ZSwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBuZXdfc2VudGVuY2VzLnB1c2gobmV3X2l0ZW0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coInNfd29yZHMzMzMzIiwgc193b3Jkcyk7CgogICAgICAgICAgICAgIGVkaXRpbmdfd29yZHMgPSBkZWVwRmxhdHRlbigKICAgICAgICAgICAgICAgIGVkaXRpbmdfd29yZHMubWFwKCh3KSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHcpID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgc3ViX3dvcmQgPSB3Lm1hcCgoaXcpID0+IHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChpdy5kaWZmc1swXS5oYXNPd25Qcm9wZXJ0eSgic3R5bGVEaWZmIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgIml3LmRpZmZzWzBdLnN0eWxlRGlmZiIsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICAgaXcuZGlmZnNbMF0uc3R5bGVEaWZmCiAgICAgICAgICAgICAgICAgICAgICAgIC8vICk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpdy5kaWZmc1swXS5zdHlsZURpZmY7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiaXcuZGlmZnNbMF0uZGlmZiIsIGl3LmRpZmZzWzBdLmRpZmYpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaXcuZGlmZnNbMF0uZGlmZjsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3ViX3dvcmQ7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHc7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgKTsKCiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImVkaXRpbmdfd29yZHMyIiwgZWRpdGluZ193b3Jkcyk7CiAgICAgICAgICAgICAgLy9bIkluIiwgIjxzdWJpbnM+QEBAPC9zdWJpbnM+IiwgIjxzdWJpbnM+QEBAQEBAQEBAQEA8L3N1Ymlucz4iLCAiPGRlbD5oYXZlPC9kZWw+PGlucz5oYWQ8L2lucz4iLCAiZWFydGhxdWFrZS4iXQogICAgICAgICAgICAgIHZhciBlZGl0aW5nX3NlbnRlbmNlID0gZWRpdGluZ193b3Jkcy5qb2luKCIgIik7CiAgICAgICAgICAgICAgc19zZW50ZW5jZXMucHVzaCh7CiAgICAgICAgICAgICAgICBwcm92aWRlcjogdGhpcy51c2VybmFtZSwKICAgICAgICAgICAgICAgIHNlbnRlbmNlRGlmZjogZWRpdGluZ19zZW50ZW5jZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygic2VudGVuY2VEaWZmczogIiwgc19zZW50ZW5jZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygiYmJiIiwgdGhpcy5kYkxpc3QpOwoKICAgICAgICAgIC8v5Yik5pat5b2T5YmN55So5oi35piv5ZCm5ZyodXNlckxpc3TkuK0KICAgICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgdGhpcy51c2VyTGlzdC5sZW5ndGg7IGgrKykgewogICAgICAgICAgICBpZiAodGhpcy51c2VybmFtZSA9PSB0aGlzLnVzZXJMaXN0W2hdLm5hbWUpIHsKICAgICAgICAgICAgICB0aGlzLmluVXNlckxpc3QgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvL+WmguaenOayoeacieWImeWinuWKoAogICAgICAgICAgaWYgKHRoaXMuaW5Vc2VyTGlzdCA9PSBmYWxzZSkgewogICAgICAgICAgICB0aGlzLnVzZXJMaXN0LnB1c2goewogICAgICAgICAgICAgIG5hbWU6IHRoaXMudXNlcm5hbWUsCiAgICAgICAgICAgICAgbXlfc2VudGVuY2VzOiB0aGlzLnNlbnRlbmNlTGlzdCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zb2xlLmxvZygic3VibWl0bXYgc3VibWl0dGVkIiwgdGhpcy5zdWJtaXR0ZWQpOwogICAgICAgICAgdGhpcy5zdWJtaXR0ZWQucHVzaCh0aGlzLnVzZXJuYW1lKTsKCiAgICAgICAgICAvL+abtOaWsOebuOW6lOaVsOaNruWIsOaVsOaNruW6kwogICAgICAgICAgdGhpcy4kYXhpb3MucG9zdCh0aGlzLmFwaSArICIvdXBkYXRlZGlmZiIsIHsKICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgX2lkOiB0aGlzLmRpZmZJZCwKICAgICAgICAgICAgICB1c2VyTGlzdDogdGhpcy51c2VyTGlzdCwKICAgICAgICAgICAgICBkaWZmTGlzdDogdGhpcy5kYkxpc3QsCiAgICAgICAgICAgICAgc3VibWl0dGVkOiB0aGlzLnN1Ym1pdHRlZCwKICAgICAgICAgICAgfSwKICAgICAgICAgIH0pOwoKICAgICAgICAgIHZhciBuZXdfdmVyc2lvbiA9IHRoaXMuc2VudGVuY2VMaXN0LmpvaW4oIiAiKTsKICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgIC5wb3N0KHRoaXMuYXBpICsgIi91cGRhdGVWZXJzaW9uIiwgewogICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgX2lkOiB0aGlzLmRpZmZJZCwKICAgICAgICAgICAgICAgIG5ld192ZXJzaW9uOiBuZXdfdmVyc2lvbiwKICAgICAgICAgICAgICAgIHRpbWU6IG5ld2RhdGUsCiAgICAgICAgICAgICAgICB1c2VybmFtZTogdGhpcy51c2VybmFtZSwKICAgICAgICAgICAgICAgIHVzZXJJZDogdGhpcy51c2VySWQsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSkKCiAgICAgICAgICAvLyDlvZPlj5HluIPogIXotoXov4fmiKrmraLml6XmnJ/lkI7mj5DkuqTnrZTmoYgKICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRUYXNrP19pZD0iICsgdGhpcy5kaWZmSWQpCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsvL+WIt+aWsGRpZmZMaXN0CiAgICAgICAgICAgICAgdGhpcy5kaWZmTGlzdCA9IHJlcy5kYXRhWzBdLmRpZmZMaXN0OwogICAgICAgICAgICAgIC8vIGxldCBkYXRlMSA9IG5ldyBEYXRlKCk7CiAgICAgICAgICAgICAgLy8gbGV0IG5ld2RhdGUxID0gZGF0ZTEudG9Mb2NhbGVTdHJpbmcoImNoaW5lc2UiLCB7CiAgICAgICAgICAgICAgLy8gICBob3VyMTI6IGZhbHNlLAogICAgICAgICAgICAgIC8vIH0pOwogICAgICAgICAgICAgIGxldCBuZXdkYXRlMT10aGlzLiRtb21lbnQobmV3IERhdGUoKSkuZm9ybWF0KCJZWVlZL01NL0REIEhIOm1tOnNzIikKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICB0aGlzLnVzZXJuYW1lID09IHRoaXMucHVibGlzaGVyICYmCiAgICAgICAgICAgICAgICAhdGhpcy5pc01hbnVhbCAmJgogICAgICAgICAgICAgICAgdGhpcy5jb21wYXJlRGF0ZShuZXdkYXRlMSx0aGlzLmRlYWRsaW5lKQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgdGhpcy5jb3VudFNjb3JlcygpOyAvLyIyMDIxLzAyLzA1IDAwOjAwOjAwIiwgdGhpcy5kZWFkbGluZQogICAgICAgICAgICAgICAgdGhpcy5pc0NvbmZpcm0gPSB0cnVlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAvL+WFs+mXrei+k+WFpeahhgogICAgICAgICAgdGhpcy5pc2VkaXQgPSBmYWxzZTsKICAgICAgICAgIHRoaXMubG9hZGluZyA9IHRydWU7CgogICAgICAgICAgdGhpcy4kbm90aWZ5KHsKICAgICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLAogICAgICAgICAgICBtZXNzYWdlOiAi5o+Q5Lqk5oiQ5Yqf77yBIiwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5jcmVhdGVGaW5hbFZlcnNpb24oKTsKICAgICAgICAgIC8vIHRoaXMuJHJvdXRlci5nbygwKTsKICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRUYXNrP19pZD0iICsgdGhpcy5kaWZmSWQpCiAgICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgICB2YXIgdmlkZW9faWQgPSByZXMuZGF0YVswXS52aWRlb0lkOyAvL+WvueW6lOinhumikeeahF9pZAogICAgICAgICAgICAgIHZhciBhdXRoY29kZSA9IHJlcy5kYXRhWzBdLmF1dGhjb2RlOyAvL+WvueW6lOS7u+WKoeeahOmqjOivgeeggQogICAgICAgICAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgICAgICAgICAuZ2V0KHRoaXMuYXBpICsgIi9wcm9maWxlP25hbWU9IiArIHRoaXMudXNlcm5hbWUpCiAgICAgICAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgICAgICAgIHZhciB1c2VySWQgPSByZXMuZGF0YVswXS5faWQ7CiAgICAgICAgICAgICAgICAgIHZhciB1c2VyVGFza3MgPSByZXMuZGF0YVswXS5teVRhc2tzOwogICAgICAgICAgICAgICAgICB1c2VyVGFza3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgdGFza0lkOiB0aGlzLmRpZmZJZCwKICAgICAgICAgICAgICAgICAgICB2aWRlb0lkOiB2aWRlb19pZCwKICAgICAgICAgICAgICAgICAgICBkZWFkbGluZTogdGhpcy5kZWFkbGluZSwKICAgICAgICAgICAgICAgICAgICBhdXRoY29kZTogYXV0aGNvZGUsCiAgICAgICAgICAgICAgICAgICAgdGl0bGU6IHRoaXMudGFza1RpdGxlLAogICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0aGlzLnRhc2tMYWJlbHMsCiAgICAgICAgICAgICAgICAgICAgdGltZTogbmV3ZGF0ZSwKICAgICAgICAgICAgICAgICAgICBzY29yZXM6ICIiLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgLy8g5pu05paw55So5oi34oCcbXlUYXNrc+KAnQogICAgICAgICAgICAgICAgICB0aGlzLiRheGlvcy5wb3N0KHRoaXMuYXBpICsgIi91cGRhdGVNeVRhc2tzIiwgewogICAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgICAgX2lkOiB1c2VySWQsCiAgICAgICAgICAgICAgICAgICAgICBteVRhc2tzOiB1c2VyVGFza3MsCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJG5vdGlmeSh7CiAgICAgICAgICAgIC8vIHRpdGxlOiAi6K2m5ZGKIiwKICAgICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgICBtZXNzYWdlOiAi5o+Q5Lqk5YaF5a655YyF5ZCr6Z2e5rOV5a2X56ym77yM6K+35qOA5p+l5L+u5pS55ZCO5YaN5o+Q5Lqk77yBIiwKICAgICAgICAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIC8vIC5jYXRjaCgoKSA9PiB7CiAgICAgIC8vICAgdGhpcy4kbm90aWZ5KHsKICAgICAgLy8gICAgIC8vIHRpdGxlOiAi6K2m5ZGKIiwKICAgICAgLy8gICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgLy8gICAgIG1lc3NhZ2U6ICLmgqjlt7Llj5bmtojmj5DkuqQiLAogICAgICAvLyAgICAgcG9zaXRpb246ICJ0b3AtcmlnaHQiLAogICAgICAvLyAgICAgb2Zmc2V0OiAxMDAsCiAgICAgIC8vICAgfSk7CiAgICAgIC8vIH0pOwogICAgfSwKICAgIC8v55Sf5oiQ57u85ZCI54mI5pysCiAgICBjcmVhdGVGaW5hbFZlcnNpb24oKSB7CiAgICAgIHRoaXMuJGF4aW9zCiAgICAgICAgLmdldCh0aGlzLmFwaSArICIvY3VycmVudFRhc2s/X2lkPSIgKyB0aGlzLmRpZmZJZCkKICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAvLyB0aGlzLm9wZW5GdWxsU2NyZWVuMigpCiAgICAgICAgICB0aGlzLmRiTGlzdCA9IHJlcy5kYXRhWzBdLmRpZmZMaXN0OwogICAgICAgICAgLy/liqDovb3liqjnlLsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgIH0sIDE1MDApOwogICAgICAgICAgLy8gY29uc29sZS5sb2coImRiTGlzdCIsIHRoaXMuZGJMaXN0KTsKICAgICAgICAgIHZhciBmaW5hbF9zZW50ZW5jZXMgPSBbXTsKICAgICAgICAgIHZhciBvbmx5X3NlbnRlbmNlcyA9IFtdOwogICAgICAgICAgdmFyIG9ubHlfc2VudGVuY2VzMSA9IFtdOwogICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCB0aGlzLmRiTGlzdC5sZW5ndGg7IGsrKykgewogICAgICAgICAgICB2YXIgb3JpZ2luYWxfc2VudGVuY2UgPSB0aGlzLmRiTGlzdFtrXS5zZW50ZW5jZTsKICAgICAgICAgICAgdmFyIHdvcmRzID0gdGhpcy5kYkxpc3Rba10ud29yZHM7CiAgICAgICAgICAgIHZhciBtb3N0X3dvcmRzID0gW107CiAgICAgICAgICAgIGZvciAodmFyIHcgPSAwOyB3IDwgd29yZHMubGVuZ3RoOyB3KyspIHsKICAgICAgICAgICAgICB2YXIgd29yZHNfZGlmZnMgPSB3b3Jkc1t3XS5kaWZmczsKICAgICAgICAgICAgICB2YXIgbW9zdF9lZGl0ZWRfd29yZCA9IHdvcmRzX2RpZmZzW3dvcmRzX2RpZmZzLmxlbmd0aCAtIDFdLmRpZmY7IC8v5Yid5aeL5YC8CiAgICAgICAgICAgICAgLy/mjInml7bpl7TmjpLluo8KICAgICAgICAgICAgICAvL+aMieeUqOaIt+aVsOmHj+aOkuW6jwogICAgICAgICAgICAgIHZhciB3b3Jkc19kaWZmczIgPSB3b3Jkc19kaWZmcwogICAgICAgICAgICAgICAgLnNvcnQodGhpcy5jb21wYXJlKCJ0aW1lIikpCiAgICAgICAgICAgICAgICAuc29ydCh0aGlzLmNvbXBhcmUoIm51bSIpKTsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygid29yZHNfZGlmZnMyIiwgd29yZHNfZGlmZnMyKQoKICAgICAgICAgICAgICBpZiAod29yZHNfZGlmZnMyW3dvcmRzX2RpZmZzLmxlbmd0aCAtIDFdLnN0eWxlRGlmZikgewogICAgICAgICAgICAgICAgbW9zdF9lZGl0ZWRfd29yZCA9IHsKICAgICAgICAgICAgICAgICAgZGlmZjogd29yZHNfZGlmZnMyW3dvcmRzX2RpZmZzLmxlbmd0aCAtIDFdLnN0eWxlRGlmZiwKICAgICAgICAgICAgICAgICAgaXNlZGl0ZWQ6IHdvcmRzW3ddLmlzZWRpdGVkLAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbW9zdF9lZGl0ZWRfd29yZCA9IHsKICAgICAgICAgICAgICAgICAgZGlmZjogd29yZHNfZGlmZnMyW3dvcmRzX2RpZmZzLmxlbmd0aCAtIDFdLmRpZmYsCiAgICAgICAgICAgICAgICAgIGlzZWRpdGVkOiB3b3Jkc1t3XS5pc2VkaXRlZCwKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG1vc3Rfd29yZHMucHVzaChtb3N0X2VkaXRlZF93b3JkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgZmluYWxfc2VudGVuY2UgPSAiIjsKICAgICAgICAgICAgZm9yICh2YXIgcyA9IDA7IHMgPCBtb3N0X3dvcmRzLmxlbmd0aDsgcysrKSB7CiAgICAgICAgICAgICAgbW9zdF93b3Jkc1tzXS5kaWZmLnRyaW0oKTsKICAgICAgICAgICAgICBtb3N0X3dvcmRzW3NdLmRpZmYgPSBtb3N0X3dvcmRzW3NdLmRpZmYgKyAiICI7CiAgICAgICAgICAgICAgZmluYWxfc2VudGVuY2UgPSBmaW5hbF9zZW50ZW5jZSArIG1vc3Rfd29yZHNbc10uZGlmZjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyB2YXIgZmluYWxfc2VudGVuY2UgPSBtb3N0X3dvcmRzLmpvaW4oIiIpOwogICAgICAgICAgICBmaW5hbF9zZW50ZW5jZXMucHVzaCh7CiAgICAgICAgICAgICAgZmluYWxfc2VudGVuY2U6IGZpbmFsX3NlbnRlbmNlLAogICAgICAgICAgICAgIGZpbmFsX3dvcmRzOiBtb3N0X3dvcmRzLAogICAgICAgICAgICB9KTsKICAgICAgICAgICAgb25seV9zZW50ZW5jZXMucHVzaChmaW5hbF9zZW50ZW5jZSk7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IG9ubHlfc2VudGVuY2VzLmxlbmd0aDsgdCsrKSB7CiAgICAgICAgICAgIHZhciBmaW5hbF9zZW50ZW5jZTEgPSBvbmx5X3NlbnRlbmNlc1t0XQogICAgICAgICAgICAgIC5yZXBsYWNlKC8oPGRlbFtePl0qPz4uKj88XC9kZWw+KS9nLCAiIikKICAgICAgICAgICAgICAucmVwbGFjZSgvKDxpbnNbXj5dKj8+KXwoPFwvaW5zPikvZywgIiIpCiAgICAgICAgICAgICAgLnJlcGxhY2UoLyg8c3ViaW5zW14+XSo/Pil8KDxcL3N1Ymlucz4pL2csICIiKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cob25seV9zZW50ZW5jZXNbdF0pCiAgICAgICAgICAgIG9ubHlfc2VudGVuY2VzMS5wdXNoKGZpbmFsX3NlbnRlbmNlMSk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhvbmx5X3NlbnRlbmNlczEpOwogICAgICAgICAgLy8gY29uc29sZS5sb2coImZpbmFsX2NvbnRleHQ6ICIsIGZpbmFsX3NlbnRlbmNlcyk7CiAgICAgICAgICB0aGlzLmZpbmFsX2NvbnRleHQgPSBmaW5hbF9zZW50ZW5jZXM7CiAgICAgICAgICB0aGlzLnNlbnRlbmNlTGlzdCA9IG9ubHlfc2VudGVuY2VzMTsKICAgICAgICB9KTsKICAgICAgLy8gY29uc29sZS5sb2coImFhYWEiLCB0aGlzLmRiTGlzdCk7CiAgICAgIC8v5pi+56S65o+Q56S65L+h5oGvCiAgICAgIC8vIHRoaXMuJG1lc3NhZ2UoewogICAgICAvLyAgIG1lc3NhZ2U6ICLlt7Lmm7TmlrAiLAogICAgICAvLyAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgLy8gfSk7CiAgICB9LAogICAgY29tcGFyZShhdHRyLCByZXYpIHsKICAgICAgLy/nrKzkuozkuKrlj4LmlbDmsqHmnInkvKDpgJIg6buY6K6k5Y2H5bqP5o6S5YiXCiAgICAgIGlmIChyZXYgPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV2ID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXYgPSByZXYgPyAxIDogLTE7CiAgICAgIH0KICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhLCBiKSB7CiAgICAgICAgYSA9IGFbYXR0cl07CiAgICAgICAgYiA9IGJbYXR0cl07CiAgICAgICAgaWYgKGEgPCBiKSB7CiAgICAgICAgICByZXR1cm4gcmV2ICogLTE7CiAgICAgICAgfQogICAgICAgIGlmIChhID4gYikgewogICAgICAgICAgcmV0dXJuIHJldiAqIDE7CiAgICAgICAgfQogICAgICAgIHJldHVybiAwOwogICAgICB9OwogICAgfSwKICAgIC8vRVM26K+t5rOVIOaVsOe7hOWOu+mHjQogICAgdW5pcXVlKGFycikgewogICAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KGFycikpOwogICAgfSwKICAgIHNob3dBbGwoZXZlbnQsIGluZGV4LCBzX2luZGV4KSB7CiAgICAgIGV2ZW50IHx8IChldmVudCA9IHdpbmRvdy5ldmVudCk7CiAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbgogICAgICAgID8gZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkKICAgICAgICA6IChldmVudC5jYW5jZWxCdWJibGUgPSB0cnVlKTsKICAgICAgdGhpcy50YWJsZURhdGEgPSBbXTsKICAgICAgLy9zX2luZGV46KGo56S65Y+l5a2Q5bqP5Y+377ybaW5kZXjooajnpLrljZXor43luo/lj7cKICAgICAgdGhpcy5zZWVuID0gdHJ1ZTsKICAgICAgdGhpcy5jdXJyZW50ID0gaW5kZXg7CiAgICAgIHRoaXMudGVtcGluZGV4ID0gaW5kZXg7CiAgICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlOwogICAgICAvLyB0aGlzLmlzU2hvd0FsbCA9IHRydWU7CiAgICAgIHZhciB3b3JkcyA9IHRoaXMuZGJMaXN0W3NfaW5kZXhdLndvcmRzOwogICAgICB0aGlzLnRhYmxlRGF0YSA9IHdvcmRzW2luZGV4XS5kaWZmczsKICAgICAgLy8gZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRhYmxlRGF0YS5sZW5ndGg7IGkrKykgewogICAgICAvLyAgIHRoaXMudGFibGVEYXRhW2ldLm5hbWVzID0gdGhpcy51bmlxdWUodGhpcy50YWJsZURhdGFbaV0ubmFtZXMpOwogICAgICAvLyB0aGlzLnRhYmxlRGF0YVtpXS5uYW1lcyA9IHVuaXF1ZV9uYW1lcy5qb2luKCIsICIpOyAvL2J1Z++8muaKim5hbWVz6L+Z5Liq5pWw57uE5Y+Y5oiQ5LqG5a2X56ym5LiyCiAgICAgIC8vIH0KICAgICAgdGhpcy5zZW5UYWJsZURhdGEgPSB0aGlzLmRiTGlzdFtzX2luZGV4XS5zZW50ZW5jZURpZmZzOwogICAgICAvLyBjb25zb2xlLmxvZygic2VuVGFibGVEYXRhOiAiLCB0aGlzLnNlblRhYmxlRGF0YSk7CiAgICAgIC8vIGNvbnNvbGUubG9nKCJ3b3JkczogIiwgd29yZHMpOwogICAgICAvLyBjb25zb2xlLmxvZygidGFibGVEYXRhOiAiLCB0aGlzLnRhYmxlRGF0YSk7CiAgICAgIHRoaXMuY2hhbmdlUG9zKGV2ZW50KTsKICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQpOwogICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuaGlkZVBhbmVsLCBmYWxzZSk7CiAgICB9LAogICAgY2xvc2VTaG93KCkgewogICAgICB0aGlzLnNlZW4gPSBmYWxzZTsKICAgICAgdGhpcy5jdXJyZW50ID0gbnVsbDsKICAgICAgdGhpcy50ZW1waW5kZXggPSBudWxsOwogICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7CiAgICAgIC8vIHRoaXMuaXNTaG93QWxsID0gZmFsc2U7CiAgICAgIHZhciB3b3JkT3BlcmF0ZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ3b3JkT3BlcmF0ZSIpOwogICAgICB3b3JkT3BlcmF0ZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJjbGljayIsIHRoaXMuaGlkZVBhbmVsLCBmYWxzZSk7CiAgICB9LAogICAgaGlkZVBhbmVsKGUpIHsKICAgICAgaWYgKHRoaXMuJHJlZnMubWFpbiAmJiAhdGhpcy4kcmVmcy5tYWluLmNvbnRhaW5zKGUudGFyZ2V0KSkgewogICAgICAgIC8v54K55Ye76Zmk5by55Ye65bGC5aSW55qE56m655m95Yy65Z+fCiAgICAgICAgdGhpcy5jbG9zZVNob3coKTsKICAgICAgfQogICAgfSwKICAgIHBpcCgpIHsKICAgICAgaWYgKHRoaXMuaXNWaWRlbykgewogICAgICAgIHZhciB2aWRlbyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIiN2aWRlbyA+IHZpZGVvIik7CiAgICAgICAgaWYgKCFkb2N1bWVudC5waWN0dXJlSW5QaWN0dXJlRWxlbWVudCkgewogICAgICAgICAgLy/lvIDlkK8KICAgICAgICAgIHZpZGVvLnJlcXVlc3RQaWN0dXJlSW5QaWN0dXJlKCkuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKAogICAgICAgICAgICAgIGVycm9yLAogICAgICAgICAgICAgICJWaWRlbyBmYWlsZWQgdG8gZW50ZXIgUGljdHVyZS1pbi1QaWN0dXJlIG1vZGUuIgogICAgICAgICAgICApOwogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8v5YWz6ZetCiAgICAgICAgICBkb2N1bWVudC5leGl0UGljdHVyZUluUGljdHVyZSgpLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICBjb25zb2xlLmxvZygKICAgICAgICAgICAgICBlcnJvciwKICAgICAgICAgICAgICAiVmlkZW8gZmFpbGVkIHRvIGxlYXZlIFBpY3R1cmUtaW4tUGljdHVyZSBtb2RlLiIKICAgICAgICAgICAgKTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLiRub3RpZnkoewogICAgICAgICAgLy8gdGl0bGU6ICLorablkYoiLAogICAgICAgICAgdHlwZTogIndhcm5pbmciLAogICAgICAgICAgbWVzc2FnZTogIuW9k+WJjeaWh+S7tuaIlua1j+iniOWZqOS4jeaUr+aMgeeUu+S4reeUu+aooeW8jyIsCiAgICAgICAgICBwb3NpdGlvbjogInRvcC1yaWdodCIsCiAgICAgICAgICBvZmZzZXQ6IDEwMCwKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvLyDorqHnrpfliIbmlbAKICAgIGNvdW50U2NvcmVzKCkgewogICAgICAvLyB0aGlzLiRheGlvcwogICAgICAvLyAgIC5wb3N0KHRoaXMuYXBpICsgIi9nZXRWZXJzaW9ucyIsIHsgcGFyYW1zOiB7IF9pZDogdGhpcy5kaWZmSWQgfSB9KQogICAgICAvLyAgIC50aGVuKChyZXMpID0+IHsKICAgICAgLy8gICAgIHRoaXMudmVyc2lvbnNMaXN0ID0gcmVzLmRhdGE7IC8v6I635Y+W5q+P5Liq5Lq655qE54mI5pysCiAgICAgIC8vICAgfSk7CiAgICAgIHZhciB7IHRzLCBmbmwgfSA9IGNvdW50VGVjaFNjb3JlcygKICAgICAgICB0aGlzLmRpZmZMaXN0LAogICAgICAgIHRoaXMucHVibGlzaGVyLAogICAgICAgIHRoaXMudGVjaFBvaW50cywKICAgICAgICB0aGlzLnN1Ym1pdHRlZCwKICAgICAgICAwLjYsCiAgICAgICAgNgogICAgICApOwogICAgICB2YXIgeyBjbXMsIG1zIH0gPSBjb3VudE1hdGNoUG9pbnRzKAogICAgICAgIHRoaXMudmVyc2lvbnNMaXN0LAogICAgICAgIHRoaXMuc2VudGVuY2VMaXN0LAogICAgICAgIHRoaXMucHVibGlzaGVyLAogICAgICAgIHRoaXMucHVibGlzaFRpbWUsCiAgICAgICAgdGhpcy5kZWFkbGluZSwKICAgICAgICB0aGlzLm1hdGNoUG9pbnRzCiAgICAgICk7CiAgICAgIHRoaXMudGVjaFNjb3JlTGlzdCA9IHRzOwogICAgICB0aGlzLm1hdGNoU2NvcmVMaXN0ID0gbXM7CiAgICAgIHZhciBzdW0gPSAwOwogICAgICB2YXIgc2NvcmVMaXN0ID0gW107CiAgICAgIHZhciBzID0gQXJyYXkuZnJvbShuZXcgU2V0KHRoaXMuc3VibWl0dGVkKSk7IC8v5aaC56ys5LiA5Liq5Lq65Ye6546w5Lik5qyh77yM5YiZ5Y676Zmk6YeN5aSN5YC8CiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcy5sZW5ndGg7IGorKykgewogICAgICAgIHZhciBuYW1lID0gc1tqXTsKICAgICAgICB0aGlzLnRlY2hTY29yZUxpc3RbbmFtZV0gPSAhdGhpcy50ZWNoU2NvcmVMaXN0W25hbWVdCiAgICAgICAgICA/IDAKICAgICAgICAgIDogdGhpcy50ZWNoU2NvcmVMaXN0W25hbWVdOwogICAgICAgIHRoaXMubWF0Y2hTY29yZUxpc3RbbmFtZV0gPSAhdGhpcy5tYXRjaFNjb3JlTGlzdFtuYW1lXQogICAgICAgICAgPyAwCiAgICAgICAgICA6IHRoaXMubWF0Y2hTY29yZUxpc3RbbmFtZV07CiAgICAgICAgaWYgKG5hbWUgIT0gdGhpcy5wdWJsaXNoZXIpIHsKICAgICAgICAgIHZhciBzY29yZXMgPQogICAgICAgICAgICBOdW1iZXIodGhpcy50ZWNoU2NvcmVMaXN0W25hbWVdKSArCiAgICAgICAgICAgIE51bWJlcih0aGlzLm1hdGNoU2NvcmVMaXN0W25hbWVdKTsKICAgICAgICAgIHN1bSArPSBzY29yZXM7CiAgICAgICAgICBzY29yZUxpc3QucHVzaCh7CiAgICAgICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgICAgIG1hdGNoU2NvcmVzOiB0aGlzLm1hdGNoU2NvcmVMaXN0W25hbWVdLAogICAgICAgICAgICB0ZWNoU2NvcmVzOiB0aGlzLnRlY2hTY29yZUxpc3RbbmFtZV0sCiAgICAgICAgICAgIHNjb3Jlczogc2NvcmVzLAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHRoaXMuYXZlclNjb3JlcyA9IE1hdGgucm91bmQoc3VtIC8gc2NvcmVMaXN0Lmxlbmd0aCk7CgogICAgICBzY29yZUxpc3Quc29ydCh0aGlzLmNvbXBhcmUoInNjb3JlcyIpKTsKICAgICAgdmFyIHJhbmtMaXN0ID0gW107CgogICAgICB2YXIgcEluZGV4ID0gcy5maW5kSW5kZXgoKGl0ZW0pID0+IGl0ZW0gPT0gdGhpcy5wdWJsaXNoZXIpOwogICAgICBwSW5kZXggIT0gLTEgPyBzLnNwbGljZShwSW5kZXgsIDEpIDogczsKICAgICAgLy8g5pyJ5Y+R5biD6ICF5YiZ5oqK5Y+R5biD6ICF5Y675o6JLOaXoOWImeS/neaMgeWOn+agtwoKICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgc2NvcmVMaXN0W2pdLnJhbmsgPSBqKzE7CiAgICAgICAgcmFua0xpc3QucHVzaCh7IG5hbWU6IHNjb3JlTGlzdFtqXS5uYW1lLCByYW5rOiByYW5rIH0pOwogICAgICB9CgogICAgICBpZiAoc2NvcmVMaXN0ICE9IFtdICYmIHRoaXMuYXZlclNjb3JlcykgewogICAgICAgIHRoaXMudGVjaExpc3QgPSBmbmw7CiAgICAgICAgdGhpcy5tYXRjaExpc3QgPSBjbXM7CiAgICAgICAgdGhpcy5zY29yZUxpc3QgPSBzY29yZUxpc3Q7CiAgICAgICAgdGhpcy4kYXhpb3MucG9zdCh0aGlzLmFwaSArICIvdXBkYXRlU2NvcmVzTGlzdCIsIHsKICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICBfaWQ6IHRoaXMuZGlmZklkLAogICAgICAgICAgICBzY29yZUxpc3Q6IHRoaXMuc2NvcmVMaXN0LAogICAgICAgICAgICB0ZWNoTGlzdDogdGhpcy50ZWNoTGlzdCwKICAgICAgICAgICAgbWF0Y2hMaXN0OiB0aGlzLm1hdGNoTGlzdCwKICAgICAgICAgICAgYXZlclNjb3JlczogdGhpcy5hdmVyU2NvcmVzLAogICAgICAgICAgfSwKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvL+iOt+W+l+WIhuaVsOWIl+ihqAogICAgaXNTY29yZXNMaXN0KCkgewogICAgICB2YXIgaW5kZXggPSBudWxsOwogICAgICB0aGlzLmNoZWNrU3RhdHVzKCk7IC8v5Yik5pat6Lqr5Lu9CiAgICAgIC8vIOWIpOaWreaPkOS6pOWQjeWNleaYr+WQpuWtmOWcqOWPkeW4g+iAhQogICAgICB2YXIgbmV3TGVuID0gQXJyYXkuZnJvbShuZXcgU2V0KHRoaXMuc3VibWl0dGVkKSk7CiAgICAgIHZhciBwSW5kZXggPSBuZXdMZW4uZmluZEluZGV4KChpdGVtKSA9PiBpdGVtID09IHRoaXMucHVibGlzaGVyKTsKICAgICAgLy8g5pyJ5Y+R5biD6ICF5YiZ5oqK5pWw57uE6ZW/5bqm5omj5Y67MSzml6DliJnkv53mjIHljp/moLcKICAgICAgbmV3TGVuID0gcEluZGV4ICE9IC0xID8gbmV3TGVuLmxlbmd0aCA6IG5ld0xlbi5sZW5ndGggLSAxOwoKICAgICAgaWYgKAogICAgICAgIHRoaXMuc2NvcmVMaXN0ID09ICIiIHx8CiAgICAgICAgdGhpcy5zY29yZUxpc3QgPT0gdW5kZWZpbmVkIHx8IC8v5aaC5p6cc2NvcmVMaXN05Li656m6CiAgICAgICAgIXRoaXMuYXZlclNjb3JlcyAvL+WmguaenOW5s+Wdh+WIhuS4uuepugogICAgICAgIC8vIHx8IGlzRXhjZWVkCiAgICAgICkgewogICAgICAgIGlmIChuZXdMZW4gPD0gMCkgewogICAgICAgICAgLy/liKTmlq3mmK/lkKblj5HluIPogIXkuLrnrKzkuIDkuKrmj5DkuqTnmoTkuroKICAgICAgICAgIHRoaXMuc2NvcmVzID0gIui/mOayoeacieS6uuWPguS4juS/ruaUueacrOasoeS7u+WKoe+8gSI7CiAgICAgICAgICB0aGlzLmlzU3VibWl0dGVkID0gZmFsc2U7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY291bnRTY29yZXMoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5zY29yZUxpc3Quc29ydCh0aGlzLmNvbXBhcmUoInNjb3JlcyIpKTsKICAgICAgaWYgKAogICAgICAgIHRoaXMuc3VibWl0dGVkLmZpbmRJbmRleCgoaXRlbSkgPT4gaXRlbSA9PT0gdGhpcy51c2VybmFtZSkgPT0gLTEgfHwKICAgICAgICB0aGlzLnVzZXJuYW1lID09IHRoaXMucHVibGlzaGVyCiAgICAgICkgewogICAgICAgIC8v6K+l55So5oi35rKh5pyJ5Y+C5LiO5pys5qyh5Lu75Yqh5oiW5piv5Y+R5biD6ICFCiAgICAgICAgdGhpcy5zY29yZXMgPSB0aGlzLmF2ZXJTY29yZXMgKyAi77yI5bmz5Z2H5YiG77yJIjsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgaW5kZXggPSB0aGlzLnNjb3JlTGlzdC5maW5kSW5kZXgoCiAgICAgICAgICAoaXRlbSkgPT4gaXRlbS5uYW1lID09PSB0aGlzLnVzZXJuYW1lCiAgICAgICAgKTsKICAgICAgICB2YXIgcmFuayA9IHRoaXMuc2NvcmVMaXN0W2luZGV4XS5yYW5rOwogICAgICAgIHRoaXMubXlSYW5rID0gcmFuazsKICAgICAgICB0aGlzLnNjb3JlcyA9CiAgICAgICAgICB0aGlzLnNjb3JlTGlzdFtpbmRleF0uc2NvcmVzICsgIiDkvaDmnKzmrKHotoXotorkuoYiICsgcmFuayArICIl55qE5Lq65ZaU77yBIjsKICAgICAgfQogICAgICBpZiAodGhpcy51c2VybmFtZSA9PSB0aGlzLnB1Ymxpc2hlcikgewogICAgICAgIC8vIOabtOaWsOWPkeW4g+iAheKAnG15UHVibGlzaGVk4oCd5Lit55qE5bmz5Z2H5YiGCiAgICAgICAgdGhpcy4kYXhpb3MucG9zdCh0aGlzLmFwaSArICIvdXBkYXRlTXlQdWJsaXNoZWRTY29yZXMiLCB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgX2lkOiB0aGlzLnVzZXJJZCwKICAgICAgICAgICAgdGFza0lkOiB0aGlzLmRpZmZJZCwKICAgICAgICAgICAgc2NvcmVMaXN0OiB0aGlzLnNjb3JlTGlzdCwKICAgICAgICAgICAgdGVjaExpc3Q6IHRoaXMudGVjaExpc3QsCiAgICAgICAgICAgIG1hdGNoTGlzdDogdGhpcy5tYXRjaExpc3QsCiAgICAgICAgICAgIGF2ZXJTY29yZXM6IHRoaXMuYXZlclNjb3JlcywKICAgICAgICAgIH0sCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoCiAgICAgICAgdGhpcy5zdWJtaXR0ZWQuZmluZEluZGV4KChpdGVtKSA9PiBpdGVtID09PSB0aGlzLnVzZXJuYW1lKSAhPSAtMSAmJgogICAgICAgIHRoaXMudXNlcm5hbWUgIT0gdGhpcy5wdWJsaXNoZXIKICAgICAgKSB7CiAgICAgICAgLy8g5pu05paw55So5oi34oCcbXlUYXNrc+KAneS4reeahOWIhuaVsAogICAgICAgIHRoaXMuJGF4aW9zLnBvc3QodGhpcy5hcGkgKyAiL3VwZGF0ZU15VGFza3NTY29yZXMiLCB7CiAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgX2lkOiB0aGlzLnVzZXJJZCwKICAgICAgICAgICAgdGFza0lkOiB0aGlzLmRpZmZJZCwKICAgICAgICAgICAgc2NvcmVzOiB0aGlzLnNjb3JlTGlzdFtpbmRleF0uc2NvcmVzCiAgICAgICAgICAgICAgPyB0aGlzLnNjb3JlTGlzdFtpbmRleF0uc2NvcmVzCiAgICAgICAgICAgICAgOiAiIiwKICAgICAgICAgICAgdXNlclJhbms6IHRoaXMubXlSYW5rLAogICAgICAgICAgfSwKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICAvL+avlOi+g+aXpeacn+Wkp+WwjwogICAgY29tcGFyZURhdGUoRGF0ZTEsIERhdGUyKSB7CiAgICAgIGlmIChEYXRlMS5zZWFyY2goIi8iKSA9PSAtMSkgewogICAgICAgIC8v5aaC5p6c5qih5byP5Li6IjIwMjEvMDIvMDYgMDA6MDA6MDAiCiAgICAgICAgRGF0ZTEgPSBEYXRlMS5yZXBsYWNlKCItIiwgIi8iKTsgLy/ovazmjaLmiJDmoIflh4bmoLzlvI8KICAgICAgfQogICAgICBpZiAoRGF0ZTIuc2VhcmNoKCIvIikgPT0gLTEpIHsKICAgICAgICBEYXRlMiA9IERhdGUyLnJlcGxhY2UoIi0iLCAiLyIpOwogICAgICB9CiAgICAgIGlmIChEYXRlMS5zcGxpdCgiICIpWzBdID09IERhdGUyLnNwbGl0KCIgIilbMF0pIHsKICAgICAgICAvL+WmguaenOaYr+WQjOS4gOWkqe+8jOWImeavlOi+g+aXtuWIhuenkgogICAgICAgIHZhciB0aW1lMSA9IERhdGUxLnNwbGl0KCIgIilbMV0uc3BsaXQoIjoiKTsKICAgICAgICB2YXIgdGltZTIgPSBEYXRlMi5zcGxpdCgiICIpWzFdLnNwbGl0KCI6Iik7CiAgICAgICAgdmFyIHRvdGFsMSA9CiAgICAgICAgICBOdW1iZXIodGltZTFbMF0pICogMzYwMCArIE51bWJlcih0aW1lMVsxXSkgKiA2MCArIE51bWJlcih0aW1lMVsyXSk7CiAgICAgICAgdmFyIHRvdGFsMiA9CiAgICAgICAgICBOdW1iZXIodGltZTJbMF0pICogMzYwMCArIE51bWJlcih0aW1lMlsxXSkgKiA2MCArIE51bWJlcih0aW1lMlsyXSk7CiAgICAgICAgcmV0dXJuIHRvdGFsMSAtIHRvdGFsMiA+PSAwID8gdHJ1ZSA6IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBvRGF0ZTEgPSBuZXcgRGF0ZShEYXRlMS5zcGxpdCgiICIpWzBdKTsKICAgICAgICB2YXIgb0RhdGUyID0gbmV3IERhdGUoRGF0ZTIuc3BsaXQoIiAiKVswXSk7CiAgICAgICAgcmV0dXJuIG9EYXRlMSA+PSBvRGF0ZTIgPyB0cnVlIDogZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICAvL+afpeeci+WIhuaVsOWIl+ihqAogICAgY2hlY2tTY29yZXNEZXRhaWxzKCkgewogICAgICBpZiAodGhpcy5pc1B1Ymxpc2hlcikgewogICAgICAgIHZhciBwYXRoID0gIi9kaWZmLyIgKyB0aGlzLmRpZmZJZCArICIvc2NvcmVzIjsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaChwYXRoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgcGF0aCA9ICIvZGlmZi8iICsgdGhpcy5kaWZmSWQgKyAiL3Njb3Jlc1N0dSI7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2gocGF0aCk7CiAgICAgIH0KICAgIH0sCiAgICAvLyDmo4Dmn6Xouqvku70KICAgIGNoZWNrU3RhdHVzKCkgewogICAgICB2YXIgaW5kZXggPSB0aGlzLnN1Ym1pdHRlZC5maW5kSW5kZXgoKGl0ZW0pID0+IGl0ZW0gPT0gdGhpcy51c2VybmFtZSk7CiAgICAgIGlmICh0aGlzLnVzZXJuYW1lID09IHRoaXMucHVibGlzaGVyKSB7CiAgICAgICAgdGhpcy5pc1B1Ymxpc2hlciA9IHRydWU7CiAgICAgICAgdGhpcy5pc1N1Ym1pdHRlZCA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoaW5kZXggIT0gLTEpIHsKICAgICAgICB0aGlzLmlzU3VibWl0dGVkID0gdHJ1ZTsKICAgICAgfQogICAgfSwKCiAgICBtYW51YWxDb2Zpcm0oKSB7CiAgICAgIC8v5omL5Yqo56Gu6K6k5ZCO5omn6KGM566X5YiG55qE5Ye95pWwCiAgICAgIHRoaXMuaXNTY29yZXNMaXN0KCk7CiAgICAgIHRoaXMuaXNNYW51YWwgPSAhdGhpcy5pc01hbnVhbDsKICAgICAgdGhpcy5pc0NvbmZpcm0gPSAhdGhpcy5pc0NvbmZpcm07CiAgICAgIHRoaXMuc2V0TWFudWFsKCk7CiAgICB9LAoKICAgIHNldE1hbnVhbCgpIHsKICAgICAgLy/orr7nva7mmK/lkKbmiYvliqjnoa7orqTliIbmlbAKICAgICAgdGhpcy4kYXhpb3MucG9zdCh0aGlzLmFwaSArICIvdXBkYXRlSXNNYW51YWwiLCB7CiAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICBfaWQ6IHRoaXMuZGlmZklkLAogICAgICAgICAgaXNNYW51YWw6IHRoaXMuaXNNYW51YWwsCiAgICAgICAgICBpc0NvbmZpcm06IHRoaXMuaXNDb25maXJtLAogICAgICAgIH0sCiAgICAgIH0pOwogICAgfSwKCiAgICAvL3ZpZGVvIHBsYXkgJiBsb2FkICYgcGF1c2UKICAgIHBsYXlGdW5jKCkgewogICAgICB0aGlzLmlzQ291bnRUaW1lID0gdHJ1ZTsKICAgICAgY29uc29sZS5sb2coInBsYXlpbmciKTsKICAgIH0sCiAgICBwYXVzZUZ1bmMoKSB7CiAgICAgIHRoaXMuaXNDb3VudFRpbWUgPSBmYWxzZTsKICAgICAgY29uc29sZS5sb2coInBhc3VzZWQiKTsKICAgICAgLy8geW91ciBjb2RlCiAgICB9LAogICAgbG9hZGVkKCkgewogICAgICB0aGlzLmlzQ291bnRUaW1lID0gZmFsc2U7CiAgICAgIGNvbnNvbGUubG9nKCJ3YWl0aW5nIik7CiAgICB9LAogICAgc3RhcnRUaW1lKCl7CiAgICAgIHRoaXMuaXNDb3VudFRpbWUgPSB0cnVlOwogICAgICBjb25zb2xlLmxvZygibW92aW5nIik7CiAgICB9LAogCiB1cGRhdGVTdHVkeVRpbWUoKXsKICAgIGxldCBuZXdkYXRlPXRoaXMuJG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoIllZWVkvTU0vREQgSEg6bW06c3MiKQogICAgdmFyIHRpbWVzcGFuID0gdGhpcy50aW1lc3BhbgogICAgICB0aGlzLiRheGlvcy5wb3N0KCcvc2NvcmUvdXBkYXRlU3R1ZHlUaW1lJyx7CiAgICAgICAgcGFyYW1zOnsKICAgICAgICAgIF9pZDogdGhpcy51c2VySWQsCiAgICAgICAgICBsaXN0ZW5UaW1lOiB0aW1lc3BhbiwKICAgICAgICAgIHJlY29yZFRpbWU6IG5ld2RhdGUsCiAgICAgICAgfQogICAgICB9KQogICAgfQoKICAgIH0sCiAgLy/pobXpnaLnlJ/miJDliY3opoHlgZrnmoTlt6XkvZwKICBjcmVhdGVkKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIHRoaXMudXBkYXRlU3R1ZHlUaW1lKQogICAgLy/lj6/ku6XogIPomZHliqDkuKrliqjnlLvvvIzlm6DkuLrmnInovoPlpJrmlbDmja7opoHliqDovb3vvIzkuI3nhLbkvJrmmL7lvpfpobXpnaLljaHpob8KICAgIHRoaXMuZGlmZklkID0gdGhpcy4kcm91dGUucGFyYW1zLmRpZmZJZDsKICAgIHRoaXMudXNlcm5hbWUgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKCJ1c2VyTmFtZSIpOwogICAgdGhpcy4kYXhpb3MuZ2V0KHRoaXMuYXBpICsgIi9wcm9maWxlP25hbWU9IiArIHRoaXMudXNlcm5hbWUpLnRoZW4oKHJlcykgPT4gewogICAgICB0aGlzLnVzZXJJZCA9IHJlcy5kYXRhWzBdLl9pZDsKICAgICAgdGhpcy51c2VyU3RhdHVzID0gcmVzLmRhdGFbMF0uc3RhdHVzOwogICAgfSk7CiAgICB0aGlzLiRheGlvcwogICAgICAucG9zdCh0aGlzLmFwaSArICIvZ2V0VmVyc2lvbnMiLCB7IHBhcmFtczogeyBfaWQ6IHRoaXMuZGlmZklkIH0gfSkKICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgIHRoaXMudmVyc2lvbnNMaXN0ID0gcmVzLmRhdGE7IC8v6I635Y+W5q+P5Liq5Lq655qE54mI5pysCiAgICAgIH0pOwogICAgLy/muLLmn5PkuYvliY3or7fmsYLmlbDmja7vvIzliKTmlq3mmK/lkKbmnInnrKzkuIDniYjmnKwKICAgIHRoaXMuJGF4aW9zCiAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRUYXNrP19pZD0iICsgdGhpcy5kaWZmSWQpCiAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICB2YXIgdmlkZW9faWQgPSByZXMuZGF0YVswXS52aWRlb0lkOyAvL+WvueW6lOinhumikeeahF9pZAogICAgICAgIHRoaXMudXNlckxpc3QgPSByZXMuZGF0YVswXS51c2VyTGlzdDsKICAgICAgICB0aGlzLmRpZmZMaXN0ID0gcmVzLmRhdGFbMF0uZGlmZkxpc3Q7CiAgICAgICAgdGhpcy5wdWJsaXNoZXIgPSByZXMuZGF0YVswXS5wdWJsaXNoZXI7CiAgICAgICAgdGhpcy5zdWJtaXR0ZWQgPSByZXMuZGF0YVswXS5zdWJtaXR0ZWQ7CiAgICAgICAgdGhpcy5wdWJsaXNoVGltZSA9IHJlcy5kYXRhWzBdLnRpbWU7CiAgICAgICAgdGhpcy50YXNrVGl0bGUgPSByZXMuZGF0YVswXS50aXRsZTsKICAgICAgICB0aGlzLmRlYWRsaW5lID0gcmVzLmRhdGFbMF0uZGVhZGxpbmU7CiAgICAgICAgdGhpcy50YXNrTGFiZWxzID0gcmVzLmRhdGFbMF0ubGFiZWw7CiAgICAgICAgdGhpcy5zY29yZUxpc3QgPSByZXMuZGF0YVswXS5zY29yZUxpc3Q7CiAgICAgICAgdGhpcy50ZWNoTGlzdCA9IHJlcy5kYXRhWzBdLnRlY2hMaXN0OwogICAgICAgIHRoaXMubWF0Y2hMaXN0ID0gcmVzLmRhdGFbMF0ubWF0Y2hMaXN0OwogICAgICAgIHRoaXMuYXZlclNjb3JlcyA9IHJlcy5kYXRhWzBdLmF2ZXJTY29yZXM7CiAgICAgICAgdGhpcy5pc01hbnVhbCA9IHJlcy5kYXRhWzBdLmlzTWFudWFsOwogICAgICAgIHRoaXMuaXNDb25maXJtID0gcmVzLmRhdGFbMF0uaXNDb25maXJtOwogICAgICAgIGNvbnNvbGUubG9nKCJsbGwiLCB0aGlzLnN1Ym1pdHRlZCk7CgogICAgICAgIC8vIGxldCBkYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAvLyBsZXQgbmV3ZGF0ZSA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoImNoaW5lc2UiLCB7CiAgICAgICAgLy8gICBob3VyMTI6IGZhbHNlLAogICAgICAgIC8vIH0pOwogICAgICAgIGxldCBuZXdkYXRlPXRoaXMuJG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoIllZWVkvTU0vREQgSEg6bW06c3MiKQogICAgICAgIHZhciBpc091dCA9IHRoaXMuY29tcGFyZURhdGUobmV3ZGF0ZSwgdGhpcy5kZWFkbGluZSk7CiAgICAgICAgY29uc29sZS5sb2coImlzT3V0IiwgaXNPdXQpOwogICAgICAgIGlmICh0aGlzLnVzZXJTdGF0dXMgPT0gIjEiKSB7CiAgICAgICAgICB0aGlzLmlzVGVhY2hlciA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnVzZXJTdGF0dXMgPT0gIjAiKSB7CiAgICAgICAgICB0aGlzLmlzVGVhY2hlciA9IGZhbHNlOwogICAgICAgICAgaWYgKGlzT3V0KSB7CiAgICAgICAgICAgIHRoaXMuaXNyZWFkb25seSA9IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy4kYXhpb3MKICAgICAgICAgIC5nZXQodGhpcy5hcGkgKyAiL2N1cnJlbnRWaWRlb1B1Ymxpc2hlcj9uYW1lPSIgKyB0aGlzLnB1Ymxpc2hlcikKICAgICAgICAgIC50aGVuKChyZXMpID0+IHsKICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSByZXMuZGF0YVswXS5zdGF0dXM7CiAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA9PSAiMSIpIHsKICAgICAgICAgICAgICB0aGlzLmlkZW50aXR5ID0gIuiAgeW4iCI7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID09ICIyIikgewogICAgICAgICAgICAgIHRoaXMuaWRlbnRpdHkgPSAi57uE6ZW/IjsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgLy8gY29uc29sZS5sb2codGhpcy51c2VyTGlzdCk7CiAgICAgICAgLy/ojrflj5bop4bpopHot6/lvoTvvIzku47mnI3liqHlmajojrflj5YKICAgICAgICB0aGlzLiRheGlvcwogICAgICAgICAgLmdldCh0aGlzLmFwaSArICIvY3VycmVudFZpZGVvP19pZD0iICsgdmlkZW9faWQpCiAgICAgICAgICAudGhlbigocmVzKSA9PiB7CiAgICAgICAgICAgIHRoaXMuZmlsZU5hbWUgPSByZXMuZGF0YVswXS5maWxlTmFtZTsKICAgICAgICAgICAgdmFyIGZpbGV0eXBlID0gdGhpcy5maWxlTmFtZS5zcGxpdCgiLiIpWzFdOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmlkZW9UeXBlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKGZpbGV0eXBlID09IHRoaXMudmlkZW9UeXBlW2ldKSB7CiAgICAgICAgICAgICAgICB0aGlzLmlzVmlkZW8gPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgLy/lhYjliKTmlq3mmK/lkKbmnInkv67mlLnorrDlvZXvvIzlho3liKTmlq3mmK/lkKbmnInnrKzkuIDniYjmnKwKICAgICAgICBpZiAodGhpcy5kaWZmTGlzdC5sZW5ndGggPT0gMCkgewogICAgICAgICAgdGhpcy4kYXhpb3MKICAgICAgICAgICAgLmdldCh0aGlzLmFwaSArICIvYWxsVmVyc2lvbnM/X2lkPSIgKyB0aGlzLmRpZmZJZCkKICAgICAgICAgICAgLnRoZW4oKHJlcykgPT4gewogICAgICAgICAgICAgIGlmIChyZXMuZGF0YS5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgLy/lvZPliY3ml6Dkurrmj5DkuqTniYjmnKzvvIzmmL7npLrovpPlhaXmoYYKICAgICAgICAgICAgICAgIHRoaXMuaXN2ZXJzaW9uMSA9IGZhbHNlOwogICAgICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuaXN2ZXJzaW9uMSA9IHRydWU7CiAgICAgICAgICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRoaXMudGV4dF92MSA9IHJlcy5kYXRhWzBdLnZlcnNpb247CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy/lvaLmiJDnu7zlkIjniYjmnKwKICAgICAgICAgIHRoaXMuY3JlYXRlRmluYWxWZXJzaW9uKCk7CiAgICAgICAgICB0aGlzLmlzdmVyc2lvbjEgPSB0cnVlOwogICAgICAgICAgdGhpcy5pc0ZpbmFsID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0pOwogICAgaWYgKHRoaXMuc3VibWl0dGVkLmxlbmd0aCA9PSAwKSB7CiAgICAgIHRoaXMuaXNTY29yZXNMaXN0KCk7CiAgICB9CiAgfSwKICB1cGRhdGVkKCkgewogICAgLy/liKTmlq3mmK/pn7PpopHov5jmmK/op4bpopEKICAgIHRoaXMuZGVjaWRlUGxheWVyKCk7CiAgICAvLyBsZXQgZGF0ZSA9IG5ldyBEYXRlKCk7CiAgICAvLyBsZXQgbmV3ZGF0ZSA9IGRhdGUudG9Mb2NhbGVTdHJpbmcoImNoaW5lc2UiLCB7CiAgICAvLyAgIGhvdXIxMjogZmFsc2UsCiAgICAvLyB9KTsKICAgIGxldCBuZXdkYXRlPXRoaXMuJG1vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoIllZWVkvTU0vREQgSEg6bW06c3MiKQogICAgLy8oIjIwMjEvMDIvMDYgMDA6MDA6MDAiLCAiMjAyMS8wMi8wNSAwMDowMDowMCIgbmV3ZGF0ZSwgdGhpcy5kZWFkbGluZSkKICAgIHZhciBpc0RETCA9IHRoaXMuY29tcGFyZURhdGUobmV3ZGF0ZSwgdGhpcy5kZWFkbGluZSk7CiAgICBpZiAoCiAgICAgIHRoaXMuc3VibWl0dGVkLmxlbmd0aCA+PSAxICYmCiAgICAgICF0aGlzLmlzTWFudWFsICYmCiAgICAgIChpc0RETCB8fCB0aGlzLmlzQ29uZmlybSkKICAgICkgewogICAgICAvL+WmguaenOaPkOS6pOWQjeWNleWkp+S6jjEs5LiU5Li66Ieq5Yqo6K6h566X77yM6L+H5LqGZGRs5oiW5bey57uP56Gu6K6k6L+H77yM5YiZ6L+Q6KGM5Ye95pWwCiAgICAgIHRoaXMuaXNTY29yZXNMaXN0KCk7CiAgICB9CiAgfSwKICBtb3VudGVkKCkgewogICAgc2V0SW50ZXJ2YWwoKCkgPT4gewogICAgICBpZiAodGhpcy5pc0NvdW50VGltZSkgewogICAgICAgIHRoaXMudGltZXNwYW4gKz0gMC4xOwogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudGltZXNwYW4pOwogICAgICB9CiAgICB9LCAxMDApOwogICAgLy93aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgdGhpcy51cGRhdGVTdHVkeVRpbWUpICAgICAgICAKICAgIC8vIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJrZXlwcmVzcyIsIHRoaXMuc3RhcnRUaW1lKCkpOwogIH0sCiAgZGVzdHJveWVkKCkgewogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCB0aGlzLnVwZGF0ZVN0dWR5VGltZSkKICAvLyB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigic2Nyb2xsIiwgdGhpcy5zZXRIZWFkUG9zaXRpb24sIHRydWUpOwp9LAp9OwoKCgo="},{"version":3,"sources":["diff.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8XA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"diff.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <!-- 按钮组合 -->\n    <div class=\"buttons\">\n      <el-popover placement=\"left\" trigger=\"hover\" content=\"前往综合版\">\n        <el-button\n          type=\"primary\"\n          icon=\"el-icon-arrow-down\"\n          circle\n          plain\n          v-if=\"isVideo\"\n          @click=\"toBest('#mainContent')\"\n          slot=\"reference\"\n        ></el-button>\n      </el-popover>\n      <br />\n      <el-popover placement=\"left\" trigger=\"hover\" content=\"画中画模式\">\n        <el-button\n          type=\"primary\"\n          icon=\"el-icon-monitor\"\n          circle\n          plain\n          v-if=\"isVideo\"\n          @click=\"pip()\"\n          slot=\"reference\"\n        ></el-button>\n      </el-popover>\n      <br />\n      <el-popover placement=\"left\" trigger=\"hover\" content=\"回到顶部\">\n        <el-button\n          type=\"primary\"\n          icon=\"el-icon-arrow-up\"\n          circle\n          plain\n          v-if=\"isVideo\"\n          @click=\"toTop()\"\n          slot=\"reference\"\n        ></el-button>\n      </el-popover>\n    </div>\n    <div>\n      <div class=\"video-container\">\n        <!-- 视频展现 -->\n        <div class=\"video-left-box\">\n          <div class=\"video-box\">\n            <vue-core-video-player\n              id=\"video\"\n              v-if=\"isVideo\"\n              :src=\"require('../assets/video/' + fileName)\"\n              cover=\"https://cdn.quasar.dev/img/parallax2.jpg\"\n              controls\n              :autoplay=\"autoplay\"\n              @play=\"playFunc\"\n              @pause=\"pauseFunc\"\n              @loadedmetadata=\"loaded\"\n            ></vue-core-video-player>\n            <audio\n              :src=\"require('../assets/video/' + fileName)\"\n              id=\"audio\"\n              controls\n              v-else\n              @play=\"playFunc\"\n              @pause=\"pauseFunc\"\n              @loadedmetadata=\"loaded\"\n              controlslist=\"nodownload\"\n            ></audio>\n          </div>\n          <div id=\"menu\" class=\"q-pa-md q-gutter-sm\">\n            <q-btn\n              class=\"q-mx-xl\"\n              @click=\"goBack\"\n              color=\"purple-4\"\n              icon-right=\"fast_rewind\"\n              label=\"Backward\"\n            />\n            <q-btn\n              class=\"q-mx-xl\"\n              @click=\"goForward\"\n              color=\"purple-4\"\n              icon=\"fast_forward\"\n              label=\"Forward\"\n            />\n          </div>\n        </div>\n        <!-- 信息卡片 -->\n        <div class=\"video-right-box\">\n          <q-card class=\"my-card\" flat bordered>\n            <q-item>\n              <q-item-section avatar>\n                <q-avatar>\n                  <img src=\"https://i04piccdn.sogoucdn.com/25ef1f0c2b4af7d7\" />\n                </q-avatar>\n              </q-item-section>\n\n              <q-item-section>\n                <q-item-label>{{ publisher }} ({{ identity }})</q-item-label>\n                <q-item-label caption>发布于 {{ publishTime }}</q-item-label>\n              </q-item-section>\n            </q-item>\n\n            <q-separator />\n\n            <q-list bordered separator>\n              <q-item clickable v-ripple>\n                <q-item-section>主题：{{ taskTitle }}</q-item-section>\n              </q-item>\n\n              <q-item clickable v-ripple>\n                <q-item-section>截止时间： {{ deadline }} </q-item-section>\n              </q-item>\n\n              <q-item clickable v-ripple>\n                <q-item-section\n                  v-if=\"submitted.length == 0 || submitted.length == 1\"\n                  >已修改人次： 0\n                </q-item-section>\n                <q-item-section v-else\n                  >已修改人次： {{ submitted.length - 1 }}</q-item-section\n                >\n              </q-item>\n              <q-item clickable v-ripple>\n                <q-item-section\n                  >本次分数：{{ scores }}\n                  <el-button\n                    type=\"primary\"\n                    size=\"mini\"\n                    v-if=\"isSubmitted\"\n                    @click=\"checkScoresDetails()\"\n                    >详情</el-button\n                  >\n                </q-item-section>\n              </q-item>\n            </q-list>\n          </q-card>\n          <br />\n          <el-switch\n            v-if=\"username == publisher && !isConfirm\"\n            v-model=\"isManual\"\n            active-text=\"手动确认成绩\"\n            inactive-text=\"自动确认成绩\"\n            @change=\"setManual()\"\n          >\n          </el-switch>\n          <br /><br />\n          <el-button\n            type=\"primary\"\n            v-if=\"isManual && username == publisher\"\n            @click=\"manualCofirm()\"\n            >手动确认成绩</el-button\n          >\n        </div>\n      </div>\n      <el-button type=\"primary\" @click=\"countScores()\">测试</el-button>\n      <br />\n      <el-main v-loading=\"loading\" id=\"mainContent\">\n        <el-row :gutter=\"21\" type=\"flex\" class=\"row-bg\" justify=\"center\">\n          <el-col :span=\"21\" v-if=\"isversion1\">\n            <p class=\"edit-tip\">最优版本：</p>\n            <div id=\"textDiv\">\n              <div>\n                <span v-for=\"(item, index) in final_context\" :key=\"index\">\n                  <span\n                    v-for=\"(final_word, final_word_index) in item.final_words\"\n                    :key=\"final_word_index\"\n                    @click=\"showAll($event, final_word_index, index)\"\n                    :class=\"{ active: isActive }\"\n                  >\n                    <el-badge :is-dot=\"final_word.isedited\" class=\"badge\">\n                      <span\n                        v-if=\"regtest.test(final_word.diff)\"\n                        v-html=\"final_word.diff\"\n                      >\n                      </span>\n                      <span v-else>\n                        {{ final_word.diff }}\n                      </span>\n                    </el-badge>\n                  </span>\n                </span>\n              </div>\n            </div>\n            <div class=\"q-pa-md q-gutter-sm edit-btn\" v-if=\"isTeacher\">\n              <q-btn\n                glossy\n                color=\"purple-6\"\n                icon=\"edit\"\n                @click=\"changev1()\"\n                label=\"提交最优版\"\n              />\n            </div>\n            <div class=\"q-pa-md q-gutter-sm edit-btn\" v-else>\n              <q-btn\n                glossy\n                color=\"purple-6\"\n                icon=\"edit\"\n                @click=\"changev1()\"\n                label=\"Edit\"\n                v-show=\"isreadonly\"\n              />\n              <q-btn\n                glossy\n                color=\"purple-6\"\n                icon=\"edit\"\n                @click=\"returnback()\"\n                label=\"恢复\"\n                v-show=\"isreadonly\"\n              />\n            </div>\n          </el-col>\n          <el-col :span=\"20\" v-else>\n            <div>\n              <p class=\"edit-tip\">\n                当前还没有同学贡献听写版本哦~\n                快来贡献自己的版本吧！或者稍后再来！\n              </p>\n              <el-input\n                type=\"textarea\"\n                :rows=\"15\"\n                :autosize=\"{ minRows: 15, maxRows: 30 }\"\n                placeholder=\"开始听写···\"\n                v-model=\"text1\"\n                style=\"font-size: 20px\"\n              ></el-input>\n              <div class=\"q-px-md q-pt-md q-gutter-sm submit-btn\">\n                <q-btn color=\"purple\" @click=\"submitv1()\">Submit</q-btn>\n              </div>\n            </div>\n          </el-col>\n          <el-col :span=\"12\" v-if=\"isedit\">\n            <div>\n              <p class=\"edit-tip\">请修改：</p>\n              <div v-for=\"(item, i) in sentenceList\" :key=\"i\">\n                <el-input\n                  type=\"textarea\"\n                  :rows=\"1\"\n                  :autosize=\"{ minRows: 1, maxRows: 4 }\"\n                  v-model=\"sentenceList[i]\"\n                ></el-input>\n              </div>\n              <q-btn\n                @click=\"submitmv()\"\n                color=\"purple-5\"\n                icon=\"check\"\n                label=\"Confirm\"\n              />\n              <q-btn\n                class=\"q-mx-md\"\n                @click=\"cancelChangev1()\"\n                color=\"purple-5\"\n                icon=\"clear\"\n                label=\"Cancel\"\n              />\n              <q-btn\n                class=\"q-mx-md\"\n                @click=\"tempsave()\"\n                color=\"purple-5\"\n                icon=\"clear\"\n                label=\"暂时保留\"\n              />\n            </div>\n          </el-col>\n        </el-row>\n      </el-main>\n      <el-button\n        type=\"info\"\n        icon=\"el-icon-more\"\n        circle\n        @click=\"showTimeline()\"\n      ></el-button>\n      <div v-if=\"isTimeline\">\n        排序：\n        <el-radio-group v-model=\"reverse\">\n          <el-radio :label=\"true\">倒序</el-radio>\n          <el-radio :label=\"false\">正序</el-radio>\n        </el-radio-group>\n        <el-timeline :reverse=\"reverse\">\n          <el-timeline-item\n            v-for=\"(version, index) in versions\"\n            :key=\"index\"\n            :timestamp=\"version.time\"\n            placement=\"bottom\"\n          >\n            <el-card>\n              <p>{{ version.version }}</p>\n              <br />\n              <p>发布者：{{ version.name }}</p>\n            </el-card>\n          </el-timeline-item>\n        </el-timeline>\n        <el-button\n          type=\"danger\"\n          icon=\"el-icon-close\"\n          circle\n          @click=\"closeTimeline()\"\n        ></el-button>\n      </div>\n    </div>\n    <div id=\"wordOperate\" ref=\"main\">\n      <a class=\"aui_close\" @click=\"closeShow()\">×</a>\n      <el-table\n        :data=\"tableData.slice((currpage - 1) * pagesize, currpage * pagesize)\"\n        class=\"eltable\"\n      >\n        <el-table-column type=\"String\" prop=\"diff\" label=\"修改版本\" width=\"200\">\n          <template slot-scope=\"scope\">\n            <span v-html=\"scope.row.diff\"></span>\n          </template>\n        </el-table-column>\n        <el-table-column prop=\"names\" label=\"用户\" width=\"380\">\n          <template slot-scope=\"scope\">\n            <span v-for=\"(item, i) in scope.row.names\" :key=\"i\">\n              <span\n                v-if=\"item.username == submitted[0]\"\n                style=\"font-weight: bold\"\n                >{{ item.username + \"; \" }}</span\n              >\n              <span v-else>{{ item.username + \"; \" }}</span>\n            </span>\n          </template>\n        </el-table-column>\n      </el-table>\n      <el-pagination\n        layout=\"prev, pager, next\"\n        :page-size=\"pagesize\"\n        :current-page=\"currpage\"\n        :total=\"tableData.length\"\n        @current-change=\"handleCurrentChange\"\n        @size-change=\"handleSizeChange\"\n      >\n      </el-pagination>\n      <!-- 每个句子的不同详细版本 -->\n      <el-collapse>\n        <el-collapse-item style=\"padding-bottom: 1px\">\n          <template slot=\"title\">\n            句子详细版本：<i class=\"header-icon el-icon-info\"></i>\n          </template>\n          <el-table\n            :data=\"\n              senTableData.slice(\n                (currpageS - 1) * pagesizeS,\n                currpageS * pagesizeS\n              )\n            \"\n            class=\"eltable\"\n          >\n            <el-table-column prop=\"provider\" label=\"用户\" width=\"80\">\n              <template slot-scope=\"scope\">\n                <span>\n                  {{ scope.row.provider }}\n                </span>\n              </template>\n            </el-table-column>\n            <el-table-column\n              type=\"String\"\n              prop=\"sentenceDiff\"\n              label=\"修改版本\"\n              width=\"500\"\n            >\n              <template slot-scope=\"scope\">\n                <span\n                  v-html=\"scope.row.sentenceDiff\"\n                  style=\"word-wrap: break-word; width: 500px\"\n                ></span>\n              </template>\n            </el-table-column>\n          </el-table>\n          <el-pagination\n            layout=\"prev, pager, next\"\n            :page-size=\"pagesizeS\"\n            :current-page=\"currpageS\"\n            :total=\"senTableData.length\"\n            @current-change=\"handleCurrentChangeS\"\n            @size-change=\"handleSizeChangeS\"\n          >\n          </el-pagination>\n        </el-collapse-item>\n      </el-collapse>\n    </div>\n  </div>\n</template>\n\n<script>\n// import { version } from 'xlsx/types';\nimport Avatar from \"vue-avatar\";\n\nvar differ = require(\"../diff.js\").differ;\nvar {\n  countTechScores,\n  countMatchPoints,\n  linearReg,\n} = require(\"../countScores.js\");\n\nexport default {\n  data() {\n    return {\n      userStatus: 0,\n      isreadonly: true,\n      isTeacher: false,\n      text1: \"\", //当前用户作为第一个用户提交的第一版本\n      isversion1: false, //判断是否有第一个版本\n      isFinal: false, //判断是否有修改记录可以生成综合版本\n      text_v1: \"\", //从数据库取得的第一个用户提交的第一版本，可能与text1不一样\n      text_fn: \"\",\n      isedit: false, //控制是否显示修改框\n      textDiv: \"\", //当前页面的textDiv的值, 记录当前用户的修改版本\n      currentCompareText: \"\", //当前页面的textDiv的值, 用来做比较基础\n      sentences: [], //第一个用户提交的第一版本的分句结果\n      username: \"\",\n      diffList: [],\n      tableData: [], //分页相关\n      senTableData: [], //句子版本相关\n      pagesize: 3, //修改分页相关\n      currpage: 1, //修改分页相关\n      pagesizeS: 1, //句子版本分页相关\n      currpageS: 1, //句子版本分页相关\n      isActive: false,\n      seen: false,\n      tempindex: 0,\n      current: 0,\n      diffId: \"\", //当前任务的_id\n      fileName: \"\",\n      userList: [],\n      inUserList: false,\n      api: \"/api\",\n      player: \"\", //播放器\n      rateSelected: \"1.0\", //播放速度\n      isVideo: false, //文件类型是否为视频\n      videoType: [\"AVI\", \"baiwma\", \"rmvb\", \"rm\", \"flash\", \"mp4\", \"mid\", \"3GP\"], //视频类型\n      sentenceList: [], //获得去掉标签之后各句子的综合版本，遍历填充修改框\n      final_context: [],\n      dbList: [],\n      regtest: /[<ins>|<del>|<subins>]/g,\n      loading: true, //加载动画\n      publisher: \"\",\n      status: \"1\",\n      identity: \"\",\n      submitted: [], //已提交修改的名单\n      isAddition: false, //是否显示增加句子的文本框和按钮\n      addition: \"\", //增加的内容\n      autoplay: false, //控制视频自动播放\n      taskTitle: \"\",\n      deadline: \"\",\n      publishTime: \"\",\n      isTimeline: false,\n      versions: [],\n      reverse: true,\n      taskLabels: [],\n      userId: \"\",\n      versionsList: \"\", //在created中从后台获取数据\n      techScoreList: {}, //统计每个人得到的技术分\n      matchScoreList: {}, //统计每个人得到的匹配分\n      techList: [],\n      matchList: [],\n      scoreList: [], //总分\n      countMatchScores: [],\n      techPoints: 60, //总的技术分\n      matchPoints: 40, //总的匹配分\n      scores: \"分数暂未公布，截止日期后再来查看吧~\",\n      averScores: \"\", //平均分\n      isPublisher: false,\n      isSubmitted: false,\n      taskCoins: 0, //每个任务可获得的金币\n      myRank: \"\",\n      timespan: 0, //video播放实际时间\n      isCountTime: false, //是否计时\n      isManual: \"\", //是否自动计算分数\n      isConfirm: \"\",\n    };\n  },\n  component: {\n    Avatar,\n  },\n  methods: {\n    tempsave() {\n      this.$axios\n        .get(this.api + \"/currentTask?_id=\" + this.diffId)\n        .then((res) => {\n          this.userList = res.data[0].userList;\n          var isName = false;\n          for (var uh = 0; uh < this.userList.length; uh++) {\n            if (this.username == this.userList[uh].name) {\n              isName = true;\n              this.userList[uh].my_sentences = this.sentenceList;\n            }\n          }\n          //如果没有则增加\n          if (isName == false) {\n            this.userList.push({\n              name: this.username,\n              my_sentences: this.sentenceList,\n            });\n          }\n\n          this.$axios.post(this.api + \"/tempsave\", {\n            params: {\n              _id: this.diffId,\n              userList: this.userList,\n            },\n          });\n          this.$notify({\n            type: \"success\",\n            message: \"暂时保存成功\",\n            position: \"top-right\",\n            offset: 100,\n          });\n          this.isedit = false;\n        });\n    },\n    returnback() {\n      if (this.submitted.indexOf(this.username) >= 0) {\n        if (this.submitted.indexOf(this.username) == 0) {\n          if (this.submitted.indexOf(this.username, 1) == -1) {\n            var user_index = this.userList.findIndex(\n              (attr) => attr.name == this.username\n            );\n            if (user_index >= 0) {\n              this.isedit = true;\n              this.sentenceList = this.userList[user_index].my_sentences;\n            } else {\n              this.isedit = false;\n              this.$notify({\n                // title: \"警告\",\n                type: \"warning\",\n                message: \"抱歉，没有您的历史记录！\",\n                position: \"top-right\",\n                offset: 100,\n              });\n            }\n          } else {\n            this.isedit = false;\n            this.$notify({\n              // title: \"警告\",\n              type: \"warning\",\n              message: \"抱歉，您已提交过！\",\n              position: \"top-right\",\n              offset: 100,\n            });\n          }\n        } else {\n          this.isedit = false;\n          this.$notify({\n            // title: \"警告\",\n            type: \"warning\",\n            message: \"抱歉，您已提交过！\",\n            position: \"top-right\",\n            offset: 100,\n          });\n        }\n      } else {\n        var user_index = this.userList.findIndex(\n          (attr) => attr.name == this.username\n        );\n        if (user_index >= 0) {\n          this.sentenceList = this.userList[user_index].my_sentences;\n          this.isedit = true;\n        } else {\n          this.isedit = false;\n          this.$notify({\n            // title: \"警告\",\n            type: \"warning\",\n            message: \"抱歉，没有您的历史记录！\",\n            position: \"top-right\",\n            offset: 100,\n          });\n        }\n      }\n    },\n    showTimeline() {\n      this.$axios\n        .get(this.api + \"/allVersions?_id=\" + this.diffId)\n        .then((res) => {\n          // console.log(\"res data\", res.data);\n          this.versions = res.data;\n          if (this.versions.length > 0) {\n            this.isTimeline = true;\n          } else {\n            this.$notify({\n              // title: \"警告\",\n              type: \"warning\",\n              message: \"当前任务还没有人完成\",\n              position: \"top-right\",\n              offset: 100,\n            });\n          }\n        });\n    },\n    closeTimeline() {\n      this.isTimeline = false;\n    },\n    //使用document.querySelector实现锚点的效果\n    toBest(idName) {\n      document.querySelector(idName).scrollIntoView(true);\n    },\n    //回到顶部\n    toTop() {\n      document.body.scrollTop = document.documentElement.scrollTop = 0;\n    },\n    //浮框\n    changePos(event) {\n      var wordOperate = document.getElementById(\"wordOperate\");\n      wordOperate.style.position = \"fixed\";\n      wordOperate.style.display = \"inline-block\";\n      wordOperate.style.backgroundColor = \"white\";\n      if (event.clientX < window.screen.width / 2) {\n        wordOperate.style.left = event.clientX + 5 + \"px\";\n      } else {\n        wordOperate.style.left = event.clientX - wordOperate.offsetWidth + \"px\";\n      }\n\n      if (event.clientY > window.screen.height / 2) {\n        wordOperate.style.top = event.clientY - wordOperate.offsetHeight + \"px\";\n      } else {\n        wordOperate.style.top = event.clientY + \"px\";\n      }\n    },\n    //确定是音频播放器还是视频播放器\n    decidePlayer() {\n      if (this.isVideo) {\n        this.player = document.querySelector(\"#video > video\");\n      } else {\n        this.player = document.getElementById(\"audio\");\n      }\n    },\n    //控制播放速度\n    // handleSpeed() {\n    //   this.player.playbackRate = this.rateSelected;\n    // },\n    //控制后退10秒\n    goBack() {\n      this.player.currentTime -= 10;\n    },\n    //控制前进10秒\n    goForward() {\n      this.player.currentTime += 10;\n    },\n    //分页相关\n    handleCurrentChange(val) {\n      this.currpage = val;\n    },\n    //分页相关\n    handleSizeChange(val) {\n      this.pagesize = val;\n    },\n    //分页相关\n    handleCurrentChangeS(val) {\n      this.currpageS = val;\n    },\n    //分页相关\n    handleSizeChangeS(val) {\n      this.pagesizeS = val;\n    },\n    //提交第一份，只执行一次，但会决定数据库的结构\n    submitv1() {\n      //获得当前时间\n      // let date = new Date();\n      // let newdate = date.toLocaleString(\"chinese\", {\n      //   hour12: false,\n      // });\n\n      let newdate=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n\n      var flag = true;\n      var regstr = /([A-Za-z0-9\\'\\\"\\!\\?\\-\\:\\;\\.\\,\\%\\$\\&\\[ \\]])/;\n      var limited_words = 0;\n      this.$axios\n        .get(this.api + \"/currentTask?_id=\" + this.diffId)\n        .then((res) => {\n          limited_words = res.data[0].words;\n          // console.log(limited_words);\n          var video_id = res.data[0].videoId; //对应视频的_id\n          var authcode = res.data[0].authcode; //对应任务的验证码\n          //输入的内容非空\n          if (this.text1) {\n            var t_length = this.text1.split(\" \").length;\n            // console.log(t_length)\n            if (t_length > limited_words) {\n              for (var a = 0; a < this.text1.length; a++) {\n                var regResult = regstr.test(this.text1[a]);\n                // console.log(\"-----1\", regResult);\n                if (regResult === false) {\n                  // console.log(\"aaa\");\n                  flag = false;\n                }\n              }\n              // console.log(\"flag\", flag);\n              if (flag) {\n                this.$axios\n                  .post(this.api + \"/updateVersion\", {\n                    //整篇更新到版本列表\n                    params: {\n                      _id: this.diffId,\n                      time: newdate,\n                      new_version: this.text1,\n                      username: this.username,\n                      userId: this.userId,\n                    },\n                  })\n                  .then((result) => {\n                    // console.log(\"aaa\");\n                    this.$axios\n                      .get(this.api + \"/currentTask?_id=\" + this.diffId)\n                      .then((res) => {\n                        // console.log(\"111\");\n                        this.diffList = res.data[0].diffList;\n                        // console.log(\"diffList1\", this.diffList)\n                        this.userList = res.data[0].userList;\n                        if (this.diffList.length == 0) {\n                          this.$axios\n                            .get(this.api + \"/allVersions?_id=\" + this.diffId)\n                            .then((res) => {\n                              // console.log(\"res data\", res.data);\n                              var owner = res.data[0].name; //第一个提交的用户\n                              if (owner == this.username) {\n                                this.$notify({\n                                  type: \"success\",\n                                  message:\n                                    \"完成听写获得5金币，第一个完成额外再获得5金币\",\n                                  position: \"top-right\",\n                                  offset: 100,\n                                });\n                                if (\n                                  this.userList.indexOf(\n                                    this.userList.find(\n                                      (obj) => obj.name == owner\n                                    )\n                                  ) == -1\n                                ) {\n                                  this.userList.push({\n                                    name: owner,\n                                    my_sentences: [],\n                                  });\n                                }\n                                this.submitted.push(owner);\n                                this.$axios\n                                  .get(\n                                    this.api + \"/profile?name=\" + this.username\n                                  )\n                                  .then((res) => {\n                                    var userId = res.data[0]._id;\n                                    var userTasks = res.data[0].myTasks;\n                                    userTasks.push({\n                                      taskId: this.diffId,\n                                      videoId: video_id,\n                                      deadline: this.deadline,\n                                      authcode: authcode,\n                                      title: this.taskTitle,\n                                      label: this.taskLabels,\n                                      time: newdate,\n                                      scores: \"\",\n                                    });\n                                    // 更新用户“myTasks”\n                                    this.$axios.post(\n                                      this.api + \"/updateMyTasks\",\n                                      {\n                                        params: {\n                                          _id: userId,\n                                          myTasks: userTasks,\n                                          time: newdate,\n                                        },\n                                      }\n                                    );\n                                  });\n                              } else {\n                                this.$notify({\n                                  // title: \"警告\",\n                                  type: \"warning\",\n                                  message:\n                                    \"非常遗憾，已有其他用户提交当前任务的第1个版本！下次加油(ง •_•)ง\",\n                                  position: \"top-right\",\n                                  offset: 100,\n                                });\n                              }\n                              this.isversion1 = true;\n                              this.text_v1 = res.data[0].version;\n                              var diffList1 = [];\n                              //分句并存储到数据库中\n                              this.sentences = this.text_v1.split(\n                                /(?<=[^A-Z].[.?]) +(?=[A-Z])/g\n                              );\n                              // console.log(this.sentences);\n                              for (\n                                var sen = 0;\n                                sen < this.sentences.length;\n                                sen++\n                              ) {\n                                let words = this.sentences[sen].split(\" \"); //分词\n                                //去掉空值\n                                for (var y = 0; y < words.length; y++) {\n                                  if (words[y] == \"\") {\n                                    words.splice(y, 1);\n                                    y = y - 1;\n                                  }\n                                }\n                                let word_list = []; //分词列表，包括用户列表\n                                var names = new Array();\n                                var user_item = {\n                                  username: this.username,\n                                  edittime: newdate,\n                                };\n                                names.push(user_item);\n                                for (var wor = 0; wor < words.length; wor++) {\n                                  var wordItem = {\n                                    // index: wor,\n                                    word: words[wor],\n                                    diffs: [\n                                      {\n                                        diff: words[wor],\n                                        names: names,\n                                        num: 1,\n                                        time: newdate,\n                                        status: 0, //0=>原词，没修改，初始值；1=>增加；2=>有增有删；-1=>删除\n                                      },\n                                    ],\n                                    isedited: false,\n                                    isfirst: true, //相对第一版，用于区分改版是否为增加的内容\n                                  };\n                                  word_list.push(wordItem);\n                                }\n                                //新改动\n                                var sentence_item = {\n                                  sentences: [\n                                    {\n                                      provider: this.username,\n                                      sentence: this.sentences[sen],\n                                      time: newdate,\n                                    },\n                                  ],\n                                  words: word_list,\n                                  author: this.username,\n                                  sentenceDiffs: [\n                                    {\n                                      provider: this.username,\n                                      sentenceDiff: this.sentences[sen],\n                                    },\n                                  ],\n                                };\n                                diffList1.push(sentence_item);\n                              }\n                              var user_index = this.userList.findIndex(\n                                (attr) => attr.name == this.username\n                              );\n                              this.userList[\n                                user_index\n                              ].my_sentences = this.sentences;\n                              // console.log(\"deffList2\", diffList1)\n                              this.$axios\n                                .post(this.api + \"/updatediff\", {\n                                  //将分词分句结果更新到数据库\n                                  params: {\n                                    _id: this.diffId,\n                                    diffList: diffList1,\n                                    userList: this.userList,\n                                    submitted: this.submitted,\n                                  },\n                                })\n                                .then((res) => {\n                                  // console.log(\"-------\" + res);\n                                  // this.$router.go(0);\n                                });\n                              this.$router.go(0);\n                              // this.createFinalVersion();\n                            });\n\n                          // this.createFinalVersion();\n                        } else {\n                          this.isversion1 = true;\n                          this.isFinal = true;\n                          //形成综合版本\n                          this.$router.go(0);\n                          // this.createFinalVersion();\n                          this.$notify({\n                            // title: \"警告\",\n                            type: \"warning\",\n                            message:\n                              \"非常遗憾，已有其他用户提交当前任务的第1个版本！下次加油(ง •_•)ง\",\n                            position: \"top-right\",\n                            offset: 100,\n                          });\n                        }\n                      });\n                  });\n                // this.$router.go(0);\n                // this.createFinalVersion();\n              } else {\n                // console.log(flag);\n                this.$notify({\n                  // title: \"警告\",\n                  type: \"warning\",\n                  message: \"提交内容包含非法字符，请检查修改后再提交！\",\n                  position: \"top-right\",\n                  offset: 100,\n                });\n              }\n            } else {\n              this.$notify({\n                // title: \"警告\",\n                type: \"warning\",\n                message: \"字数少于当前任务限制的\" + limited_words + \"词！\",\n                position: \"top-right\",\n                offset: 100,\n              });\n            }\n          } else {\n            //输入的内容为空\n            this.$notify({\n              // title: \"警告\",\n              type: \"warning\",\n              message: \"请重新确认，您并未输入内容哦~\",\n              position: \"top-right\",\n              offset: 100,\n            });\n          }\n        });\n      // this.$router.go(0); //刷新页面\n    },\n    //打开增加句子编辑面板\n    editv1() {\n      this.$notify({\n        title: \"Tip\",\n        message: \"每次只能增加一个句子哦！\",\n        position: \"top-right\",\n        offset: 100,\n      });\n      this.isAddition = true;\n      this.addition = \"\";\n    },\n    //点击修改按钮\n    changev1() {\n      this.$axios\n        .get(this.api + \"/currentTask?_id=\" + this.diffId)\n        .then((res) => {\n          // this.submitted = res.data[0].submitted;\n          // console.log(\"changev1 submitted\", this.submitted);\n          if (this.submitted.indexOf(this.username) >= 0) {\n            // console.log(\n            //   \"this.submitted.indexOf(this.username)\",\n            //   this.submitted.indexOf(this.username)\n            // );\n            // console.log(\n            //   \"this.submitted.indexOf(this.username, 1)\",\n            //   this.submitted.indexOf(this.username, 1)\n            // );\n            if (this.submitted.indexOf(this.username) == 0) {\n              if (this.submitted.indexOf(this.username, 1) == -1) {\n                //点击修改按钮\n                this.isedit = true;\n                //当前用户要提交的版本\n                // console.log(document.getElementById(\"textDiv\").innerHTML);\n                this.textDiv = document\n                  .getElementById(\"textDiv\")\n                  .innerHTML.replace(/(<span[^>]*?>)|(<\\/span>)/g, \"\");\n                //用于比较的文本，去除标签\n                this.currentCompareText = document\n                  .getElementById(\"textDiv\")\n                  .innerHTML.replace(/(<span[^>]*?>)|(<\\/span>)/g, \"\");\n              } else {\n                this.isedit = false;\n                this.$notify({\n                  // title: \"警告\",\n                  type: \"warning\",\n                  message: \"抱歉，您的提交机会已用完！\",\n                  position: \"top-right\",\n                  offset: 100,\n                });\n              }\n            } else {\n              this.isedit = false;\n              this.$notify({\n                // title: \"警告\",\n                type: \"warning\",\n                message: \"抱歉，您的提交机会已用完！\",\n                position: \"top-right\",\n                offset: 100,\n              });\n            }\n          } else {\n            //点击修改按钮\n            this.isedit = true;\n            //当前用户要提交的版本\n            this.textDiv = document\n              .getElementById(\"textDiv\")\n              .innerHTML.replace(/(<span[^>]*?>)|(<\\/span>)/g, \"\");\n\n            //用于比较的文本，去除标签\n            this.currentCompareText = document\n              .getElementById(\"textDiv\")\n              .innerHTML.replace(/(<span[^>]*?>)|(<\\/span>)/g, \"\");\n          }\n        });\n    },\n    //取消修改\n    cancelChangev1() {\n      this.isedit = false;\n    },\n    //确定数组里是否有某个元素\n    findElem(arrayToSearch, attr, val) {\n      for (var i = 0; i < arrayToSearch.length; i++) {\n        if (arrayToSearch[i][attr] == val) {\n          return i;\n        }\n      }\n      return -1;\n    },\n    //提交当前用户的版本\n    submitmv() {\n      this.$confirm(\"用户只能提交一次, 是否继续?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n        center: true,\n      }).then(() => {\n        var flag1 = true;\n        var regstr = /([A-Za-z0-9\\'\\\"\\!\\?\\:\\-\\;\\.\\,\\%\\$\\&\\[ \\]])/;\n        for (var sl = 0; sl < this.sentenceList.length; sl++) {\n          //每个句子\n          for (var c = 0; c < this.sentenceList[sl].length; c++) {\n            var regResult = regstr.test(this.sentenceList[sl][c]);\n            // console.log(\"+++++3\", regResult);\n            if (regResult === false) {\n              // console.log(\"ccc\");\n              flag1 = false;\n            }\n          }\n        }\n        // console.log(\"flag1\", flag1);\n        if (flag1) {\n          //获得当前时间\n          // let date = new Date();\n          // let newdate = date.toLocaleString(\"chinese\", {\n          //   hour12: false,\n          // });\n          let newdate=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n          //获得最新的修改列表\n          this.$axios\n            .get(this.api + \"/currentTask?_id=\" + this.diffId)\n            .then((res) => {\n              this.dbList = res.data[0].diffList;\n            });\n          // console.log(\"dbDiffList\", this.dbList);\n          // console.log(\"sentenceList\", this.sentenceList);\n          var listLen = this.dbList.length;\n          //与第一版本比较，根据句子的数量进行循环（修改后提交内容对应的句子）\n          var final_result = []; //记录所有的修改情况\n          for (var len = 0; len < listLen; len++) {\n            var sen_result = []; //记录当前句子的修改情况\n            var sentence = this.sentenceList[len]\n              .replace(/\\s{2,}/g, \" \")\n              .replace(/[\\r\\n]/g, \" \")\n              .replace(/(\\r\\n|\\n|\\r)/g, \" \");\n            //新改动：换成跟 最新版本 的 第一版本句子 比较\n            var v1_sentences = this.dbList[len].sentences.sort(\n              this.compare(\"time\")\n            );\n            // console.log(\"v1_sentences\", v1_sentences);\n            var v1_sentence = v1_sentences[v1_sentences.length - 1].sentence;\n            var s_result1 = differ\n              .parse(\" \" + v1_sentence, \" \" + sentence)\n              .replace(/%2C/g, \",\")\n              .replace(/%3F/g, \"?\")\n              .replace(/%27/g, \"'\")\n              .replace(/%3A/g, \":\");\n            //将单独的ins标签替换为del-ins标签\n            // console.log(\"s_result1\", s_result1);\n            var reg = /([a-zA-Z0-9]+[\\-\\'\\.\\:]?[a-zA-Z0-9]*\\s(<ins[^>]*?>.*?<\\/ins>\\s)+)/g;\n            var insMatchResult = s_result1.match(reg);\n            // console.log(\"insMatchResult\", insMatchResult);\n            if (insMatchResult !== null) {\n              for (var m = 0; m < insMatchResult.length; m++) {\n                //去掉空的匹配结果\n                if (insMatchResult[m] == \"\") {\n                  insMatchResult.splice(m, 1);\n                  m = m - 1;\n                } else {\n                  s_result1 = s_result1.replace(insMatchResult[m], \"<>\"); //替换成特殊的符号 占位\n                  var del_content = insMatchResult[m].split(\" \")[0]; //原词\n                  var edited_ver =\n                    \"<del>\" +\n                    del_content +\n                    \"</del> <ins>\" +\n                    del_content +\n                    \"</ins>\";\n                  insMatchResult[m] = insMatchResult[m].replace(\n                    del_content,\n                    edited_ver\n                  );\n                }\n                s_result1 = s_result1\n                  .replace(\"<>\", insMatchResult[m])\n                  .replace(/(\\r\\n|\\n|\\r)/g, \" \");\n              }\n            }\n            // console.log(\"after\", s_result1);\n            var s_result_del = s_result1\n              .replace(/<ins[^>]*?>.*?<\\/ins>\\s/g, \"\")\n              .replace(/(\\r\\n|\\n|\\r)/g, \" \");\n            //去掉所有ins标签，用于确认del标签的index\n            var s_result_arr = s_result_del\n              .trim()\n              .split(/\\s/g)\n              .filter((d) => d);\n            // console.log(\"s_result_arr\", s_result_arr);\n            // 给 s_result_arr 数组中每个词都加一个index和flag，便于后期找index\n            var new_s_result_arr = s_result_arr.map((item, index) => {\n              var robj = {};\n              robj.index = index;\n              robj.word = item;\n              robj.flag = 0;\n              return robj;\n            });\n            // console.log(\"new_s_result_arr\", new_s_result_arr);\n            //匹配出所有的修改\n            var allMatchResult = s_result1.match(\n              /((<del[^>]*?>.*?<\\/del>\\s)*(<ins[^>]*?>.*?<\\/ins>\\s)*)/g\n            );\n            // console.log(\"allMatchResult: \", allMatchResult);\n            //对所有的匹配结果（修改）进行进一步的整合\n            for (var n = 0; n < allMatchResult.length; n++) {\n              //去掉空的匹配结果\n              if (allMatchResult[n] == \"\") {\n                allMatchResult.splice(n, 1);\n                n = n - 1;\n              } else {\n                var matchSplit = allMatchResult[n]\n                  .replace(\"\\n\", \" \")\n                  .replace(\"↵\", \" \")\n                  .trim()\n                  .split(/\\s/g);\n                // console.log(\"matchResult\", matchSplit);\n                var del = [];\n                var ins = [];\n                // var re1 = /<del[^>]*?>.*?<\\/del>/g;\n                // var re2 = /<ins[^>]*?>.*?<\\/ins>/g;\n                for (var t = 0; t < matchSplit.length; t++) {\n                  //存储到相反的数组？？？\n                  // console.log(\"m\");\n                  if (matchSplit[t].indexOf(\"<ins>\")) {\n                    // console.log(\"每个matchSplit：\", matchSplit[t]);\n                    // var del_index = s_result_arr.indexOf(matchSplit[t]);\n                    var finishedItem = new_s_result_arr.find(\n                      (item) => item.word == matchSplit[t] && item.flag == 0\n                    );\n                    if (finishedItem) {\n                      var finishedIndex = new_s_result_arr.findIndex(\n                        (item) => item == finishedItem\n                      );\n                      new_s_result_arr[finishedIndex].flag = 1;\n                      var del_index = finishedIndex;\n                      var del_item = {\n                        del: matchSplit[t],\n                        del_index: del_index,\n                      };\n                      del.push(del_item);\n                    }\n                  }\n                  if (matchSplit[t].indexOf(\"<del>\")) {\n                    ins.push(matchSplit[t]);\n                  }\n                }\n                // console.log(\"del arr\", del);\n                // console.log(\"ins arr\", ins);\n                if (ins.length == 0) {\n                  for (var d = 0; d < del.length; d++) {\n                    var diff1 = del[d].del.trim();\n                    // console.log(\"a\", diff1)\n                    var del_content1 = del[d].del.replace(\n                      /(<del[^>]*?>)|(<\\/del>)/g,\n                      \"\"\n                    );\n                    // console.log(\"del_content1\", del_content1)\n                    var item1 = {\n                      word: del_content1,\n                      diff: diff1,\n                      index: del[d].del_index,\n                      status: -1, //删除\n                    };\n                    sen_result.push(item1);\n                  }\n                }\n                if (del.length == 1 && ins.length > 0) {\n                  // console.log(\"del_del\", del[0]);\n                  var del_content2 = del[0].del\n                    .replace(/(<del[^>]*?>)|(<\\/del>)/g, \"\")\n                    .trim();\n                  var ins_content2 = ins[0].replace(\n                    /(<ins[^>]*?>)|(<\\/ins>)/g,\n                    \"\"\n                  );\n                  // console.log(\"del_content2\", del_content2);\n                  // console.log(\"ins_content2\", ins_content2);\n                  var diff2 = del[0].del.trim() + ins.join(\" \");\n                  var status2 = 2; //修改\n                  if (\n                    del_content2 == ins_content2 ||\n                    del_content2.slice(0, del_content2.length - 1) ==\n                      ins_content2\n                  ) {\n                    // console.log(\"del_content2 == ins_content2\");\n                    status2 = 1; //增加\n                    var ins_temp = ins.slice(1);\n                    diff2 = del_content2.trim() + \" \" + ins_temp.join(\" \");\n                  }\n                  // console.log(\"diff2\", diff2);\n                  // console.log(\"del_content2\", del_content2);\n                  var item2 = {\n                    word: del_content2,\n                    diff: diff2,\n                    index: del[0].del_index,\n                    status: status2,\n                  };\n                  sen_result.push(item2);\n                }\n                if (del.length > 1) {\n                  if (del.length == ins.length) {\n                    for (var a = 0; a < del.length; a++) {\n                      // console.log(del[a])\n                      var del_content3 = del[a].del.replace(\n                        /(<del[^>]*?>)|(<\\/del>)/g,\n                        \"\"\n                      );\n                      var ins_content3 = ins[a].replace(\n                        /(<ins[^>]*?>)|(<\\/ins>)/g,\n                        \"\"\n                      );\n                      // console.log(\"c\", del_content3)\n                      if (del_content3 !== ins_content3) {\n                        var item3 = {\n                          word: del_content3,\n                          diff: del[a].del.trim() + ins[a],\n                          index: del[a].del_index,\n                          status: 2,\n                        };\n                        sen_result.push(item3);\n                      }\n                    }\n                  }\n                  if (del.length < ins.length) {\n                    for (var b = 0; b < del.length; b++) {\n                      var del_content4 = del[b].del.replace(\n                        /(<del[^>]*?>)|(<\\/del>)/g,\n                        \"\"\n                      );\n                      // console.log(\"d\", del_content4)\n                      var diff4 = \"\";\n                      if (b == del.length - 1) {\n                        var temp_ins = ins.slice(b);\n                        diff4 = del[b].del.trim() + temp_ins.join(\" \");\n                      } else {\n                        diff4 = del[b].del.trim() + ins[b];\n                      }\n                      // console.log(\"d\", diff4)\n                      var ins_content4 = ins[b].replace(\n                        /(<ins[^>]*?>)|(<\\/ins>)/g,\n                        \"\"\n                      );\n                      if (del_content4 !== ins_content4) {\n                        var item4 = {\n                          word: del_content4,\n                          diff: diff4,\n                          index: del[b].del_index,\n                          status: 2,\n                        };\n                        sen_result.push(item4);\n                      }\n                    }\n                  }\n                  if (del.length > ins.length) {\n                    for (var c = 0; c < ins.length; c++) {\n                      var del_content5 = del[c].del.replace(\n                        /(<del[^>]*?>)|(<\\/del>)/g,\n                        \"\"\n                      );\n                      var ins_content5 = ins[c].replace(\n                        /(<ins[^>]*?>)|(<\\/ins>)/g,\n                        \"\"\n                      );\n                      // console.log(\"e\", del_content5)\n                      if (del_content5 !== ins_content5) {\n                        var item5 = {\n                          word: del_content5,\n                          diff: del[c].del.trim() + ins[c],\n                          index: del[c].del_index,\n                          status: 2,\n                        };\n                        sen_result.push(item5);\n                      }\n                    }\n                    var temp_del = del.slice(ins.length, del.length);\n                    for (var f = 0; f < temp_del.length; f++) {\n                      var diff6 = temp_del[f].del.trim();\n                      var del_content6 = temp_del[f].del.replace(\n                        /(<del[^>]*?>)|(<\\/del>)/g,\n                        \"\"\n                      );\n                      // console.log(\"e\", diff6)\n                      // console.log(\"e\", del_content6)\n                      var item6 = {\n                        word: del_content6,\n                        diff: diff6,\n                        index: temp_del[f].del_index,\n                        status: -1,\n                      };\n                      sen_result.push(item6);\n                    }\n                  }\n                }\n              }\n            }\n            final_result.push(sen_result);\n          }\n          // console.log(\"final_result: \", final_result);\n          //再取一次数据，判断是属于哪个单词的修改，判断该修改是否存在\n          //如果存在，直接加入用户，如果不存在，加入该修改以及用户\n          this.$axios\n            .get(this.api + \"/currentTask?_id=\" + this.diffId)\n            .then((res) => {\n              this.dbList = res.data[0].diffList;\n            });\n          // console.log(\"dbDiffList2\", this.dbList);\n          for (var r = 0; r < final_result.length; r++) {\n            //r表示文本中的第r句\n            var s_orders = final_result[r]; //第r句的修改记录\n            // console.log(\"s_orders: \", s_orders);\n            var s_words = this.dbList[r].words; //第r句的分词结果\n            // console.log(\"s_words: \", s_words);\n            var s_sentences = this.dbList[r].sentenceDiffs; //第r句的不同版本\n            //新改动\n            var new_sentences = this.dbList[r].sentences;\n            if (s_orders.length == 0) {\n              //第r句的修改记录为空\n              // 由于数据库中的顺序会随机改变，所以先匹配再插入更改数据\n              s_words.forEach((item) => {\n                var no_edited_word = item.word;\n                var no_edited_index = item.diffs.findIndex(\n                  (attr) => attr.diff == no_edited_word\n                );\n                item.diffs[no_edited_index].names.push({\n                  username: this.username,\n                  edittime: newdate,\n                });\n                item.diffs[no_edited_index].num++;\n                item.diffs[no_edited_index].time = newdate;\n              });\n              var filtered_words = s_words.map((item) => {\n                for (var ele = 0; ele < item.diffs.length; ele++) {\n                  var name_index = this.findElem(\n                    item.diffs[ele].names,\n                    \"username\",\n                    this.username\n                  );\n                  if (name_index != -1) {\n                    if (item.diffs[ele].hasOwnProperty(\"styleDiff\")) {\n                      return item.diffs[ele].styleDiff;\n                    } else {\n                      return item.diffs[ele].diff;\n                    }\n                  }\n                }\n              });\n              // console.log(\"filtered_words\", filtered_words);\n              var filtered_sen = filtered_words.join(\" \");\n\n              s_sentences.push({\n                provider: this.username,\n                sentenceDiff: filtered_sen,\n              });\n            } else {\n              //第r句的修改记录不为空\n              // 第一部分：将修改记录替换到不同句子的版本展示中，便于展示修改的地方\n              // 整合第二部分于第一部分中：判断每个词语是否有对应的修改\n              var editing_words = [];\n              s_words.forEach((item, index) => {\n                var itemIndex = index;\n                var replacedItemIndex = s_orders.indexOf(\n                  s_orders.find((element) => element.index == itemIndex)\n                );\n                if (replacedItemIndex != -1) {\n                  if (s_orders[replacedItemIndex].status == 1) {\n                    //对前一个词的处理   补充：句尾的标点符号\n                    var find_index = this.findElem(item.diffs, \"status\", 0);\n                    // console.log(\"find_indexaaaa\", find_index);\n                    item.diffs[find_index].names.push({\n                      username: this.username,\n                      edittime: newdate,\n                    });\n                    item.diffs[find_index].num++;\n                    item.diffs[find_index].time = newdate;\n\n                    var r_ins_words = s_orders[replacedItemIndex].diff.split(\n                      \" \"\n                    );\n                    var ins_words = r_ins_words.slice(1);\n\n                    if (\n                      s_words[index - 1].diffs[0].hasOwnProperty(\"styleDiff\") &&\n                      s_words[index - 1].isfirst == false\n                    ) {\n                      var reg_end = /\\,|\\.|\\!|\\?|\\.\\\"|\\.\\'|\\!\\\"|\\!\\'|\\?\\\"|\\?\\'/g;\n                      var bf_ins_dw_i = s_words[index - 1].diffs.findIndex(\n                        (elem) => {\n                          return elem.diff === s_words[index - 1].word;\n                        }\n                      );\n\n                      var temp_ins_sdf = item.diffs[bf_ins_dw_i].styleDiff;\n                      // console.log(\"temp_ins_sdf1111\", temp_ins_sdf);\n\n                      if (\n                        reg_end.test(\n                          temp_ins_sdf\n                            .match(/(?<=<subins>).*?(?=<\\/subins>)/g)[0]\n                            .slice(-1)\n                        )\n                      ) {\n                        temp_ins_sdf = temp_ins_sdf.replace(\n                          temp_ins_sdf.slice(-10),\n                          \"</subins>\"\n                        );\n                        item.word = temp_ins_sdf.replace(\n                          /<subins>|<\\/subins>/g,\n                          \"\"\n                        );\n                        item.diffs[bf_ins_dw_i].diff = item.word;\n                        item.diffs[bf_ins_dw_i].styleDiff = temp_ins_sdf;\n                      } else if (\n                        reg_end.test(\n                          temp_ins_sdf\n                            .match(/(?<=<subins>).*?(?=<\\/subins>)/g)[0]\n                            .slice(-2)\n                        )\n                      ) {\n                        temp_ins_sdf = temp_ins_sdf.replace(\n                          temp_ins_sdf.slice(-11),\n                          \"</subins>\"\n                        );\n                        item.word = temp_ins_sdf.replace(\n                          /<subins>|<\\/subins>/g,\n                          \"\"\n                        );\n                        item.diffs[bf_ins_dw_i].diff = item.word;\n                        item.diffs[bf_ins_dw_i].styleDiff = temp_ins_sdf;\n                      }\n\n                      // console.log(\"当前原词去标点后\", item.word);\n                      // console.log(\"temp_ins_sdf2222222\", temp_ins_sdf);\n\n                      var ins_words_arr = [\n                        {\n                          word: temp_ins_sdf,\n                          diffs: [\n                            {\n                              diff: temp_ins_sdf, //展示数据\n                            },\n                          ],\n                          isedited: false,\n                        },\n                      ];\n                    } else {\n                      var reg_end = /\\,|\\.|\\!|\\?|\\.\\\"|\\.\\'|\\!\\\"|\\!\\'|\\?\\\"|\\?\\'/g;\n                      var temp_ins = r_ins_words[0];\n                      var bf_ins_dw_i = item.diffs.findIndex((elem) => {\n                        return elem.diff === item.word;\n                      });\n                      // console.log(\"bf_ins_dw_i\", bf_ins_dw_i);\n                      if (reg_end.test(temp_ins[temp_ins.length - 1])) {\n                        temp_ins = temp_ins.slice(0, temp_ins.length - 1);\n                        item.word = temp_ins;\n                        // console.log(\n                        //   \"item.diffs[bf_ins_dw_i]\",\n                        //   item.diffs[bf_ins_dw_i]\n                        // );\n                        item.diffs[bf_ins_dw_i].diff = temp_ins;\n                      }\n                      if (reg_end.test(temp_ins.slice(-2))) {\n                        temp_ins = temp_ins.slice(0, temp_ins.length - 2);\n                        item.word = temp_ins;\n                        item.diffs[bf_ins_dw_i].diff = temp_ins;\n                      }\n                      var ins_words_arr = [\n                        {\n                          word: temp_ins,\n                          diffs: [\n                            {\n                              diff: temp_ins, //展示数据\n                            },\n                          ],\n                          isedited: false,\n                        },\n                      ];\n                    }\n\n                    //I love China.\n                    //I very love China too.\n                    ins_words.forEach((i) => {\n                      var i_word = i.replace(/(<ins[^>]*?>)|(<\\/ins>)/g, \"\");\n                      var i_index = s_orders[replacedItemIndex].index + 1;\n                      var i_names = new Array();\n                      var user_item = {\n                        username: this.username,\n                        edittime: newdate,\n                      };\n                      i_names.push(user_item);\n                      var ins_wordItem = {\n                        index: i_index,\n                        word: i_word,\n                        diffs: [\n                          {\n                            diff: i_word,\n                            styleDiff: \"<subins>\" + i_word + \"</subins>\",\n                            names: i_names,\n                            num: 1,\n                            time: newdate,\n                            status: 0,\n                          },\n                        ],\n                        isedited: false,\n                        isfirst: false, //相对第一版，用于区分改版是否为增加的内容\n                      };\n                      ins_words_arr.push(ins_wordItem);\n                    });\n                    editing_words.push(ins_words_arr);\n                  } else {\n                    var find_result = this.findElem(\n                      item.diffs,\n                      \"diff\",\n                      s_orders[replacedItemIndex].diff\n                    );\n                    if (find_result == -1) {\n                      //不存在\n                      var names = new Array();\n                      var user_item = {\n                        username: this.username,\n                        edittime: newdate,\n                      };\n                      names.push(user_item);\n                      var diff_item = {\n                        diff: s_orders[replacedItemIndex].diff,\n                        names: names,\n                        num: 1,\n                        time: newdate,\n                        status: s_orders[replacedItemIndex].status,\n                      };\n                      item.diffs.push(diff_item);\n                      item.isedited = true;\n                    } else {\n                      item.diffs[find_result].names.push({\n                        username: this.username,\n                        edittime: newdate,\n                      }); //将当前用户加入列表\n                      item.diffs[find_result].num++; //数量加1\n                      item.diffs[find_result].time = newdate; //更新日期\n                    }\n                    var word_diff = item.word.replace(\n                      item.word,\n                      s_orders[replacedItemIndex].diff\n                    );\n                    editing_words.push(word_diff);\n                  }\n                } else {\n                  var no_edited_word = item.word;\n                  // console.log(\"no_edited_word\", no_edited_word);\n                  // console.log(\"item.diffs\", item.diffs);\n                  var no_edited_index = item.diffs.findIndex((attr) => {\n                    return attr.diff == no_edited_word;\n                  });\n                  // console.log(\"no_edited_index\", no_edited_index);\n                  item.diffs[no_edited_index].names.push({\n                    username: this.username,\n                    edittime: newdate,\n                  });\n                  item.diffs[no_edited_index].num++;\n                  item.diffs[no_edited_index].time = newdate;\n\n                  if (item.isfirst == true) {\n                    editing_words.push(item.word);\n                  } else {\n                    // console.log(\n                    //   \"no_edited_word >> item.diffs[no_edited_index].styleDiff\",\n                    //   item.diffs[no_edited_index].styleDiff\n                    // );\n                    editing_words.push(item.diffs[no_edited_index].styleDiff);\n                  }\n                }\n              });\n              // console.log(\"editing_words1\", editing_words);\n              var deepFlatten = (arr) =>\n                [].concat(\n                  ...arr.map((v) => (Array.isArray(v) ? deepFlatten(v) : v))\n                );\n\n              var more_ins_arr = []; //增加的原词数组\n              for (var ma = 0; ma < editing_words.length; ma++) {\n                if (Array.isArray(editing_words[ma])) {\n                  more_ins_arr.push(editing_words[ma].slice(1));\n                }\n              }\n              // console.log(\"more_ins_arr\", more_ins_arr); //more_ins_arr [[1, 2, 3], [4, 5], [7, 8]]\n              var more_ins_arr1 = deepFlatten(more_ins_arr);\n              // console.log(\"more_ins_arr1\", more_ins_arr1); //[1, 2, 3, 4, 5, 7, 8]\n\n              for (var va = 0; va < more_ins_arr1.length; va++) {\n                if (more_ins_arr1[va].word == \"\") {\n                  more_ins_arr1.splice(va, 1);\n                } else {\n                  more_ins_arr1[va].index = more_ins_arr1[va].index + va;\n                  s_words.splice(more_ins_arr1[va].index, 0, more_ins_arr1[va]);\n                }\n              }\n\n              // console.log(\"s_words2222\", s_words);\n              //新改动\n              if (more_ins_arr1.length > 0) {\n                var reg_end = /\\,|\\.|\\!|\\?|\\.\\\"|\\.\\'|\\!\\\"|\\!\\'|\\?\\\"|\\?\\'/g;\n                // var reg_end = /\\.|\\!|\\?/g;\n                for (var wr = 0; wr < s_words.length - 1; wr++) {\n                  var word = s_words[wr].word;\n                  var diffs = s_words[wr].diffs;\n                  // console.log(\"111111\", diffs);\n                  // console.log(\"11112\", word);\n                  var no_edited_index = diffs.findIndex(\n                    (attr) => attr.diff === word\n                  );\n                  // console.log(\"+++++++\", no_edited_index);\n                  if (reg_end.test(word[word.length - 1])) {\n                    word = word.slice(0, word.length - 1);\n                    // console.log(\"-------\", word);\n                    diffs[no_edited_index].diff = diffs[\n                      no_edited_index\n                    ].diff.slice(0, diffs[no_edited_index].diff.length - 1);\n                    // console.log(\"-------\", diffs[no_edited_index].diff);\n                  }\n                  if (reg_end.test(word.slice(-2))) {\n                    word = word.slice(0, word.length - 2);\n                    diffs[no_edited_index].diff = diffs[\n                      no_edited_index\n                    ].diff.slice(0, diffs[no_edited_index].diff.length - 2);\n                  }\n                }\n                var v1_words = [];\n                v1_words = s_words.map((word) => {\n                  return word.word;\n                });\n                var new_sentence = v1_words.join(\" \");\n                var new_item = {\n                  provider: this.username,\n                  sentence: new_sentence,\n                  time: newdate,\n                };\n                new_sentences.push(new_item);\n              }\n\n              // console.log(\"s_words3333\", s_words);\n\n              editing_words = deepFlatten(\n                editing_words.map((w) => {\n                  if (Array.isArray(w) == true) {\n                    var sub_word = w.map((iw) => {\n                      if (iw.diffs[0].hasOwnProperty(\"styleDiff\")) {\n                        // console.log(\n                        //   \"iw.diffs[0].styleDiff\",\n                        //   iw.diffs[0].styleDiff\n                        // );\n                        return iw.diffs[0].styleDiff;\n                      } else {\n                        // console.log(\"iw.diffs[0].diff\", iw.diffs[0].diff);\n                        return iw.diffs[0].diff;\n                      }\n                    });\n                    return sub_word;\n                  } else {\n                    return w;\n                  }\n                })\n              );\n\n              // console.log(\"editing_words2\", editing_words);\n              //[\"In\", \"<subins>@@@</subins>\", \"<subins>@@@@@@@@@@@</subins>\", \"<del>have</del><ins>had</ins>\", \"earthquake.\"]\n              var editing_sentence = editing_words.join(\" \");\n              s_sentences.push({\n                provider: this.username,\n                sentenceDiff: editing_sentence,\n              });\n              // console.log(\"sentenceDiffs: \", s_sentences);\n            }\n          }\n          // console.log(\"bbb\", this.dbList);\n\n          //判断当前用户是否在userList中\n          for (var h = 0; h < this.userList.length; h++) {\n            if (this.username == this.userList[h].name) {\n              this.inUserList = true;\n            }\n          }\n          //如果没有则增加\n          if (this.inUserList == false) {\n            this.userList.push({\n              name: this.username,\n              my_sentences: this.sentenceList,\n            });\n          }\n          console.log(\"submitmv submitted\", this.submitted);\n          this.submitted.push(this.username);\n\n          //更新相应数据到数据库\n          this.$axios.post(this.api + \"/updatediff\", {\n            params: {\n              _id: this.diffId,\n              userList: this.userList,\n              diffList: this.dbList,\n              submitted: this.submitted,\n            },\n          });\n\n          var new_version = this.sentenceList.join(\" \");\n          this.$axios\n            .post(this.api + \"/updateVersion\", {\n              params: {\n                _id: this.diffId,\n                new_version: new_version,\n                time: newdate,\n                username: this.username,\n                userId: this.userId,\n              },\n            })\n\n          // 当发布者超过截止日期后提交答案\n          this.$axios\n            .get(this.api + \"/currentTask?_id=\" + this.diffId)\n            .then((res) => {//刷新diffList\n              this.diffList = res.data[0].diffList;\n              // let date1 = new Date();\n              // let newdate1 = date1.toLocaleString(\"chinese\", {\n              //   hour12: false,\n              // });\n              let newdate1=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n              if (\n                this.username == this.publisher &&\n                !this.isManual &&\n                this.compareDate(newdate1,this.deadline)\n              ) {\n                this.countScores(); //\"2021/02/05 00:00:00\", this.deadline\n                this.isConfirm = true\n              }\n            });\n            \n          //关闭输入框\n          this.isedit = false;\n          this.loading = true;\n\n          this.$notify({\n            type: \"success\",\n            message: \"提交成功！\",\n            position: \"top-right\",\n            offset: 100,\n          });\n          this.createFinalVersion();\n          // this.$router.go(0);\n          this.$axios\n            .get(this.api + \"/currentTask?_id=\" + this.diffId)\n            .then((res) => {\n              var video_id = res.data[0].videoId; //对应视频的_id\n              var authcode = res.data[0].authcode; //对应任务的验证码\n              this.$axios\n                .get(this.api + \"/profile?name=\" + this.username)\n                .then((res) => {\n                  var userId = res.data[0]._id;\n                  var userTasks = res.data[0].myTasks;\n                  userTasks.push({\n                    taskId: this.diffId,\n                    videoId: video_id,\n                    deadline: this.deadline,\n                    authcode: authcode,\n                    title: this.taskTitle,\n                    label: this.taskLabels,\n                    time: newdate,\n                    scores: \"\",\n                  });\n                  // 更新用户“myTasks”\n                  this.$axios.post(this.api + \"/updateMyTasks\", {\n                    params: {\n                      _id: userId,\n                      myTasks: userTasks,\n                    },\n                  });\n                });\n            });\n        } else {\n          this.$notify({\n            // title: \"警告\",\n            type: \"warning\",\n            message: \"提交内容包含非法字符，请检查修改后再提交！\",\n            position: \"top-right\",\n            offset: 100,\n          });\n        }\n      });\n      // .catch(() => {\n      //   this.$notify({\n      //     // title: \"警告\",\n      //     type: \"warning\",\n      //     message: \"您已取消提交\",\n      //     position: \"top-right\",\n      //     offset: 100,\n      //   });\n      // });\n    },\n    //生成综合版本\n    createFinalVersion() {\n      this.$axios\n        .get(this.api + \"/currentTask?_id=\" + this.diffId)\n        .then((res) => {\n          // this.openFullScreen2()\n          this.dbList = res.data[0].diffList;\n          //加载动画\n          setTimeout(() => {\n            this.loading = false;\n          }, 1500);\n          // console.log(\"dbList\", this.dbList);\n          var final_sentences = [];\n          var only_sentences = [];\n          var only_sentences1 = [];\n          for (var k = 0; k < this.dbList.length; k++) {\n            var original_sentence = this.dbList[k].sentence;\n            var words = this.dbList[k].words;\n            var most_words = [];\n            for (var w = 0; w < words.length; w++) {\n              var words_diffs = words[w].diffs;\n              var most_edited_word = words_diffs[words_diffs.length - 1].diff; //初始值\n              //按时间排序\n              //按用户数量排序\n              var words_diffs2 = words_diffs\n                .sort(this.compare(\"time\"))\n                .sort(this.compare(\"num\"));\n              // console.log(\"words_diffs2\", words_diffs2)\n\n              if (words_diffs2[words_diffs.length - 1].styleDiff) {\n                most_edited_word = {\n                  diff: words_diffs2[words_diffs.length - 1].styleDiff,\n                  isedited: words[w].isedited,\n                };\n              } else {\n                most_edited_word = {\n                  diff: words_diffs2[words_diffs.length - 1].diff,\n                  isedited: words[w].isedited,\n                };\n              }\n              most_words.push(most_edited_word);\n            }\n            var final_sentence = \"\";\n            for (var s = 0; s < most_words.length; s++) {\n              most_words[s].diff.trim();\n              most_words[s].diff = most_words[s].diff + \" \";\n              final_sentence = final_sentence + most_words[s].diff;\n            }\n            // var final_sentence = most_words.join(\"\");\n            final_sentences.push({\n              final_sentence: final_sentence,\n              final_words: most_words,\n            });\n            only_sentences.push(final_sentence);\n          }\n          for (var t = 0; t < only_sentences.length; t++) {\n            var final_sentence1 = only_sentences[t]\n              .replace(/(<del[^>]*?>.*?<\\/del>)/g, \"\")\n              .replace(/(<ins[^>]*?>)|(<\\/ins>)/g, \"\")\n              .replace(/(<subins[^>]*?>)|(<\\/subins>)/g, \"\");\n            // console.log(only_sentences[t])\n            only_sentences1.push(final_sentence1);\n          }\n          // console.log(only_sentences1);\n          // console.log(\"final_context: \", final_sentences);\n          this.final_context = final_sentences;\n          this.sentenceList = only_sentences1;\n        });\n      // console.log(\"aaaa\", this.dbList);\n      //显示提示信息\n      // this.$message({\n      //   message: \"已更新\",\n      //   type: \"success\",\n      // });\n    },\n    compare(attr, rev) {\n      //第二个参数没有传递 默认升序排列\n      if (rev == undefined) {\n        rev = 1;\n      } else {\n        rev = rev ? 1 : -1;\n      }\n      return function (a, b) {\n        a = a[attr];\n        b = b[attr];\n        if (a < b) {\n          return rev * -1;\n        }\n        if (a > b) {\n          return rev * 1;\n        }\n        return 0;\n      };\n    },\n    //ES6语法 数组去重\n    unique(arr) {\n      return Array.from(new Set(arr));\n    },\n    showAll(event, index, s_index) {\n      event || (event = window.event);\n      event.stopPropagation\n        ? event.stopPropagation()\n        : (event.cancelBubble = true);\n      this.tableData = [];\n      //s_index表示句子序号；index表示单词序号\n      this.seen = true;\n      this.current = index;\n      this.tempindex = index;\n      this.isActive = true;\n      // this.isShowAll = true;\n      var words = this.dbList[s_index].words;\n      this.tableData = words[index].diffs;\n      // for (var i = 0; i < this.tableData.length; i++) {\n      //   this.tableData[i].names = this.unique(this.tableData[i].names);\n      // this.tableData[i].names = unique_names.join(\", \"); //bug：把names这个数组变成了字符串\n      // }\n      this.senTableData = this.dbList[s_index].sentenceDiffs;\n      // console.log(\"senTableData: \", this.senTableData);\n      // console.log(\"words: \", words);\n      // console.log(\"tableData: \", this.tableData);\n      this.changePos(event);\n      // console.log(event);\n      document.addEventListener(\"click\", this.hidePanel, false);\n    },\n    closeShow() {\n      this.seen = false;\n      this.current = null;\n      this.tempindex = null;\n      this.isActive = false;\n      // this.isShowAll = false;\n      var wordOperate = document.getElementById(\"wordOperate\");\n      wordOperate.style.display = \"none\";\n      document.removeEventListener(\"click\", this.hidePanel, false);\n    },\n    hidePanel(e) {\n      if (this.$refs.main && !this.$refs.main.contains(e.target)) {\n        //点击除弹出层外的空白区域\n        this.closeShow();\n      }\n    },\n    pip() {\n      if (this.isVideo) {\n        var video = document.querySelector(\"#video > video\");\n        if (!document.pictureInPictureElement) {\n          //开启\n          video.requestPictureInPicture().catch((error) => {\n            console.log(\n              error,\n              \"Video failed to enter Picture-in-Picture mode.\"\n            );\n          });\n        } else {\n          //关闭\n          document.exitPictureInPicture().catch((error) => {\n            console.log(\n              error,\n              \"Video failed to leave Picture-in-Picture mode.\"\n            );\n          });\n        }\n      } else {\n        this.$notify({\n          // title: \"警告\",\n          type: \"warning\",\n          message: \"当前文件或浏览器不支持画中画模式\",\n          position: \"top-right\",\n          offset: 100,\n        });\n      }\n    },\n\n    // 计算分数\n    countScores() {\n      // this.$axios\n      //   .post(this.api + \"/getVersions\", { params: { _id: this.diffId } })\n      //   .then((res) => {\n      //     this.versionsList = res.data; //获取每个人的版本\n      //   });\n      var { ts, fnl } = countTechScores(\n        this.diffList,\n        this.publisher,\n        this.techPoints,\n        this.submitted,\n        0.6,\n        6\n      );\n      var { cms, ms } = countMatchPoints(\n        this.versionsList,\n        this.sentenceList,\n        this.publisher,\n        this.publishTime,\n        this.deadline,\n        this.matchPoints\n      );\n      this.techScoreList = ts;\n      this.matchScoreList = ms;\n      var sum = 0;\n      var scoreList = [];\n      var s = Array.from(new Set(this.submitted)); //如第一个人出现两次，则去除重复值\n      for (var j = 0; j < s.length; j++) {\n        var name = s[j];\n        this.techScoreList[name] = !this.techScoreList[name]\n          ? 0\n          : this.techScoreList[name];\n        this.matchScoreList[name] = !this.matchScoreList[name]\n          ? 0\n          : this.matchScoreList[name];\n        if (name != this.publisher) {\n          var scores =\n            Number(this.techScoreList[name]) +\n            Number(this.matchScoreList[name]);\n          sum += scores;\n          scoreList.push({\n            name: name,\n            matchScores: this.matchScoreList[name],\n            techScores: this.techScoreList[name],\n            scores: scores,\n          });\n        }\n      }\n      this.averScores = Math.round(sum / scoreList.length);\n\n      scoreList.sort(this.compare(\"scores\"));\n      var rankList = [];\n\n      var pIndex = s.findIndex((item) => item == this.publisher);\n      pIndex != -1 ? s.splice(pIndex, 1) : s;\n      // 有发布者则把发布者去掉,无则保持原样\n\n      for (var j = 0; j < s.length; j++) {\n        scoreList[j].rank = j+1;\n        rankList.push({ name: scoreList[j].name, rank: rank });\n      }\n\n      if (scoreList != [] && this.averScores) {\n        this.techList = fnl;\n        this.matchList = cms;\n        this.scoreList = scoreList;\n        this.$axios.post(this.api + \"/updateScoresList\", {\n          params: {\n            _id: this.diffId,\n            scoreList: this.scoreList,\n            techList: this.techList,\n            matchList: this.matchList,\n            averScores: this.averScores,\n          },\n        });\n      }\n    },\n\n    //获得分数列表\n    isScoresList() {\n      var index = null;\n      this.checkStatus(); //判断身份\n      // 判断提交名单是否存在发布者\n      var newLen = Array.from(new Set(this.submitted));\n      var pIndex = newLen.findIndex((item) => item == this.publisher);\n      // 有发布者则把数组长度扣去1,无则保持原样\n      newLen = pIndex != -1 ? newLen.length : newLen.length - 1;\n\n      if (\n        this.scoreList == \"\" ||\n        this.scoreList == undefined || //如果scoreList为空\n        !this.averScores //如果平均分为空\n        // || isExceed\n      ) {\n        if (newLen <= 0) {\n          //判断是否发布者为第一个提交的人\n          this.scores = \"还没有人参与修改本次任务！\";\n          this.isSubmitted = false;\n          return;\n        } else {\n          this.countScores();\n        }\n      }\n      this.scoreList.sort(this.compare(\"scores\"));\n      if (\n        this.submitted.findIndex((item) => item === this.username) == -1 ||\n        this.username == this.publisher\n      ) {\n        //该用户没有参与本次任务或是发布者\n        this.scores = this.averScores + \"（平均分）\";\n      } else {\n        var index = this.scoreList.findIndex(\n          (item) => item.name === this.username\n        );\n        var rank = this.scoreList[index].rank;\n        this.myRank = rank;\n        this.scores =\n          this.scoreList[index].scores + \" 你本次超越了\" + rank + \"%的人喔！\";\n      }\n      if (this.username == this.publisher) {\n        // 更新发布者“myPublished”中的平均分\n        this.$axios.post(this.api + \"/updateMyPublishedScores\", {\n          params: {\n            _id: this.userId,\n            taskId: this.diffId,\n            scoreList: this.scoreList,\n            techList: this.techList,\n            matchList: this.matchList,\n            averScores: this.averScores,\n          },\n        });\n      } else if (\n        this.submitted.findIndex((item) => item === this.username) != -1 &&\n        this.username != this.publisher\n      ) {\n        // 更新用户“myTasks”中的分数\n        this.$axios.post(this.api + \"/updateMyTasksScores\", {\n          params: {\n            _id: this.userId,\n            taskId: this.diffId,\n            scores: this.scoreList[index].scores\n              ? this.scoreList[index].scores\n              : \"\",\n            userRank: this.myRank,\n          },\n        });\n      }\n    },\n\n    //比较日期大小\n    compareDate(Date1, Date2) {\n      if (Date1.search(\"/\") == -1) {\n        //如果模式为\"2021/02/06 00:00:00\"\n        Date1 = Date1.replace(\"-\", \"/\"); //转换成标准格式\n      }\n      if (Date2.search(\"/\") == -1) {\n        Date2 = Date2.replace(\"-\", \"/\");\n      }\n      if (Date1.split(\" \")[0] == Date2.split(\" \")[0]) {\n        //如果是同一天，则比较时分秒\n        var time1 = Date1.split(\" \")[1].split(\":\");\n        var time2 = Date2.split(\" \")[1].split(\":\");\n        var total1 =\n          Number(time1[0]) * 3600 + Number(time1[1]) * 60 + Number(time1[2]);\n        var total2 =\n          Number(time2[0]) * 3600 + Number(time2[1]) * 60 + Number(time2[2]);\n        return total1 - total2 >= 0 ? true : false;\n      } else {\n        var oDate1 = new Date(Date1.split(\" \")[0]);\n        var oDate2 = new Date(Date2.split(\" \")[0]);\n        return oDate1 >= oDate2 ? true : false;\n      }\n    },\n    //查看分数列表\n    checkScoresDetails() {\n      if (this.isPublisher) {\n        var path = \"/diff/\" + this.diffId + \"/scores\";\n        this.$router.push(path);\n      } else {\n        var path = \"/diff/\" + this.diffId + \"/scoresStu\";\n        this.$router.push(path);\n      }\n    },\n    // 检查身份\n    checkStatus() {\n      var index = this.submitted.findIndex((item) => item == this.username);\n      if (this.username == this.publisher) {\n        this.isPublisher = true;\n        this.isSubmitted = true;\n      } else if (index != -1) {\n        this.isSubmitted = true;\n      }\n    },\n\n    manualCofirm() {\n      //手动确认后执行算分的函数\n      this.isScoresList();\n      this.isManual = !this.isManual;\n      this.isConfirm = !this.isConfirm;\n      this.setManual();\n    },\n\n    setManual() {\n      //设置是否手动确认分数\n      this.$axios.post(this.api + \"/updateIsManual\", {\n        params: {\n          _id: this.diffId,\n          isManual: this.isManual,\n          isConfirm: this.isConfirm,\n        },\n      });\n    },\n\n    //video play & load & pause\n    playFunc() {\n      this.isCountTime = true;\n      console.log(\"playing\");\n    },\n    pauseFunc() {\n      this.isCountTime = false;\n      console.log(\"pasused\");\n      // your code\n    },\n    loaded() {\n      this.isCountTime = false;\n      console.log(\"waiting\");\n    },\n    startTime(){\n      this.isCountTime = true;\n      console.log(\"moving\");\n    },\n \n updateStudyTime(){\n    let newdate=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n    var timespan = this.timespan\n      this.$axios.post('/score/updateStudyTime',{\n        params:{\n          _id: this.userId,\n          listenTime: timespan,\n          recordTime: newdate,\n        }\n      })\n    }\n\n    },\n  //页面生成前要做的工作\n  created() {\n    window.addEventListener('beforeunload', this.updateStudyTime)\n    //可以考虑加个动画，因为有较多数据要加载，不然会显得页面卡顿\n    this.diffId = this.$route.params.diffId;\n    this.username = sessionStorage.getItem(\"userName\");\n    this.$axios.get(this.api + \"/profile?name=\" + this.username).then((res) => {\n      this.userId = res.data[0]._id;\n      this.userStatus = res.data[0].status;\n    });\n    this.$axios\n      .post(this.api + \"/getVersions\", { params: { _id: this.diffId } })\n      .then((res) => {\n        this.versionsList = res.data; //获取每个人的版本\n      });\n    //渲染之前请求数据，判断是否有第一版本\n    this.$axios\n      .get(this.api + \"/currentTask?_id=\" + this.diffId)\n      .then((res) => {\n        var video_id = res.data[0].videoId; //对应视频的_id\n        this.userList = res.data[0].userList;\n        this.diffList = res.data[0].diffList;\n        this.publisher = res.data[0].publisher;\n        this.submitted = res.data[0].submitted;\n        this.publishTime = res.data[0].time;\n        this.taskTitle = res.data[0].title;\n        this.deadline = res.data[0].deadline;\n        this.taskLabels = res.data[0].label;\n        this.scoreList = res.data[0].scoreList;\n        this.techList = res.data[0].techList;\n        this.matchList = res.data[0].matchList;\n        this.averScores = res.data[0].averScores;\n        this.isManual = res.data[0].isManual;\n        this.isConfirm = res.data[0].isConfirm;\n        console.log(\"lll\", this.submitted);\n\n        // let date = new Date();\n        // let newdate = date.toLocaleString(\"chinese\", {\n        //   hour12: false,\n        // });\n        let newdate=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n        var isOut = this.compareDate(newdate, this.deadline);\n        console.log(\"isOut\", isOut);\n        if (this.userStatus == \"1\") {\n          this.isTeacher = true;\n        }\n        if (this.userStatus == \"0\") {\n          this.isTeacher = false;\n          if (isOut) {\n            this.isreadonly = false;\n          }\n        }\n\n        this.$axios\n          .get(this.api + \"/currentVideoPublisher?name=\" + this.publisher)\n          .then((res) => {\n            this.status = res.data[0].status;\n            if (this.status == \"1\") {\n              this.identity = \"老师\";\n            }\n            if (this.status == \"2\") {\n              this.identity = \"组长\";\n            }\n          });\n        // console.log(this.userList);\n        //获取视频路径，从服务器获取\n        this.$axios\n          .get(this.api + \"/currentVideo?_id=\" + video_id)\n          .then((res) => {\n            this.fileName = res.data[0].fileName;\n            var filetype = this.fileName.split(\".\")[1];\n            for (var i = 0; i < this.videoType.length; i++) {\n              if (filetype == this.videoType[i]) {\n                this.isVideo = true;\n              }\n            }\n          });\n        //先判断是否有修改记录，再判断是否有第一版本\n        if (this.diffList.length == 0) {\n          this.$axios\n            .get(this.api + \"/allVersions?_id=\" + this.diffId)\n            .then((res) => {\n              if (res.data.length == 0) {\n                //当前无人提交版本，显示输入框\n                this.isversion1 = false;\n                this.loading = false;\n              } else {\n                this.isversion1 = true;\n                this.loading = false;\n                this.text_v1 = res.data[0].version;\n              }\n            });\n        } else {\n          //形成综合版本\n          this.createFinalVersion();\n          this.isversion1 = true;\n          this.isFinal = true;\n        }\n      });\n    if (this.submitted.length == 0) {\n      this.isScoresList();\n    }\n  },\n  updated() {\n    //判断是音频还是视频\n    this.decidePlayer();\n    // let date = new Date();\n    // let newdate = date.toLocaleString(\"chinese\", {\n    //   hour12: false,\n    // });\n    let newdate=this.$moment(new Date()).format(\"YYYY/MM/DD HH:mm:ss\")\n    //(\"2021/02/06 00:00:00\", \"2021/02/05 00:00:00\" newdate, this.deadline)\n    var isDDL = this.compareDate(newdate, this.deadline);\n    if (\n      this.submitted.length >= 1 &&\n      !this.isManual &&\n      (isDDL || this.isConfirm)\n    ) {\n      //如果提交名单大于1,且为自动计算，过了ddl或已经确认过，则运行函数\n      this.isScoresList();\n    }\n  },\n  mounted() {\n    setInterval(() => {\n      if (this.isCountTime) {\n        this.timespan += 0.1;\n        // console.log(this.timespan);\n      }\n    }, 100);\n    //window.addEventListener('beforeunload', this.updateStudyTime)        \n    // window.addEventListener(\"keypress\", this.startTime());\n  },\n  destroyed() {\n        window.removeEventListener('beforeunload', this.updateStudyTime)\n  // window.removeEventListener(\"scroll\", this.setHeadPosition, true);\n},\n};\n\n\n\n</script>\n\n<style>\n/* 浮框底部距离 */\n.el-collapse-item__content {\n  padding-bottom: 0;\n}\n\n.eltable {\n  width: 100%;\n  font-size: 90%;\n}\n\n.eltable th {\n  padding: 4px 0 !important;\n}\n\n.eltable td {\n  padding: 4px 0 !important;\n}\n\n.badge {\n  font-size: 1em;\n  padding: 0.28em 0.22em;\n  font-weight: normal;\n  /* 字体可能得改改 */\n}\n.buttons {\n  position: fixed;\n  right: 0;\n  margin-right: 6px;\n  display: inline-block;\n  margin-top: 150px;\n  z-index: 99;\n}\n\n.el-header,\n.el-footer {\n  background-color: #b3c0d1;\n  color: #333;\n  line-height: 60px;\n}\n\n.edit {\n  background-color: lavender;\n}\n\nins {\n  color: green;\n  font-weight: bold;\n}\n\nsubins {\n  color: blue;\n}\n\ndel {\n  color: indianred;\n}\n\n.el-main {\n  background: #d3cce3;\n  background: -webkit-linear-gradient(to left, #e9e4f0, #d3cce3);\n  background: linear-gradient(to left, #e9e4f0, #d3cce3);\n  border-radius: 2em;\n}\n.edit-tip {\n  color: purple;\n  font-size: 20px;\n}\n\n#textDiv {\n  margin-top: 0;\n  padding: 1% 2%;\n  font-size: 20px;\n  background-color: white;\n  border-radius: 6px;\n  width: 100%;\n  height: 85%;\n  text-align: left;\n}\np {\n  word-wrap: break-word;\n  word-break: break-all;\n}\n#insertText {\n  text-decoration: none;\n  color: #21bf73;\n}\n\n#deleteText {\n  color: #ef6c57;\n  text-decoration: line-through #ea4c4c solid;\n}\n.box-card {\n  width: 1000px;\n  margin-top: 2%;\n}\n.active:hover {\n  color: rgb(0, 0, 95);\n  border-radius: 2px;\n  border-bottom: 1px solid black;\n}\n#wordOperate {\n  display: none;\n  width: 600px;\n  padding: 5px 5px;\n  border-radius: 5px;\n  transition-duration: 100ms;\n  line-height: 100%;\n  box-shadow: 0px 0px 7px rgb(143, 141, 141);\n  z-index: 10001;\n}\n\n/* 视频css */\n.video-container {\n  margin: 1.5% auto;\n  display: flex;\n  justify-content: center;\n}\n\n.video-left-box,\n.video-right-box {\n  margin: 0 1.5em;\n}\n\n.example-player {\n  position: relative;\n  width: 750px;\n  height: 450px;\n  background-color: #000;\n  font-weight: normal;\n}\n\n/* 信息卡片css */\n.my-card.q-card.q-card--bordered.q-card--flat.no-shadow {\n  width: 16.5em;\n}\n\n/* 视频快进快退css */\n#menu,\n.submit-btn,\n.edit-btn {\n  display: flex;\n  justify-content: center;\n}\n\n/* .el-row {\n  margin-bottom: 20px;\n} */\n.el-col {\n  border-radius: 4px;\n}\n.row-bg {\n  padding: 10px 0;\n  /* background-color: #f9fafc; */\n}\n.el-textarea {\n  position: relative;\n  display: inline-block;\n  width: 100%;\n  vertical-align: baseline;\n  font-size: 16px;\n  line-height: 1.5;\n}\nbutton.q-btn.q-btn-item.non-selectable.no-outline.q-btn--standard.q-btn--rectangle.bg-purple.text-white.q-btn--actionable.q-focusable.q-hoverable.q-btn--wrap,\nbutton.q-btn.q-btn-item.non-selectable.no-outline.q-btn--standard.q-btn--rectangle.bg-purple-4.text-white.q-btn--actionable.q-focusable.q-hoverable.q-btn--wrap,\nbutton.q-btn.q-btn-item.non-selectable.no-outline.q-btn--standard.q-btn--rectangle.bg-purple-6.text-white.q-btn--actionable.q-focusable.q-hoverable.q-btn--wrap {\n  width: 15em;\n}\nmain#mainContent {\n  height: 88vh;\n  padding-bottom: 4%;\n}\n.q-item__section.column.q-item__section--main.justify-center {\n  flex-direction: column;\n}\n.aui_close {\n  width: 15px;\n  height: 15px;\n  line-height: 15px;\n  display: block;\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  font-family: Helvetica, STHeiti;\n  _font-family: \"\\u9ed1\\u4f53\", \"Book Antiqua\", Palatino;\n  font-size: 18px;\n  border-radius: 20px;\n  background: #999;\n  color: #fff;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n  -moz-transition: linear 0.06s;\n  -webkit-transition: linear 0.06s;\n  transition: linear 0.06s;\n  padding: 0;\n  text-align: center;\n  text-decoration: none;\n  outline: none;\n  cursor: pointer;\n  z-index: 20;\n}\n.aui_close:hover {\n  width: 17px;\n  height: 17px;\n  line-height: 17px;\n  right: 9px;\n  top: 9px;\n  color: #fff;\n  box-shadow: 0 1px 3px rgba(209, 40, 42, 0.5);\n  background: #d1282a;\n  border-radius: 24px;\n  transition: all 0.2s ease-out;\n  text-decoration: none;\n  opacity: 0.8;\n}\n</style>\n"]}]}