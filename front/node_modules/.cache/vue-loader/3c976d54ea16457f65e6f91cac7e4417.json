{"remainingRequest":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\FFFF\\codictation.2.4\\codictation\\src\\components\\profile\\published.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"E:\\FFFF\\codictation.2.4\\codictation\\src\\components\\profile\\published.vue","mtime":1616575822276},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-cli-plugin-quasar\\lib\\loader.auto-import.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\FFFF\\codictation.2.4\\codictation\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnEtaXRlbV9fc2VjdGlvbi5jb2x1bW4ucS1pdGVtX19zZWN0aW9uLS10b3AucS1pdGVtX19zZWN0aW9uLS1tYWluLmp1c3RpZnktc3RhcnQgewogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47Cn0KLnEtaXRlbV9fc2VjdGlvbi5jb2x1bW4ucS1pdGVtX19zZWN0aW9uLS10b3AucS1pdGVtX19zZWN0aW9uLS1tYWluLmp1c3RpZnktc3RhcnQgewogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKfQppLm1hdGVyaWFsLWljb25zLnEtaWNvbi5ub3RyYW5zbGF0ZS50ZXh0LXB1cnBsZSB7CiAgbWFyZ2luLXRvcDogMC4yM2VtOwp9Ci5xLWl0ZW1fX3NlY3Rpb24uY29sdW1uLmNvbC00Lmd0LXNtLnEtaXRlbV9fc2VjdGlvbi0tdG9wLnEtaXRlbV9fc2VjdGlvbi0tbWFpbi5qdXN0aWZ5LXN0YXJ0IHsKICBwYWRkaW5nLXRvcDogMC4xNWVtOwp9Ci5xLWl0ZW0ucS1pdGVtLXR5cGUucm93Lm5vLXdyYXAuY29sLTIgewogIG1hcmdpbi10b3A6IDAuM2VtOwp9Ci5xLW5vdGlmaWNhdGlvbnNfX2xpc3QtLWJvdHRvbSB7CiAgcmlnaHQ6IDUwcHg7CiAgbGVmdDogYXV0bzsKICBib3R0b206IDIwcHg7Cn0K"},{"version":3,"sources":["published.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAySA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"published.vue","sourceRoot":"src/components/profile","sourcesContent":["<template>\n  <q-page class=\"q-pa-lg\">\n    <h3 class=\"q-my-md\">Task List</h3>\n    <q-separator insert style=\"width: 55%\" />\n\n    <div\n      v-if=\"myPublished.length > 0\"\n      class=\"q-pa-md q-gutter-sm\"\n      style=\"max-width: 90%\"\n    >\n      <el-button type=\"primary\" @click=\"selectAll()\">Select All</el-button>\n      <el-button type=\"primary\" @click=\"exportSelectedData()\"\n        >Bulk Download</el-button\n      >\n      <q-list\n        bordered\n        class=\"rounded-borders row\"\n        style=\"max-width: 850px\"\n        v-model=\"currentContent\"\n        v-for=\"(item, index) in currentContent\"\n        :key=\"index\"\n      >\n        <q-item clickable @click=\"intoTask(index)\" class=\"col-9\">\n          <q-item-section avatar>\n            <q-checkbox\n              v-model=\"selectedTask\"\n              :val=\"item.title\"\n              color=\"cyan-7\"\n              v-if=\"item.averScores\"\n            />\n          </q-item-section>\n\n          <q-item-section avatar top>\n            <q-icon name=\"send\" color=\"purple\" size=\"28px\" />\n          </q-item-section>\n\n          <q-item-section top class=\"col-4 gt-sm\">\n            <q-item-label class=\"q-mt-sm\">{{ item.title }}</q-item-label>\n          </q-item-section>\n\n          <q-item-section top>\n            <q-item-label caption lines=\"1\">\n              <span class=\"text-grey\">Release Date: {{ item.time }}</span>\n            </q-item-label>\n            <q-item-label caption lines=\"1\">\n              <span class=\"text-purple-9\">Deadline: {{ item.deadline }}</span>\n            </q-item-label>\n          </q-item-section>\n        </q-item>\n\n        <q-item class=\"col-2\">\n          <q-item-section top side>\n            <div class=\"text-grey-8 q-gutter-xs\">\n              <q-btn\n                class=\"gt-xs\"\n                size=\"14px\"\n                flat\n                dense\n                @click=\"startEx(index)\"\n              >\n                {{ item.averScores ? item.averScores : \"SCORES\" }}\n              </q-btn>\n            </div>\n          </q-item-section>\n        </q-item>\n\n        <q-item class=\"col-1\">\n          <q-item-section top side>\n            <div class=\"text-grey-8 q-gutter-xs\">\n              <q-btn\n                class=\"gt-md text-red-9\"\n                size=\"16px\"\n                flat\n                round\n                dense\n                icon=\"delete_forever\"\n                @click=\"deleteTask(item.taskId)\"\n              />\n            </div>\n          </q-item-section>\n        </q-item>\n      </q-list>\n      <el-pagination\n        style=\"margin-top: 3%\"\n        background\n        layout=\"prev, pager, next\"\n        :total=\"myPublished.length\"\n        :page-size=\"pagesize\"\n        :current-page.sync=\"currentpage\"\n        hide-on-single-page\n      >\n      </el-pagination>\n    </div>\n\n    <div v-else>暂未发布任务~</div>\n  </q-page>\n</template>\n\n<script>\nimport XLSX from \"xlsx\";\n\nexport default {\n  data() {\n    return {\n      name: \"\", //当前用户的用户名\n      userId: \"\", //当前用户的_id  可根据这两个信息去数据库User取数据\n      api: \"/api\",\n      myPublished: [],\n      pagesize: 8,\n      currentpage: 1,\n      currentContent: [],\n      selectedTask: [], // checkbox所选中的 task title\n      isAll: false,\n    };\n  },\n  watch: {\n    currentpage() {\n      this.showCurrent(this.currentpage);\n    },\n  },\n  created() {\n    this.name = sessionStorage.getItem(\"userName\");\n    console.log(this.name);\n    this.$axios.get(this.api + \"/profile?name=\" + this.name).then((res) => {\n      this.userId = res.data[0]._id; //找地方保存\n      this.myPublished = res.data[0].myPublished.reverse();\n      this.showCurrent(this.currentpage);\n      console.log(this.currentContent);\n    });\n  },\n  methods: {\n    // 进入到任务详情页面\n    intoTask(index) {\n      var diffId = this.myPublished[index].taskId; //任务_id\n      var path = \"/diff/\" + diffId;\n      this.$router.push(path);\n    },\n    // 老师进入该任务各个学生得分情况页面\n    startEx(index) {\n      var diffId = this.myPublished[index].taskId; //任务_id\n      var path = \"/diff/\" + diffId;\n      if (this.currentContent[index].averScores) {\n        path = \"/diff/\" + diffId + \"/scores\";\n      }\n      this.$router.push(path);\n    },\n    showCurrent(cpage) {\n      var min = (cpage - 1) * this.pagesize;\n      var max = cpage * this.pagesize;\n      this.currentContent = this.myPublished.slice(min, max);\n    },\n    //确定数组里是否有某个元素\n    findElem(arrayToSearch, attr, val) {\n      for (var i = 0; i < arrayToSearch.length; i++) {\n        if (arrayToSearch[i][attr] == val) {\n          return i;\n        }\n      }\n      return -1;\n    },\n    //删除user-myTasks里面的任务\n    deleteTask(taskId) {\n      this.$q\n        .dialog({\n          title: \"Confirm Deletion\",\n          message: \"Delete this task permanently?\",\n          ok: {\n            push: true,\n          },\n          cancel: {\n            push: true,\n            color: \"negative\",\n          },\n          persistent: true,\n        })\n        .onOk(() => {\n          var find_result = this.findElem(this.myPublished, \"taskId\", taskId);\n          this.myPublished.splice(find_result, 1);\n          this.$axios.post(this.api + \"/deleteMyPublished\", {\n            params: {\n              username: this.name,\n              myPublished: this.myPublished,\n              taskId: taskId,\n            },\n          });\n          this.showCurrent(this.currentpage);\n          this.$q.notify({\n            progress: true,\n            message: \"Deleted!\",\n            color: \"purple\",\n            icon: \"auto_delete\",\n          });\n        });\n    },\n\n    exportSelectedData() {\n      var workBook = XLSX.utils.book_new();\n      for (var i = 0; i < this.myPublished.length; i++) {\n        var tableHeader = [\n          [\n            \"Student\",\n            \"Score on modifications(SM)(\" +\n              this.myPublished[i].configuration.SMscore +\n              \")\",\n            \"Score on texts similarity(STS)(\" + (100 - Number(this.myPublished[i].configuration.SMscore)) + \")\",\n            \"Total score\",\n            \"Rank\"\n          ],\n        ]; //表头\n        var dataList = [];\n        var scoresData = this.myPublished[i].scoreList;\n        var taskTitle = this.myPublished[i].title;\n        var index = this.selectedTask.findIndex((item) => item == taskTitle);\n        if (scoresData != \"\" && index != -1) {\n          scoresData.forEach((item) => {\n            dataList.push([\n              item.name,\n              item.techScores,\n              item.matchScores,\n              item.scores,\n              item.rank\n            ]);\n          }); //表数据\n          var sheet = this.myPublished[i].title;\n          var overview = [];\n          overview.push(\n            [\"Average score(AS)\", String(this.myPublished[i].averScores)],\n            [\n              \"The number of people passing AS\",\n              String(this.myPublished[i].exceedAverNum),\n            ],\n            [\"Total number of people\", String(dataList.length)],\n            [\"Pass rate\", String(this.myPublished[i].pass60Rate)],\n            [\"Pass AS rate\", String(this.myPublished[i].passAverRate)],\n            [\"Max score\", String(this.myPublished[i].maxScore)],\n            [\"Mini score\", String(this.myPublished[i].minScore)]\n          );\n\n          var aoa = [];\n          var a = [[], []]; //当a=[[],[]]时相当于空两行\n          aoa = overview.concat(a, tableHeader, dataList);\n\n          var workSheet = XLSX.utils.aoa_to_sheet(aoa);\n\n          XLSX.utils.book_append_sheet(workBook, workSheet, sheet);\n          //保存\n        }\n      }\n\n      var filename = this.timestamp(); //文件名，以时间命名\n\n      XLSX.writeFile(workBook, filename + \".xlsx\");\n    }, //导出Excel表\n\n    add0(m) {\n      return m < 10 ? \"0\" + m : m;\n    },\n\n    timestamp() {\n      //生成时间戳\n      var time = new Date();\n      var y = time.getFullYear();\n      var m = time.getMonth() + 1;\n      var d = time.getDate();\n      var h = time.getHours();\n      var mm = time.getMinutes();\n      var s = time.getSeconds();\n\n      return (\n        y +\n        this.add0(m) +\n        this.add0(d) +\n        this.add0(h) +\n        this.add0(mm) +\n        this.add0(s)\n      );\n    },\n\n    selectAll() {\n      //全选\n      if (!this.isAll) {\n        this.currentContent.forEach((item) => {\n          if (item.averScores) {\n            this.selectedTask.push(item.title);\n          }\n        });\n        this.selectedTask = Array.from(new Set(this.selectedTask));\n      } else {\n        this.selectedTask = [];\n      }\n      this.isAll = !this.isAll;\n    },\n  },\n};\n</script>\n\n<style>\n.q-item__section.column.q-item__section--top.q-item__section--main.justify-start {\n  flex-direction: column;\n}\n.q-item__section.column.q-item__section--top.q-item__section--main.justify-start {\n  justify-content: space-between;\n}\ni.material-icons.q-icon.notranslate.text-purple {\n  margin-top: 0.23em;\n}\n.q-item__section.column.col-4.gt-sm.q-item__section--top.q-item__section--main.justify-start {\n  padding-top: 0.15em;\n}\n.q-item.q-item-type.row.no-wrap.col-2 {\n  margin-top: 0.3em;\n}\n.q-notifications__list--bottom {\n  right: 50px;\n  left: auto;\n  bottom: 20px;\n}\n</style>\n"]}]}